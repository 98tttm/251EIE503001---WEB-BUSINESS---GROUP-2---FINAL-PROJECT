<div class="brand-detail-container">
  <!-- Breadcrumb -->
  <nav class="breadcrumb">
    <a routerLink="/">Trang chủ</a>
    @if (brandInfo()) {
      <span class="separator">/</span>
      <span>{{ brandInfo()!.name }}</span>
    }
  </nav>

  <!-- Brand Header -->
  @if (brandInfo()) {
    <div class="brand-header" (click)="scrollToProducts()">
      <div class="brand-logo-section">
        @if (brandInfo()!.logo) {
          <img [src]="brandInfo()!.logo" [alt]="brandInfo()!.name + ' Logo'" class="brand-logo">
        }
      </div>
      <div class="brand-info-section">
        <div class="brand-label">Thương hiệu</div>
        <h1 class="brand-name">{{ brandInfo()!.name }}</h1>
        <p class="brand-description">{{ brandInfo()!.description }}</p>
      </div>
    </div>
  }

  <!-- Product Count Badge -->
  @if (products().length > 0) {
    <div class="product-count-badge">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="9" y1="3" x2="9" y2="21"></line>
      </svg>
      <span>Thực phẩm chức năng</span>
      <span class="product-count">{{ products().length }} sản phẩm</span>
    </div>
  }

  <!-- Main Content -->
  <div class="main-content">
    <!-- Filter Sidebar -->
    <aside class="filter-sidebar">
      <div class="filter-section">
        <div class="filter-header">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="4" y1="6" x2="16" y2="6"></line>
            <line x1="8" y1="11" x2="20" y2="11"></line>
            <line x1="4" y1="16" x2="14" y2="16"></line>
          </svg>
          <h3>Bộ lọc nâng cao</h3>
        </div>
      </div>

      <!-- Price Filter -->
      <div class="filter-section">
        <div class="filter-section-title">
          Giá bán
        </div>
        <div class="filter-options">
          <label class="filter-checkbox">
            <input type="radio" name="priceRange" value="all" [checked]="selectedPriceRange() === 'all'" (change)="selectedPriceRange.set('all'); onPriceRangeChange()">
            <span>Tất cả</span>
          </label>
          <label class="filter-checkbox">
            <input type="radio" name="priceRange" value="<100k" [checked]="selectedPriceRange() === '<100k'" (change)="selectedPriceRange.set('<100k'); onPriceRangeChange()">
            <span>Dưới 100.000đ</span>
          </label>
          <label class="filter-checkbox">
            <input type="radio" name="priceRange" value="100k-200k" [checked]="selectedPriceRange() === '100k-200k'" (change)="selectedPriceRange.set('100k-200k'); onPriceRangeChange()">
            <span>100.000đ - 200.000đ</span>
          </label>
          <label class="filter-checkbox">
            <input type="radio" name="priceRange" value="200k-500k" [checked]="selectedPriceRange() === '200k-500k'" (change)="selectedPriceRange.set('200k-500k'); onPriceRangeChange()">
            <span>200.000đ - 500.000đ</span>
          </label>
          <label class="filter-checkbox">
            <input type="radio" name="priceRange" value=">500k" [checked]="selectedPriceRange() === '>500k'" (change)="selectedPriceRange.set('>500k'); onPriceRangeChange()">
            <span>Trên 500.000đ</span>
          </label>
        </div>
      </div>
    </aside>

    <!-- Products Section -->
    <div class="products-section" id="products-section">
      <!-- Product Header -->
      <div class="products-header">
        <div class="products-header-left">
          <h2 class="section-title">Sản phẩm nổi bật</h2>
        </div>
        <div class="products-controls">
          <div class="sort-controls">
            <span>Sắp xếp theo:</span>
            <button 
              class="sort-btn" 
              [class.active]="sortBy() === 'bestseller'"
              (click)="sortBy.set('bestseller'); onSortChange()">
              Bán chạy
            </button>
            <button 
              class="sort-btn" 
              [class.active]="sortBy() === 'price-asc'"
              (click)="sortBy.set('price-asc'); onSortChange()">
              Giá thấp
            </button>
            <button 
              class="sort-btn" 
              [class.active]="sortBy() === 'price-desc'"
              (click)="sortBy.set('price-desc'); onSortChange()">
              Giá cao
            </button>
          </div>
          <div class="view-controls">
            <button 
              class="view-btn view-toggle-btn" 
              [class.grid-active]="viewMode() === 'grid'"
              [class.list-active]="viewMode() === 'list'"
              (click)="viewMode.set(viewMode() === 'grid' ? 'list' : 'grid')">
              @if (viewMode() === 'grid') {
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="7" height="7"></rect>
                  <rect x="14" y="3" width="7" height="7"></rect>
                  <rect x="3" y="14" width="7" height="7"></rect>
                  <rect x="14" y="14" width="7" height="7"></rect>
                </svg>
              } @else {
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="8" y1="6" x2="21" y2="6"></line>
                  <line x1="8" y1="12" x2="21" y2="12"></line>
                  <line x1="8" y1="18" x2="21" y2="18"></line>
                  <line x1="3" y1="6" x2="3.01" y2="6"></line>
                  <line x1="3" y1="12" x2="3.01" y2="12"></line>
                  <line x1="3" y1="18" x2="3.01" y2="18"></line>
                </svg>
              }
            </button>
          </div>
        </div>
      </div>

      <!-- Note -->
      <p class="products-note">Lưu ý: Thuốc kê đơn và một số sản phẩm sẽ cần tư vấn từ dược sĩ</p>

      <!-- Products Grid -->
      @if (loading()) {
        <div class="loading">Đang tải sản phẩm...</div>
      } @else if (filteredProducts().length === 0) {
        <div class="no-products">Không có sản phẩm nào</div>
      } @else {
        <div class="products-grid" [class.grid-view]="viewMode() === 'grid'" [class.list-view]="viewMode() === 'list'">
          @for (product of filteredProducts(); track product._id) {
            <div class="product-card" (click)="navigateToProduct(product._id)">
              <!-- Discount Badge -->
              @if (product.discount && product.discount > 0) {
                <div class="discount-badge">-{{ calculateDiscountPercent(product.price, product.discount) }}%</div>
              }
              
              <!-- Product Image -->
              <div class="product-image">
                <img [src]="product.image || 'https://via.placeholder.com/400x400?text=MediCare'" [alt]="product.name">
              </div>
              
              <!-- Product Info -->
              <div class="product-info">
                <div class="product-name">{{ product.name }}</div>
                
                <div class="product-pricing">
                  <span class="product-price">{{ formatPrice(product.price) }}đ</span>
                  @if (product.unit) {
                    <span class="product-unit"> / {{ product.unit }}</span>
                  }
                </div>
                
                @if (product.discount && product.discount > 0) {
                  <div class="product-original-price">{{ formatPrice(product.price + product.discount) }}đ</div>
                }
                
                <!-- Add to Cart Button -->
                <button class="btn-add-cart" (click)="navigateToProduct(product._id); $event.stopPropagation()">Chọn mua</button>
              </div>
            </div>
          }
        </div>
      }
    </div>
  </div>
</div>

