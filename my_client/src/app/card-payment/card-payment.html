<div class="card-payment-container">
  <div class="card-payment-content">
    <!-- Header -->
    <div class="payment-header">
      <button class="btn-back" (click)="goBack()">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
        Quay lại
      </button>
      <h1 class="payment-title">Thanh toán bằng thẻ quốc tế</h1>
    </div>

    <div class="payment-main">
      <!-- Left: Payment Methods -->
      <div class="payment-left">
        <div class="payment-methods-section">
          <h2 class="section-title">Chọn phương thức thanh toán</h2>
          
          <!-- Payment Options -->
          <div class="payment-options-list">
            <!-- Visa/Master Card -->
            <label class="payment-option-card" [class.selected]="selectedPaymentMethod() === 'card'">
              <input 
                type="radio" 
                name="cardPayment" 
                value="card"
                [checked]="selectedPaymentMethod() === 'card'"
                (change)="selectPaymentMethod('card')">
              <div class="option-content-card">
                <div class="payment-icons">
                  <img src="/assets/images/bank/card.png" alt="Visa/Master" class="payment-icon-large">
                </div>
                <div class="option-details">
                  <h3 class="option-title">Thẻ quốc tế</h3>
                  <p class="option-description">Visa, Mastercard, JCB, Amex</p>
                </div>
                <div class="check-icon" *ngIf="selectedPaymentMethod() === 'card'">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </div>
              </div>
            </label>

            <!-- Apple Pay -->
            <label class="payment-option-card" [class.selected]="selectedPaymentMethod() === 'apple'">
              <input 
                type="radio" 
                name="cardPayment" 
                value="apple"
                [checked]="selectedPaymentMethod() === 'apple'"
                (change)="selectPaymentMethod('apple')">
              <div class="option-content-card">
                <div class="payment-icons">
                  <img src="/assets/images/bank/applepay.png" alt="Apple Pay" class="payment-logo-image">
                </div>
                <div class="option-details">
                  <h3 class="option-title">Apple Pay</h3>
                  <p class="option-description">Thanh toán nhanh với Apple Pay</p>
                </div>
                <div class="check-icon" *ngIf="selectedPaymentMethod() === 'apple'">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </div>
              </div>
            </label>

            <!-- Google Pay -->
            <label class="payment-option-card" [class.selected]="selectedPaymentMethod() === 'google'">
              <input 
                type="radio" 
                name="cardPayment" 
                value="google"
                [checked]="selectedPaymentMethod() === 'google'"
                (change)="selectPaymentMethod('google')">
              <div class="option-content-card">
                <div class="payment-icons">
                  <img src="/assets/images/bank/ggpay.png" alt="Google Pay" class="payment-logo-image">
                </div>
                <div class="option-details">
                  <h3 class="option-title">Google Pay</h3>
                  <p class="option-description">Thanh toán nhanh với Google Pay</p>
                </div>
                <div class="check-icon" *ngIf="selectedPaymentMethod() === 'google'">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </div>
              </div>
            </label>

            <!-- VNPay Wallet -->
            <label class="payment-option-card" [class.selected]="selectedPaymentMethod() === 'vnpay'">
              <input 
                type="radio" 
                name="cardPayment" 
                value="vnpay"
                [checked]="selectedPaymentMethod() === 'vnpay'"
                (change)="selectPaymentMethod('vnpay')">
              <div class="option-content-card">
                <div class="payment-icons">
                  <img src="/assets/images/bank/vnpay.webp" alt="Ví VNPay" class="payment-logo-image">
                </div>
                <div class="option-details">
                  <h3 class="option-title">Ví VNPay</h3>
                  <p class="option-description">Thanh toán bằng ví điện tử VNPay</p>
                </div>
                <div class="check-icon" *ngIf="selectedPaymentMethod() === 'vnpay'">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </div>
              </div>
            </label>
          </div>

          <!-- Security Info -->
          <div class="security-info">
            <div class="security-item">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                <polyline points="9 12 11 14 15 10"></polyline>
              </svg>
              <span>Giao dịch được bảo mật bởi SSL/TLS</span>
            </div>
            <div class="security-item">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
              </svg>
              <span>Không lưu trữ thông tin thẻ của bạn</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Right: Order Summary -->
      <div class="payment-right">
        <div class="order-summary">
          <h2 class="summary-title">Tóm tắt đơn hàng</h2>
          
          <!-- Order Items -->
          <div class="summary-items">
            @for (item of items(); track item._id) {
              <div class="summary-item">
                <img [src]="item.image" [alt]="item.name" class="item-image">
                <div class="item-info">
                  <h4 class="item-name">{{ item.name }}</h4>
                  <p class="item-details">
                    {{ item.quantity }} x {{ formatPrice(item.discount ? (item.price * (1 - item.discount / 100)) : item.price) }}
                  </p>
                </div>
              </div>
            }
          </div>

          <!-- Order Total -->
          <div class="summary-total">
            <div class="total-row">
              <span>Tạm tính:</span>
              <span>{{ formatPrice(total()) }}</span>
            </div>
            <div class="total-row">
              <span>Phí vận chuyển:</span>
              <span class="free-shipping">Miễn phí</span>
            </div>
            <div class="total-row final-total">
              <span>Tổng cộng:</span>
              <span class="total-price">{{ formatPrice(total()) }}</span>
            </div>
          </div>

          <!-- Payment Button -->
          <button 
            class="btn-pay" 
            [class.disabled]="!selectedPaymentMethod()"
            (click)="processPayment()"
            [disabled]="!selectedPaymentMethod()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
              <line x1="1" y1="10" x2="23" y2="10"></line>
            </svg>
            Thanh toán ngay
          </button>

          <!-- Cancel Button -->
          <button class="btn-cancel" (click)="cancelPayment()">
            Hủy thanh toán
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

