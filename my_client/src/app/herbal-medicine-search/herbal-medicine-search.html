<div class="herbal-medicine-search-container">
  <!-- Breadcrumb -->
  <nav class="breadcrumb">
    <a [routerLink]="['/']">Trang chủ</a>
    <span class="separator">/</span>
    <span class="current">Dược liệu</span>
  </nav>

  <!-- Search Section -->
  <div class="search-section">
    <div class="search-content">
      <h1 class="page-title">Tra cứu dược liệu</h1>
      <div class="search-wrapper">
        <input
          type="text"
          class="search-input"
          placeholder="Nhập tên dược liệu cần tìm..."
          [value]="searchQuery()"
          (input)="searchQuery.set($any($event.target).value)"
          (keyup.enter)="onSearch()"
        />
        <button class="search-btn" (click)="onSearch()" type="button">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </button>
      </div>
    </div>
    <div class="search-illustration">
      <img src="/assets/images/pharmacist-illustration.svg" alt="Pharmacist" class="illustration-img" onerror="this.style.display='none'">
    </div>
  </div>

  <!-- Common Herbal Medicines Section -->
  <div class="common-herbal-medicines-section">
    <h2 class="section-title">Dược liệu thông dụng</h2>
    
    <!-- Alphabet Filter -->
    <div class="alphabet-filter">
      @for (letter of alphabetList(); track letter) {
        <button
          type="button"
          class="alphabet-btn"
          [class.active]="selectedAlphabet() === letter"
          (click)="onAlphabetSelect(letter)"
        >
          {{ letter }}
        </button>
      }
    </div>

    <!-- Loading State -->
    @if (loading()) {
      <div class="loading-state">
        <div class="spinner"></div>
        <p>Đang tải danh sách dược liệu...</p>
      </div>
    }

    <!-- Herbal Medicines Grid -->
    @if (!loading() && displayedHerbalMedicines().length > 0) {
      <div class="herbal-medicines-grid">
        @for (herbal of displayedHerbalMedicines(); track herbal.slug) {
          <a 
            [routerLink]="['/duoc-lieu', herbal.slug]" 
            class="herbal-medicine-link"
            (click)="navigateToHerbalMedicine(herbal)"
          >
            {{ herbal.vietnameseName || herbal.name }}
          </a>
        }
      </div>

      <!-- Pagination -->
      @if (totalPages() > 1) {
        <div class="pagination">
          <button
            type="button"
            class="pagination-btn"
            [disabled]="currentPage() === 1"
            (click)="onPageChange(currentPage() - 1)"
          >
            &lt;
          </button>
          
          @for (page of getPagesArray(); track $index) {
            @if (page === '...') {
              <span class="pagination-ellipsis">...</span>
            } @else {
              <button
                type="button"
                class="pagination-btn"
                [class.active]="currentPage() === page"
                (click)="onPageChange(typeof page === 'number' ? page : 1)"
              >
                {{ page }}
              </button>
            }
          }
          
          <button
            type="button"
            class="pagination-btn"
            [disabled]="currentPage() === totalPages()"
            (click)="onPageChange(currentPage() + 1)"
          >
            &gt;
          </button>
        </div>
      }

      <!-- Results Count -->
      <div class="results-count">
        Hiển thị {{ displayedHerbalMedicines().length }} / {{ filteredHerbalMedicines().length }} kết quả
      </div>
    }

    <!-- No Results -->
    @if (!loading() && displayedHerbalMedicines().length === 0) {
      <div class="no-results">
        <p>Không tìm thấy dược liệu nào phù hợp.</p>
        <button type="button" class="reset-btn" (click)="selectedAlphabet.set('all'); searchQuery.set(''); applyFilters()">
          Xóa bộ lọc
        </button>
      </div>
    }
  </div>

  <!-- Recently Viewed Products -->
  @if (recentlyViewed().length > 0) {
    <div class="recently-viewed-section">
      <h2 class="section-title">
        <span class="title-icon">●</span>
        Sản phẩm vừa xem
      </h2>
      <div class="recently-viewed-slider">
        @for (product of recentlyViewed(); track product._id) {
          <div class="recent-product-card" (click)="navigateToProduct(product)">
            @if (product.image) {
              <img [src]="product.image" [alt]="product.name" class="product-image">
            } @else {
              <div class="product-image-placeholder"></div>
            }
            @if (product.discount) {
              <div class="discount-badge">-{{ product.discount }}%</div>
            }
            <div class="product-info">
              <div class="product-title">{{ product.name }}</div>
              @if (product.price) {
                <div class="product-price">{{ formatPrice(product.price) }}</div>
              }
            </div>
          </div>
        }
      </div>
    </div>
  }
</div>

