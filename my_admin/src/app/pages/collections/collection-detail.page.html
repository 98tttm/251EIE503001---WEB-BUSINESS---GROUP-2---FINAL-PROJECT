<section class="detail" *ngIf="collectionMeta(); else missing">
  <header class="detail-header">
    <div class="title">
      <a class="back" [routerLink]="['/collections', collectionKey()]">
        <span class="material-icon">arrow_back</span>
        Trở về danh sách
      </a>
      <h2>{{ title }}</h2>
      <p>
        {{ collectionMeta()?.description || 'Biểu mẫu quản lý chi tiết' }}
      </p>
    </div>
    <div class="actions">
      <button type="button" class="ghost" (click)="refresh()" [disabled]="loading()">
        <span class="material-icon">refresh</span>
        Tải lại
      </button>
      <button type="button" class="ghost" (click)="formatJson()">
        <span class="material-icon">format_align_left</span>
        Format JSON
      </button>
      <button type="button" class="ghost" (click)="toggleJsonModal(true)">
        <span class="material-icon">code</span>
        Xem JSON
      </button>
      <button
        type="button"
        class="primary"
        (click)="save()"
        [disabled]="saving()"
        *ngIf="isCreate() ? collectionMeta()?.allowCreate : collectionMeta()?.allowUpdate"
      >
        <span class="material-icon">save</span>
        {{ saving() ? 'Đang lưu...' : 'Lưu lại' }}
      </button>
      <button
        type="button"
        class="danger"
        (click)="delete()"
        *ngIf="collectionMeta()?.allowDelete && !isCreate()"
        [disabled]="deleting()"
      >
        <span class="material-icon">delete</span>
        Xóa
      </button>
    </div>
  </header>

  <div class="badges">
    <span class="chip">Collection: {{ collectionKey() }}</span>
    <span class="chip" *ngIf="!isCreate()">ID: {{ documentId() }}</span>
    <span class="chip" [class.active]="collectionMeta()?.allowUpdate">Cập nhật</span>
    <span class="chip" [class.active]="collectionMeta()?.allowDelete">Xóa</span>
  </div>

  <div class="alert" *ngIf="error()">
    <span class="material-icon">error</span>
    {{ error() }}
  </div>

  <div class="layout" [class.product-view]="isProductCollection()" [class.category-view]="isCategoryCollection()" [class.voucher-view]="isPromotionCollection()" [class.banner-view]="isBannerCollection()">
    <article class="preview" *ngIf="document() as doc">
      <!-- Banner View -->
      <ng-container *ngIf="bannerView() as banner">
        <section class="card banner-summary-card">
          <div class="card-header">
            <div class="banner-type-badge">
              <span class="material-icon">image</span>
              <span class="type-text">{{ banner.typeLabel }}</span>
            </div>
            <div class="card-actions">
              <span class="status-badge" [ngClass]="banner.statusClass">
                {{ banner.statusLabel }}
              </span>
              <button type="button" class="primary" (click)="toggleEditDrawer(true)">
                <span class="material-icon">edit_square</span>
                Chỉnh sửa
              </button>
            </div>
          </div>
          <div class="banner-summary-body">
            <h2 class="banner-title">{{ banner.name }}</h2>
            
            <!-- Banner Preview -->
            <div class="banner-preview">
              @if (banner.type === 'hero') {
                <div class="hero-banner-preview">
                  @if (banner.backgroundImage) {
                    <div class="banner-bg" [style.background-image]="'url(' + banner.backgroundImage + ')'"></div>
                  }
                  @if (banner.slideImage) {
                    <img [src]="banner.slideImage" [alt]="banner.name" class="banner-slide-image" />
                  }
                  <div class="banner-content">
                    @if (banner.title) {
                      <h3 class="banner-preview-title">{{ banner.title }}</h3>
                    }
                    @if (banner.subtitle) {
                      <p class="banner-preview-subtitle">{{ banner.subtitle }}</p>
                    }
                    @if (banner.badge1 || banner.badge2) {
                      <div class="banner-badges">
                        @if (banner.badge1) {
                          <span class="badge">{{ banner.badge1.text }} - {{ banner.badge1.discount }}</span>
                        }
                        @if (banner.badge2) {
                          <span class="badge">{{ banner.badge2.text }} - {{ banner.badge2.discount }}</span>
                        }
                      </div>
                    }
                    @if (banner.buttonText) {
                      <button class="banner-button">{{ banner.buttonText }}</button>
                    }
                    @if (banner.dateRange) {
                      <p class="banner-date">{{ banner.dateRange }}</p>
                    }
                  </div>
                </div>
              } @else {
                <div class="simple-banner-preview">
                  @if (banner.image) {
                    <img [src]="banner.image" [alt]="banner.name" class="banner-image" />
                  }
                  @if (banner.title) {
                    <h4 class="banner-preview-title">{{ banner.title }}</h4>
                  }
                  @if (banner.subtitle) {
                    <p class="banner-preview-subtitle">{{ banner.subtitle }}</p>
                  }
                </div>
              }
            </div>

            <dl class="spec-list compact">
              @for (item of banner.specList; track item.label) {
                <div class="spec-item">
                  <dt class="spec-label">{{ item.label }}</dt>
                  <dd class="spec-value" [class.mono]="item.mono">
                    @if (isEditingSpecs() && item.field && specEditFields()[item.field]) {
                      @switch (item.field) {
                        @case ('name') {
                          <input
                            type="text"
                            class="spec-input"
                            [value]="getSpecDraft('name') ?? ''"
                            (input)="setSpecDraft('name', $any($event.target).value)"
                            placeholder="Tên banner"
                          />
                        }
                        @case ('type') {
                          <select
                            class="spec-input"
                            [value]="getSpecDraft('type') ?? ''"
                            (change)="setSpecDraft('type', $any($event.target).value)"
                          >
                            <option value="hero">Hero Banner</option>
                            <option value="feature">Feature Banner</option>
                            <option value="sub">Sub Banner</option>
                            <option value="marketing">Marketing Banner</option>
                          </select>
                        }
                        @case ('position') {
                          <input
                            type="text"
                            class="spec-input"
                            [value]="getSpecDraft('position') ?? ''"
                            (input)="setSpecDraft('position', $any($event.target).value)"
                            placeholder="homepage"
                          />
                        }
                        @case ('order') {
                          <input
                            type="number"
                            class="spec-input"
                            [value]="getSpecDraft('order') ?? 0"
                            (input)="setSpecDraft('order', $any($event.target).value)"
                            min="0"
                            placeholder="0"
                          />
                        }
                        @case ('status') {
                          <select
                            class="spec-input"
                            [value]="getSpecDraft('status') ?? 'active'"
                            (change)="setSpecDraft('status', $any($event.target).value)"
                          >
                            <option value="active">Đang hoạt động</option>
                            <option value="inactive">Không hoạt động</option>
                          </select>
                        }
                        @case ('image') {
                          <input
                            type="text"
                            class="spec-input"
                            [value]="getSpecDraft('image') ?? ''"
                            (input)="setSpecDraft('image', $any($event.target).value)"
                            placeholder="/assets/images/..."
                          />
                        }
                        @case ('title') {
                          <input
                            type="text"
                            class="spec-input"
                            [value]="getSpecDraft('title') ?? ''"
                            (input)="setSpecDraft('title', $any($event.target).value)"
                            placeholder="Tiêu đề"
                          />
                        }
                        @case ('subtitle') {
                          <input
                            type="text"
                            class="spec-input"
                            [value]="getSpecDraft('subtitle') ?? ''"
                            (input)="setSpecDraft('subtitle', $any($event.target).value)"
                            placeholder="Phụ đề"
                          />
                        }
                        @case ('buttonText') {
                          <input
                            type="text"
                            class="spec-input"
                            [value]="getSpecDraft('buttonText') ?? ''"
                            (input)="setSpecDraft('buttonText', $any($event.target).value)"
                            placeholder="MUA NGAY"
                          />
                        }
                        @case ('dateRange') {
                          <input
                            type="text"
                            class="spec-input"
                            [value]="getSpecDraft('dateRange') ?? ''"
                            (input)="setSpecDraft('dateRange', $any($event.target).value)"
                            placeholder="16.10 - 26.10.2025"
                          />
                        }
                        @case ('productId') {
                          <input
                            type="text"
                            class="spec-input"
                            [value]="getSpecDraft('productId') ?? ''"
                            (input)="setSpecDraft('productId', $any($event.target).value)"
                            placeholder="Product ID"
                          />
                        }
                        @case ('link') {
                          <input
                            type="text"
                            class="spec-input"
                            [value]="getSpecDraft('link') ?? ''"
                            (input)="setSpecDraft('link', $any($event.target).value)"
                            placeholder="/product/..."
                          />
                        }
                      }
                    } @else {
                      {{ item.value }}
                    }
                  </dd>
                </div>
              }
            </dl>

            @if (banner.timeline.length > 0) {
              <div class="timeline">
                @for (item of banner.timeline; track item.label) {
                  <div class="timeline-item">
                    <span class="material-icon">{{ item.icon }}</span>
                    <div class="timeline-content">
                      <span class="timeline-label">{{ item.label }}</span>
                      <span class="timeline-value">{{ item.value }}</span>
                    </div>
                  </div>
                }
              </div>
            }
          </div>
        </section>
      </ng-container>
      
      <!-- Voucher View -->
      <ng-container *ngIf="voucherView() as voucher">
        <section class="card voucher-summary-card">
          <div class="card-header">
            <div class="voucher-code-badge">
              <span class="material-icon">confirmation_number</span>
              <span class="code-text">{{ voucher.code }}</span>
            </div>
            <div class="card-actions">
              <span class="status-badge" [ngClass]="voucher.statusClass">
                {{ voucher.status === 'active' ? 'Đang hoạt động' : voucher.status === 'expired' ? 'Đã hết hạn' : voucher.status === 'upcoming' ? 'Sắp diễn ra' : 'Không hoạt động' }}
              </span>
              <button type="button" class="primary" (click)="toggleEditDrawer(true)">
                <span class="material-icon">edit_square</span>
                Chỉnh sửa
              </button>
            </div>
          </div>
          <div class="voucher-summary-body">
            <h2 class="voucher-title">{{ voucher.title }}</h2>
            <div class="voucher-discount">
              @if (voucher.discountPercent > 0) {
                <div class="discount-item">
                  <span class="discount-percent">{{ voucher.discountPercent }}%</span>
                  <span class="discount-label">Giảm giá</span>
                </div>
              }
              @if (voucher.discount && voucher.discount > 0) {
                <div class="discount-item">
                  <span class="discount-amount">{{ voucher.discount | currency: 'VND':'symbol':'1.0-0' }}</span>
                  <span class="discount-label">Giảm giá cố định</span>
                </div>
              }
            </div>
            <div class="voucher-meta-grid">
              <div class="voucher-meta">
                <span class="meta-label">Số lượt sử dụng</span>
                <div class="meta-value">
                  <strong>{{ voucher.usageLabel }}</strong>
                  <div class="usage-progress" *ngIf="voucher.usagePercent !== null">
                    <div class="usage-progress-bar" [style.width.%]="voucher.usagePercent"></div>
                  </div>
                </div>
              </div>
              <div class="voucher-meta">
                <span class="meta-label">Hiệu lực</span>
                <div class="meta-value">
                  <strong>{{ voucher.validityLabel }}</strong>
                  <span class="meta-sub">Trạng thái: {{ voucher.statusLabel }}</span>
                </div>
              </div>
            </div>
            @if (voucher.description) {
              <p class="voucher-description">{{ voucher.description }}</p>
            }
            <div class="voucher-timeline" *ngIf="voucher.timeline.length">
              <div class="timeline-item" *ngFor="let item of voucher.timeline">
                <span class="material-icon">{{ item.icon }}</span>
                <div>
                  <p class="timeline-label">{{ item.label }}</p>
                  <p class="timeline-value">{{ item.value }}</p>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="card voucher-spec-card">
          <div class="card-header">
            <h3>
              <span class="material-icon">info</span>
              Thông tin chi tiết
            </h3>
            <button type="button" class="ghost" (click)="toggleSpecEditMode()" *ngIf="!isEditingSpecs()">
              <span class="material-icon">edit_note</span>
              Chỉnh sửa
            </button>
            <div class="inline-actions" *ngIf="isEditingSpecs()">
              <button type="button" class="ghost" (click)="cancelSpecEdit()">
                <span class="material-icon">close</span>
                Hủy
              </button>
              <button type="button" class="primary" (click)="saveSpecs()">
                <span class="material-icon">save</span>
                Lưu
              </button>
            </div>
          </div>
          <dl class="spec-list">
            @for (item of voucher.specList; track item.label) {
              <div class="spec-item">
                <dt class="spec-label">{{ item.label }}</dt>
                <dd class="spec-value">
                  @if (isEditingSpecs() && item.field && specEditFields()[item.field]) {
                    @switch (item.field) {
                      @case ('code') {
                        <input
                          type="text"
                          class="spec-input"
                          [value]="getSpecDraft('code') ?? ''"
                          (input)="setSpecDraft('code', $any($event.target).value)"
                          placeholder="Nhập mã giảm giá"
                        />
                      }
                      @case ('discountPercent') {
                        <input
                          type="number"
                          class="spec-input"
                          [value]="getSpecDraft('discountPercent') ?? 0"
                          (input)="setSpecDraft('discountPercent', $any($event.target).value)"
                          min="0"
                          max="100"
                          placeholder="0"
                        />
                      }
                      @case ('discount') {
                        <input
                          type="number"
                          class="spec-input"
                          [value]="getSpecDraft('discount') ?? 0"
                          (input)="setSpecDraft('discount', $any($event.target).value)"
                          min="0"
                          placeholder="0"
                        />
                      }
                      @case ('minOrderAmount') {
                        <input
                          type="number"
                          class="spec-input"
                          [value]="getSpecDraft('minOrderAmount') ?? 0"
                          (input)="setSpecDraft('minOrderAmount', $any($event.target).value)"
                          min="0"
                          placeholder="0"
                        />
                      }
                      @case ('maxUsage') {
                        <input
                          type="number"
                          class="spec-input"
                          [value]="getSpecDraft('maxUsage') ?? ''"
                          (input)="setSpecDraft('maxUsage', $any($event.target).value)"
                          min="1"
                          placeholder="Không giới hạn"
                        />
                      }
                      @default {
                        {{ item.value }}
                      }
                    }
                  } @else {
                    {{ item.value }}
                  }
                </dd>
              </div>
            }
          </dl>
        </section>
      </ng-container>

      <!-- Category View -->
      <ng-container *ngIf="categoryView() as category">
        <section class="card category-summary-card enhanced-category-view">
          <div class="card-header category-header">
            <div class="category-title-group">
              <div class="category-icon-large" *ngIf="category.icon">
                <span class="material-icon" *ngIf="!category.icon.startsWith('http')">{{ category.icon }}</span>
                <img *ngIf="category.icon.startsWith('http')" [src]="category.icon" alt="Icon" />
              </div>
              <div class="category-icon-large placeholder" *ngIf="!category.icon">
                <span class="material-icon">{{ category.level === 1 ? 'folder' : (category.level === 2 ? 'folder_open' : 'description') }}</span>
              </div>
              <div class="category-title-content">
                <h3>{{ category.name }}</h3>
                <p class="category-path" *ngIf="category.fullPath">{{ category.fullPath }}</p>
              </div>
            </div>
            <div class="card-actions">
              <span class="level-badge" [class.level-1]="category.level === 1" [class.level-2]="category.level === 2" [class.level-3]="category.level === 3">
                <span class="material-icon">{{ category.level === 1 ? 'looks_one' : (category.level === 2 ? 'looks_two' : 'looks_3') }}</span>
                Cấp {{ category.level }}
              </span>
              <span class="status-badge" [class.active]="category.isActive" [class.inactive]="!category.isActive">
                <span class="material-icon">{{ category.isActive ? 'check_circle' : 'cancel' }}</span>
                {{ category.isActive ? 'Hoạt động' : 'Ẩn' }}
              </span>
            </div>
          </div>
          
          <div class="category-info-grid">
            <div class="info-item full-width" *ngIf="category.id">
              <span class="info-label">
                <span class="material-icon">fingerprint</span>
                ID Danh mục
              </span>
              <span class="info-value mono">{{ category.id }}</span>
            </div>
            
            <div class="info-item full-width">
              <span class="info-label">
                <span class="material-icon">link</span>
                Slug (URL)
              </span>
              <span class="info-value mono" *ngIf="!isEditingSpec('slug')">{{ category.slug || '—' }}</span>
              <input 
                *ngIf="isEditingSpec('slug')" 
                type="text" 
                class="spec-input" 
                [ngModel]="getSpecDraft('slug')" 
                (ngModelChange)="setSpecDraft('slug', $event)"
                placeholder="Nhập slug"
              />
            </div>
            
            <div class="info-item" *ngIf="category.parentName || category.parentId">
              <span class="info-label">
                <span class="material-icon">folder_open</span>
                Danh mục cha
              </span>
              <span class="info-value">{{ category.parentName || category.parentId }}</span>
            </div>
            
            <div class="info-item">
              <span class="info-label">
                <span class="material-icon">sort</span>
                Thứ tự hiển thị
              </span>
              <span class="info-value" *ngIf="!isEditingSpec('displayOrder')">{{ category.displayOrder ?? 'Auto' }}</span>
              <input 
                *ngIf="isEditingSpec('displayOrder')" 
                type="number" 
                class="spec-input" 
                [ngModel]="getSpecDraft('displayOrder')" 
                (ngModelChange)="setSpecDraft('displayOrder', $event)"
                placeholder="Nhập thứ tự"
              />
            </div>
          </div>
          
          <div class="category-actions">
            <button type="button" class="ghost" (click)="toggleEditDrawer(true)">
              <span class="material-icon">edit</span>
              Chỉnh sửa toàn bộ
            </button>
            <button type="button" class="ghost" (click)="toggleSpecEditMode()" *ngIf="!isEditingSpecs()">
              <span class="material-icon">edit_note</span>
              Chỉnh sửa nhanh
            </button>
            <div class="inline-actions" *ngIf="isEditingSpecs()">
              <button type="button" class="ghost" (click)="cancelSpecEdit()">
                <span class="material-icon">close</span>
                Hủy
              </button>
              <button type="button" class="primary" (click)="saveSpecs()">
                <span class="material-icon">save</span>
                Lưu
              </button>
            </div>
          </div>
        </section>

        <section class="card category-detail-card" *ngIf="category.description || isEditing('description')">
          <div class="card-header">
            <h4>
              <span class="material-icon">description</span>
              Mô tả
            </h4>
            <ng-container *ngIf="!isEditing('description'); else editingDescActions">
              <button type="button" class="edit-btn" (click)="startEdit('description')">
                <span class="material-icon">edit_note</span>
                Chỉnh sửa
              </button>
            </ng-container>
            <ng-template #editingDescActions>
              <div class="inline-actions">
                <button type="button" class="ghost" (click)="cancelEdit('description')">
                  <span class="material-icon">close</span>
                  Hủy
                </button>
                <button type="button" class="primary" (click)="applyInline('description')">
                  <span class="material-icon">save</span>
                  Lưu
                </button>
              </div>
            </ng-template>
          </div>
          <div *ngIf="!isEditing('description'); else editDesc" class="rich-text" [innerHTML]="category.description"></div>
          <ng-template #editDesc>
            <textarea class="edit-textarea" rows="6" [ngModel]="getDraft('description')" (ngModelChange)="setDraft('description', $event)" placeholder="Nhập mô tả danh mục..."></textarea>
          </ng-template>
        </section>
      </ng-container>

      <!-- Blog View -->
      <ng-container *ngIf="blogView() as blog">
        <section class="card blog-hero-card">
          <div class="blog-cover" [class.placeholder]="!blog.coverImage">
            <ng-container *ngIf="blog.coverImage; else blogCoverFallback">
              <img [src]="blog.coverImage" [alt]="blog.title" loading="lazy" />
            </ng-container>
            <ng-template #blogCoverFallback>
              <span>{{ (blog.title || 'BV') | slice:0:2 | uppercase }}</span>
            </ng-template>
          </div>
          <div class="blog-hero-content">
            <div class="blog-meta-row">
              <span class="status-badge" [ngClass]="blog.statusClass">{{ blog.statusLabel }}</span>
              <div class="blog-hero-actions">
                <a *ngIf="blog.url" [href]="blog.url" class="outline" target="_blank" rel="noopener">
                  <span class="material-icon">open_in_new</span>
                  Xem bài gốc
                </a>
                <button type="button" class="ghost" (click)="toggleJsonModal(true)">
                  <span class="material-icon">code</span>
                  JSON
                </button>
              </div>
            </div>
            <h2>{{ blog.title }}</h2>
            <p class="blog-headline" *ngIf="blog.headline">{{ blog.headline }}</p>
            <div class="chip-row" *ngIf="blog.categories.length">
              <span class="chip" *ngFor="let cat of blog.categories">{{ cat }}</span>
            </div>
            <div class="tag-list" *ngIf="blog.tags.length">
              <span *ngFor="let tag of blog.tags">#{{ tag }}</span>
            </div>
            <div class="blog-timeline" *ngIf="blog.timeline.length">
              <div class="timeline-item" *ngFor="let item of blog.timeline">
                <span class="material-icon">{{ item.icon }}</span>
                <div>
                  <p class="timeline-label">{{ item.label }}</p>
                  <p class="timeline-value">{{ item.value }}</p>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="card compact-card" *ngIf="blog.specList.length">
          <div class="card-header">
            <h3><span class="material-icon">info</span>Thông tin bài viết</h3>
            @if (!isEditingSpecs()) {
              <button type="button" class="ghost" (click)="toggleSpecEditMode()">
                <span class="material-icon">edit_note</span>
                Chỉnh sửa
              </button>
            } @else {
              <div class="inline-actions">
                <button type="button" class="ghost" (click)="cancelSpecEdit()">
                  <span class="material-icon">close</span>
                  Hủy
                </button>
                <button type="button" class="primary" (click)="saveSpecs()">
                  <span class="material-icon">save</span>
                  Lưu
                </button>
              </div>
            }
          </div>
          <dl class="spec-list compact">
            <div class="spec-item" *ngFor="let item of blog.specList">
              <dt class="spec-label">{{ item.label }}</dt>
              <dd class="spec-value" [class.mono]="item.mono">
                @if (isEditingSpecs() && item.field && specEditFields()[item.field]) {
                  @switch (item.field) {
                    @case ('slug') {
                      <input
                        type="text"
                        class="spec-input"
                        [value]="getSpecDraft('slug') ?? ''"
                        (input)="setSpecDraft('slug', $any($event.target).value)"
                        placeholder="Nhập slug"
                      />
                    }
                    @case ('status') {
                      <select
                        class="spec-input"
                        [value]="getSpecDraft('status') ?? ''"
                        (change)="setSpecDraft('status', $any($event.target).value)"
                      >
                        <option value="published">Đang hiển thị</option>
                        <option value="draft">Bản nháp</option>
                        <option value="pending">Chờ duyệt</option>
                        <option value="scheduled">Đã lên lịch</option>
                        <option value="hidden">Ẩn</option>
                      </select>
                    }
                    @case ('url') {
                      <input
                        type="text"
                        class="spec-input"
                        [value]="getSpecDraft('url') ?? ''"
                        (input)="setSpecDraft('url', $any($event.target).value)"
                        placeholder="https://"
                      />
                    }
                    @case ('originalUrl') {
                      <input
                        type="text"
                        class="spec-input"
                        [value]="getSpecDraft('originalUrl') ?? ''"
                        (input)="setSpecDraft('originalUrl', $any($event.target).value)"
                        placeholder="Nguồn tham khảo"
                      />
                    }
                    @case ('tags') {
                      <textarea
                        class="spec-input"
                        rows="2"
                        [ngModel]="getSpecDraft('tags') ?? ''"
                        (ngModelChange)="setSpecDraft('tags', $event)"
                        placeholder="Nhập từ khóa, cách nhau bởi dấu phẩy"
                      ></textarea>
                    }
                    @default {
                      {{ item.value }}
                    }
                  }
                } @else {
                  {{ item.value }}
                }
              </dd>
            </div>
          </dl>
        </section>

        <section class="card info-card editable-section" *ngIf="blog.shortDescription || isEditing('shortDescription')">
          <div class="card-header">
            <h4>
              <span class="material-icon">segment</span>
              Tóm tắt ngắn
            </h4>
            <ng-container *ngIf="!isEditing('shortDescription'); else blogShortActions">
              <button type="button" class="edit-btn" (click)="startEdit('shortDescription', blog.shortDescription || '')">
                <span class="material-icon">edit_note</span>
                Chỉnh sửa
              </button>
            </ng-container>
            <ng-template #blogShortActions>
              <div class="inline-actions">
                <button type="button" class="ghost" (click)="cancelEdit('shortDescription')">
                  <span class="material-icon">close</span>
                  Hủy
                </button>
                <button type="button" class="primary" (click)="applyInline('shortDescription')">
                  <span class="material-icon">save</span>
                  Lưu
                </button>
              </div>
            </ng-template>
          </div>
          <div *ngIf="!isEditing('shortDescription'); else editBlogShort" class="rich-text">{{ blog.shortDescription }}</div>
          <ng-template #editBlogShort>
            <textarea class="edit-textarea" rows="5" [ngModel]="getDraft('shortDescription')" (ngModelChange)="setDraft('shortDescription', $event)" placeholder="Nhập tóm tắt cho bài viết..."></textarea>
          </ng-template>
        </section>

        <section class="card info-card" *ngIf="blog.content">
          <div class="card-header">
            <h4>
              <span class="material-icon">article</span>
              Nội dung bài viết
            </h4>
            <button type="button" class="ghost" (click)="toggleJsonModal(true)">
              <span class="material-icon">edit_square</span>
              Chỉnh sửa HTML
            </button>
          </div>
          <div class="rich-text large" [innerHTML]="blog.content"></div>
        </section>

        <section class="card info-card author-card" *ngIf="blog.authorName || blog.authorTitle || blog.authorAvatar || blog.originalUrl">
          <div class="card-header">
            <h4>
              <span class="material-icon">person</span>
              Tác giả & biên tập
            </h4>
          </div>
          <div class="author-info">
            <div class="author-avatar" [class.placeholder]="!blog.authorAvatar">
              <ng-container *ngIf="blog.authorAvatar; else authorInitial">
                <img [src]="blog.authorAvatar" [alt]="blog.authorName || 'Tác giả'" loading="lazy" />
              </ng-container>
              <ng-template #authorInitial>
                <span>{{ (blog.authorName || 'TG') | slice:0:2 | uppercase }}</span>
              </ng-template>
            </div>
            <div>
              <p class="author-name">{{ blog.authorName || 'Không rõ' }}</p>
              <p class="author-title" *ngIf="blog.authorTitle">{{ blog.authorTitle }}</p>
              <p class="author-link" *ngIf="blog.originalUrl">
                <a [href]="blog.originalUrl" target="_blank" rel="noopener">
                  Nguồn tham khảo
                  <span class="material-icon">open_in_new</span>
                </a>
              </p>
            </div>
          </div>
        </section>
      </ng-container>

      <!-- Disease View -->
      <ng-container *ngIf="diseaseView() as disease">
        <section class="card disease-summary-card">
          <div class="disease-header">
            <div class="disease-cover" [class.placeholder]="!disease.coverImage">
              <ng-container *ngIf="disease.coverImage; else diseaseInitial">
                <img [src]="disease.coverImage" [alt]="disease.name" loading="lazy" />
              </ng-container>
              <ng-template #diseaseInitial>
                <span>{{ (disease.name || 'BL') | slice:0:2 | uppercase }}</span>
              </ng-template>
            </div>
            <div class="disease-title">
              <div class="badge-row">
                <span class="status-badge" [ngClass]="disease.statusClass">{{ disease.statusLabel }}</span>
              </div>
              <h2>{{ disease.name }}</h2>
              <p class="disease-headline" *ngIf="disease.headline">{{ disease.headline }}</p>
              <div class="chip-row" *ngIf="disease.categories.length">
                <span class="chip" *ngFor="let cat of disease.categories">{{ cat }}</span>
              </div>
              <div class="chip-row alt" *ngIf="disease.alternateNames.length">
                <span class="chip alt" *ngFor="let alias of disease.alternateNames">{{ alias }}</span>
              </div>
              <div class="disease-links">
                <a *ngIf="disease.url" [href]="disease.url" target="_blank" rel="noopener">
                  <span class="material-icon">open_in_new</span>
                  Xem trang chi tiết
                </a>
                <button type="button" class="ghost" (click)="toggleJsonModal(true)">
                  <span class="material-icon">code</span>
                  JSON
                </button>
              </div>
            </div>
          </div>
          <div class="disease-timeline" *ngIf="disease.timeline.length">
            <div class="timeline-item" *ngFor="let item of disease.timeline">
              <span class="material-icon">{{ item.icon }}</span>
              <div>
                <p class="timeline-label">{{ item.label }}</p>
                <p class="timeline-value">{{ item.value }}</p>
              </div>
            </div>
          </div>
        </section>

        <section class="card compact-card" *ngIf="disease.specList.length">
          <div class="card-header">
            <h3><span class="material-icon">healing</span>Thông tin bệnh lý</h3>
            @if (!isEditingSpecs()) {
              <button type="button" class="ghost" (click)="toggleSpecEditMode()">
                <span class="material-icon">edit_note</span>
                Chỉnh sửa
              </button>
            } @else {
              <div class="inline-actions">
                <button type="button" class="ghost" (click)="cancelSpecEdit()">
                  <span class="material-icon">close</span>
                  Hủy
                </button>
                <button type="button" class="primary" (click)="saveSpecs()">
                  <span class="material-icon">save</span>
                  Lưu
                </button>
              </div>
            }
          </div>
          <dl class="spec-list compact">
            <div class="spec-item" *ngFor="let item of disease.specList">
              <dt class="spec-label">{{ item.label }}</dt>
              <dd class="spec-value">
                @if (isEditingSpecs() && item.field && specEditFields()[item.field]) {
                  @switch (item.field) {
                    @case ('slug') {
                      <input
                        type="text"
                        class="spec-input"
                        [value]="getSpecDraft('slug') ?? ''"
                        (input)="setSpecDraft('slug', $any($event.target).value)"
                        placeholder="Nhập slug"
                      />
                    }
                    @case ('isVisible') {
                      <select
                        class="spec-input"
                        [value]="getSpecDraft('isVisible') === 'false' ? 'false' : 'true'"
                        (change)="setSpecDraft('isVisible', $any($event.target).value)"
                      >
                        <option value="true">Đang hiển thị</option>
                        <option value="false">Đang ẩn</option>
                      </select>
                    }
                    @case ('url') {
                      <input
                        type="text"
                        class="spec-input"
                        [value]="getSpecDraft('url') ?? ''"
                        (input)="setSpecDraft('url', $any($event.target).value)"
                        placeholder="https://"
                      />
                    }
                    @case ('originalUrl') {
                      <input
                        type="text"
                        class="spec-input"
                        [value]="getSpecDraft('originalUrl') ?? ''"
                        (input)="setSpecDraft('originalUrl', $any($event.target).value)"
                        placeholder="Nguồn tham khảo"
                      />
                    }
                    @default {
                      {{ item.value }}
                    }
                  }
                } @else {
                  {{ item.value }}
                }
              </dd>
            </div>
          </dl>
        </section>

        <section class="card info-card editable-section" *ngIf="disease.summary || isEditing('summary')">
          <div class="card-header">
            <h4>
              <span class="material-icon">description</span>
              Tổng quan
            </h4>
            <ng-container *ngIf="!isEditing('summary'); else diseaseSummaryActions">
              <button type="button" class="edit-btn" (click)="startEdit('summary', disease.summary || '')">
                <span class="material-icon">edit_note</span>
                Chỉnh sửa
              </button>
            </ng-container>
            <ng-template #diseaseSummaryActions>
              <div class="inline-actions">
                <button type="button" class="ghost" (click)="cancelEdit('summary')">
                  <span class="material-icon">close</span>
                  Hủy
                </button>
                <button type="button" class="primary" (click)="applyInline('summary')">
                  <span class="material-icon">save</span>
                  Lưu
                </button>
              </div>
            </ng-template>
          </div>
          <div *ngIf="!isEditing('summary'); else editDiseaseSummary" class="rich-text" [innerHTML]="disease.summary"></div>
          <ng-template #editDiseaseSummary>
            <textarea class="edit-textarea" rows="6" [ngModel]="getDraft('summary')" (ngModelChange)="setDraft('summary', $event)" placeholder="Nhập mô tả tóm tắt bệnh lý..."></textarea>
          </ng-template>
        </section>

        <section class="card info-card editable-section" *ngIf="disease.symptoms || isEditing('symptoms')">
          <div class="card-header">
            <h4>
              <span class="material-icon">coronavirus</span>
              Triệu chứng
            </h4>
            <ng-container *ngIf="!isEditing('symptoms'); else diseaseSymptomActions">
              <button type="button" class="edit-btn" (click)="startEdit('symptoms', disease.symptoms || '')">
                <span class="material-icon">edit_note</span>
                Chỉnh sửa
              </button>
            </ng-container>
            <ng-template #diseaseSymptomActions>
              <div class="inline-actions">
                <button type="button" class="ghost" (click)="cancelEdit('symptoms')">
                  <span class="material-icon">close</span>
                  Hủy
                </button>
                <button type="button" class="primary" (click)="applyInline('symptoms')">
                  <span class="material-icon">save</span>
                  Lưu
                </button>
              </div>
            </ng-template>
          </div>
          <div *ngIf="!isEditing('symptoms'); else editDiseaseSymptom" class="rich-text" [innerHTML]="disease.symptoms"></div>
          <ng-template #editDiseaseSymptom>
            <textarea class="edit-textarea" rows="6" [ngModel]="getDraft('symptoms')" (ngModelChange)="setDraft('symptoms', $event)" placeholder="Nhập triệu chứng điển hình..."></textarea>
          </ng-template>
        </section>

        <section class="card info-card editable-section" *ngIf="disease.causes || isEditing('causes')">
          <div class="card-header">
            <h4>
              <span class="material-icon">biotech</span>
              Nguyên nhân
            </h4>
            <ng-container *ngIf="!isEditing('causes'); else diseaseCauseActions">
              <button type="button" class="edit-btn" (click)="startEdit('causes', disease.causes || '')">
                <span class="material-icon">edit_note</span>
                Chỉnh sửa
              </button>
            </ng-container>
            <ng-template #diseaseCauseActions>
              <div class="inline-actions">
                <button type="button" class="ghost" (click)="cancelEdit('causes')">
                  <span class="material-icon">close</span>
                  Hủy
                </button>
                <button type="button" class="primary" (click)="applyInline('causes')">
                  <span class="material-icon">save</span>
                  Lưu
                </button>
              </div>
            </ng-template>
          </div>
          <div *ngIf="!isEditing('causes'); else editDiseaseCauses" class="rich-text" [innerHTML]="disease.causes"></div>
          <ng-template #editDiseaseCauses>
            <textarea class="edit-textarea" rows="6" [ngModel]="getDraft('causes')" (ngModelChange)="setDraft('causes', $event)" placeholder="Nhập nguyên nhân gây bệnh..."></textarea>
          </ng-template>
        </section>

        <section class="card info-card editable-section" *ngIf="disease.treatment || isEditing('treatment')">
          <div class="card-header">
            <h4>
              <span class="material-icon">local_hospital</span>
              Điều trị
            </h4>
            <ng-container *ngIf="!isEditing('treatment'); else diseaseTreatmentActions">
              <button type="button" class="edit-btn" (click)="startEdit('treatment', disease.treatment || '')">
                <span class="material-icon">edit_note</span>
                Chỉnh sửa
              </button>
            </ng-container>
            <ng-template #diseaseTreatmentActions>
              <div class="inline-actions">
                <button type="button" class="ghost" (click)="cancelEdit('treatment')">
                  <span class="material-icon">close</span>
                  Hủy
                </button>
                <button type="button" class="primary" (click)="applyInline('treatment')">
                  <span class="material-icon">save</span>
                  Lưu
                </button>
              </div>
            </ng-template>
          </div>
          <div *ngIf="!isEditing('treatment'); else editDiseaseTreatment" class="rich-text" [innerHTML]="disease.treatment"></div>
          <ng-template #editDiseaseTreatment>
            <textarea class="edit-textarea" rows="6" [ngModel]="getDraft('treatment')" (ngModelChange)="setDraft('treatment', $event)" placeholder="Nhập phác đồ điều trị..."></textarea>
          </ng-template>
        </section>

        <section class="card info-card editable-section" *ngIf="disease.prevention || isEditing('prevention')">
          <div class="card-header">
            <h4>
              <span class="material-icon">health_and_safety</span>
              Phòng ngừa
            </h4>
            <ng-container *ngIf="!isEditing('prevention'); else diseasePreventionActions">
              <button type="button" class="edit-btn" (click)="startEdit('prevention', disease.prevention || '')">
                <span class="material-icon">edit_note</span>
                Chỉnh sửa
              </button>
            </ng-container>
            <ng-template #diseasePreventionActions>
              <div class="inline-actions">
                <button type="button" class="ghost" (click)="cancelEdit('prevention')">
                  <span class="material-icon">close</span>
                  Hủy
                </button>
                <button type="button" class="primary" (click)="applyInline('prevention')">
                  <span class="material-icon">save</span>
                  Lưu
                </button>
              </div>
            </ng-template>
          </div>
          <div *ngIf="!isEditing('prevention'); else editDiseasePrevention" class="rich-text" [innerHTML]="disease.prevention"></div>
          <ng-template #editDiseasePrevention>
            <textarea class="edit-textarea" rows="6" [ngModel]="getDraft('prevention')" (ngModelChange)="setDraft('prevention', $event)" placeholder="Nhập khuyến nghị phòng bệnh..."></textarea>
          </ng-template>
        </section>

        <section class="card info-card editable-section" *ngIf="disease.notes || isEditing('notes')">
          <div class="card-header">
            <h4>
              <span class="material-icon">info</span>
              Ghi chú bổ sung
            </h4>
            <ng-container *ngIf="!isEditing('notes'); else diseaseNotesActions">
              <button type="button" class="edit-btn" (click)="startEdit('notes', disease.notes || '')">
                <span class="material-icon">edit_note</span>
                Chỉnh sửa
              </button>
            </ng-container>
            <ng-template #diseaseNotesActions>
              <div class="inline-actions">
                <button type="button" class="ghost" (click)="cancelEdit('notes')">
                  <span class="material-icon">close</span>
                  Hủy
                </button>
                <button type="button" class="primary" (click)="applyInline('notes')">
                  <span class="material-icon">save</span>
                  Lưu
                </button>
              </div>
            </ng-template>
          </div>
          <div *ngIf="!isEditing('notes'); else editDiseaseNotes" class="rich-text" [innerHTML]="disease.notes"></div>
          <ng-template #editDiseaseNotes>
            <textarea class="edit-textarea" rows="5" [ngModel]="getDraft('notes')" (ngModelChange)="setDraft('notes', $event)" placeholder="Nhập ghi chú bổ sung..."></textarea>
          </ng-template>
        </section>
      </ng-container>

      <!-- User View -->
      <ng-container *ngIf="userView() as user">
        <section class="card user-summary-card">
          <div class="user-info">
            <div class="user-avatar" [class.placeholder]="!user.avatar">
              <ng-container *ngIf="user.avatar; else userAvatarFallback">
                <img [src]="user.avatar" [alt]="user.displayName" loading="lazy" />
              </ng-container>
              <ng-template #userAvatarFallback>
                <span>{{ user.displayName | slice:0:2 | uppercase }}</span>
              </ng-template>
            </div>
            <div>
              <h2>{{ user.displayName }}</h2>
              <div class="badge-row">
                <span class="status-badge" [ngClass]="user.statusClass">{{ user.statusLabel }}</span>
              </div>
              <div class="user-contacts">
                <p *ngIf="user.email">
                  <span class="material-icon">email</span>
                  {{ user.email }}
                </p>
                <p *ngIf="user.phone">
                  <span class="material-icon">call</span>
                  {{ user.phone }}
                </p>
              </div>
              <div class="chip-row" *ngIf="user.roles.length">
                <span class="chip info" *ngFor="let role of user.roles">{{ role }}</span>
              </div>
            </div>
            <div class="user-summary-actions">
              <button type="button" class="ghost" (click)="toggleJsonModal(true)">
                <span class="material-icon">code</span>
                JSON
              </button>
            </div>
          </div>
          <div class="user-timeline" *ngIf="user.timeline.length">
            <div class="timeline-item" *ngFor="let item of user.timeline">
              <span class="material-icon">{{ item.icon }}</span>
              <div>
                <p class="timeline-label">{{ item.label }}</p>
                <p class="timeline-value">{{ item.value }}</p>
              </div>
            </div>
          </div>
        </section>

        <section class="card compact-card" *ngIf="user.specList.length">
          <div class="card-header">
            <h3><span class="material-icon">assignment_ind</span>Thông tin tài khoản</h3>
            @if (!isEditingSpecs()) {
              <button type="button" class="ghost" (click)="toggleSpecEditMode()">
                <span class="material-icon">edit_note</span>
                Chỉnh sửa
              </button>
            } @else {
              <div class="inline-actions">
                <button type="button" class="ghost" (click)="cancelSpecEdit()">
                  <span class="material-icon">close</span>
                  Hủy
                </button>
                <button type="button" class="primary" (click)="saveSpecs()">
                  <span class="material-icon">save</span>
                  Lưu
                </button>
              </div>
            }
          </div>
          <dl class="spec-list compact">
            <div class="spec-item" *ngFor="let item of user.specList">
              <dt class="spec-label">{{ item.label }}</dt>
              <dd class="spec-value" [class.mono]="item.mono">
                @if (isEditingSpecs() && item.field && specEditFields()[item.field]) {
                  @switch (item.field) {
                    @case ('mail') {
                      <input
                        type="email"
                        class="spec-input"
                        [value]="getSpecDraft('mail') ?? ''"
                        (input)="setSpecDraft('mail', $any($event.target).value)"
                        placeholder="Email người dùng"
                      />
                    }
                    @case ('phone') {
                      <input
                        type="text"
                        class="spec-input"
                        [value]="getSpecDraft('phone') ?? ''"
                        (input)="setSpecDraft('phone', $any($event.target).value)"
                        placeholder="Số điện thoại"
                      />
                    }
                    @case ('roles') {
                      <input
                        type="text"
                        class="spec-input"
                        [value]="getSpecDraft('roles') ?? ''"
                        (input)="setSpecDraft('roles', $any($event.target).value)"
                        placeholder="role1, role2"
                      />
                    }
                    @case ('status') {
                      <select
                        class="spec-input"
                        [value]="getSpecDraft('status') ?? ''"
                        (change)="setSpecDraft('status', $any($event.target).value)"
                      >
                        <option value="active">Hoạt động</option>
                        <option value="inactive">Khoá</option>
                        <option value="pending">Chờ xác minh</option>
                        <option value="deleted">Đã xóa</option>
                      </select>
                    }
                    @case ('gender') {
                      <select
                        class="spec-input"
                        [value]="getSpecDraft('gender') ?? ''"
                        (change)="setSpecDraft('gender', $any($event.target).value)"
                      >
                        <option value="">--</option>
                        <option value="male">Nam</option>
                        <option value="female">Nữ</option>
                        <option value="other">Khác</option>
                      </select>
                    }
                    @case ('birthday') {
                      <input
                        type="date"
                        class="spec-input"
                        [value]="getSpecDraft('birthday') ?? ''"
                        (input)="setSpecDraft('birthday', $any($event.target).value)"
                      />
                    }
                    @case ('address') {
                      <textarea
                        class="spec-input"
                        rows="2"
                        [ngModel]="getSpecDraft('address') ?? ''"
                        (ngModelChange)="setSpecDraft('address', $event)"
                        placeholder="Địa chỉ liên hệ"
                      ></textarea>
                    }
                    @default {
                      {{ item.value }}
                    }
                  }
                } @else {
                  {{ item.value }}
                }
              </dd>
            </div>
          </dl>
        </section>

        <section class="card info-card editable-section" *ngIf="user.notes || isEditing('notes')">
          <div class="card-header">
            <h4>
              <span class="material-icon">sticky_note_2</span>
              Ghi chú nội bộ
            </h4>
            <ng-container *ngIf="!isEditing('notes'); else userNotesActions">
              <button type="button" class="edit-btn" (click)="startEdit('notes', user.notes || '')">
                <span class="material-icon">edit_note</span>
                Chỉnh sửa
              </button>
            </ng-container>
            <ng-template #userNotesActions>
              <div class="inline-actions">
                <button type="button" class="ghost" (click)="cancelEdit('notes')">
                  <span class="material-icon">close</span>
                  Hủy
                </button>
                <button type="button" class="primary" (click)="applyInline('notes')">
                  <span class="material-icon">save</span>
                  Lưu
                </button>
              </div>
            </ng-template>
          </div>
          <div *ngIf="!isEditing('notes'); else editUserNotes" class="rich-text">{{ user.notes }}</div>
          <ng-template #editUserNotes>
            <textarea class="edit-textarea" rows="5" [ngModel]="getDraft('notes')" (ngModelChange)="setDraft('notes', $event)" placeholder="Nhập ghi chú quản trị..."></textarea>
          </ng-template>
        </section>
      </ng-container>

      <!-- Order View -->
      <ng-container *ngIf="orderView() as order">
        <section class="card order-summary-card">
          <div class="order-header">
            <div class="order-header-content">
              <h2>{{ order.orderNumber }}</h2>
              <span class="order-status-badge" [ngClass]="order.statusClass">{{ order.statusLabel }}</span>
            </div>
            <div class="order-header-actions">
              <button type="button" class="primary" (click)="openConfirmOrderModal()" *ngIf="order.statusClass === 'pending'">
                <span class="material-icon">check_circle</span>
                Xác nhận đơn hàng
              </button>
              <button type="button" class="success" (click)="approveReturnRequest()" *ngIf="order.statusClass === 'return_requested'">
                <span class="material-icon">check_circle</span>
                Chấp nhận trả hàng
              </button>
              <button type="button" class="danger" (click)="rejectReturnRequest()" *ngIf="order.statusClass === 'return_requested'">
                <span class="material-icon">close</span>
                Từ chối trả hàng
              </button>
              <button type="button" class="ghost" (click)="toggleJsonModal(true)">
                <span class="material-icon">code</span>
                JSON
              </button>
            </div>
          </div>

          <div class="order-timeline" *ngIf="order.timeline.length">
            <div class="timeline-item" *ngFor="let item of order.timeline" [ngClass]="item.class">
              <span class="material-icon">{{ item.icon }}</span>
              <div>
                <p class="timeline-label">{{ item.label }}</p>
                <p class="timeline-value">{{ item.value }}</p>
              </div>
            </div>
          </div>
        </section>

        <div class="order-grid">
          <section class="card customer-card">
            <div class="card-header">
              <h3><span class="material-icon">person</span>Thông tin khách hàng</h3>
            </div>
            <div class="customer-details">
              <div class="customer-field">
                <span class="field-label">Họ tên</span>
                <span class="field-value">{{ order.customerName }}</span>
              </div>
              <div class="customer-field">
                <span class="field-label">Số điện thoại</span>
                <span class="field-value mono">{{ order.customerPhone }}</span>
              </div>
              <div class="customer-field" *ngIf="order.customerEmail">
                <span class="field-label">Email</span>
                <span class="field-value mono">{{ order.customerEmail }}</span>
              </div>
            </div>
          </section>

          <section class="card address-card">
            <div class="card-header">
              <h3><span class="material-icon">location_on</span>Địa chỉ giao hàng</h3>
            </div>
            <div class="address-content">
              <p *ngFor="let line of order.shippingAddress">{{ line }}</p>
              <p *ngIf="!order.shippingAddress.length" class="empty-text">Chưa có địa chỉ</p>
            </div>
          </section>
        </div>

        <section class="card order-items-card">
          <div class="card-header">
            <h3><span class="material-icon">shopping_basket</span>Sản phẩm ({{ order.items.length }})</h3>
          </div>
          <div class="order-items-table">
            <table>
              <thead>
                <tr>
                  <th class="product-col">Sản phẩm</th>
                  <th class="qty-col">Số lượng</th>
                  <th class="price-col">Đơn giá</th>
                  <th class="discount-col">Giảm</th>
                  <th class="total-col">Thành tiền</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of order.items">
                  <td class="product-info">
                    <div class="product-row">
                      <div class="product-img" *ngIf="item.productImage">
                        <img [src]="item.productImage" [alt]="item.productName" />
                      </div>
                      <div class="product-text">
                        <div class="product-name">{{ item.productName }}</div>
                        <div class="product-id mono" *ngIf="item.productId">ID: {{ item.productId }}</div>
                      </div>
                    </div>
                  </td>
                  <td class="qty">{{ item.quantity }}</td>
                  <td class="price">{{ item.unitPrice | currency:'VND':'symbol':'1.0-0' }}</td>
                  <td class="discount">{{ item.discount > 0 ? '-' + (item.discount | currency:'VND':'symbol':'1.0-0') : '—' }}</td>
                  <td class="total">{{ item.subtotal | currency:'VND':'symbol':'1.0-0' }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <div class="order-grid">
          <section class="card payment-card">
            <div class="card-header">
              <h3><span class="material-icon">payments</span>Thanh toán</h3>
            </div>
            <dl class="spec-list compact">
              <div class="spec-item">
                <dt>Phương thức</dt>
                <dd>{{ order.paymentMethodLabel }}</dd>
              </div>
              <div class="spec-item">
                <dt>Trạng thái</dt>
                <dd>
                  <span class="payment-status-badge" [class.paid]="order.paymentStatus === 'paid'" [class.unpaid]="order.paymentStatus === 'unpaid'">
                    {{ order.paymentStatusLabel }}
                  </span>
                </dd>
              </div>
              <div class="spec-item">
                <dt>Xuất hóa đơn</dt>
                <dd>{{ order.requireInvoice ? 'Có' : 'Không' }}</dd>
              </div>
            </dl>
          </section>

          <section class="card pricing-card">
            <div class="card-header">
              <h3><span class="material-icon">calculate</span>Tổng kết</h3>
            </div>
            <dl class="pricing-list">
              <div class="pricing-item" *ngFor="let line of order.pricingLines">
                <dt>{{ line.label }}</dt>
                <dd [class.discount]="line.amount < 0" [class.charge]="line.amount > 0">
                  <ng-container *ngIf="line.amount === 0">0 ₫</ng-container>
                  <ng-container *ngIf="line.amount !== 0">
                    <span *ngIf="line.amount < 0">-</span>{{ (line.amount < 0 ? -line.amount : line.amount) | currency:'VND':'symbol':'1.0-0' }}
                  </ng-container>
                </dd>
              </div>
              <div class="pricing-item total">
                <dt>Tổng cộng</dt>
                <dd>{{ order.pricing.total | currency:'VND':'symbol':'1.0-0' }}</dd>
              </div>
            </dl>
          </section>
        </div>

        <section class="card cancel-reason-card" *ngIf="order.statusClass === 'cancelled' && order.cancelReason">
          <div class="card-header">
            <h3><span class="material-icon">cancel</span>Lý do hủy đơn</h3>
          </div>
          <div class="cancel-reason-content">
            <p>{{ order.cancelReason }}</p>
          </div>
        </section>

        <section class="card return-request-card" *ngIf="(order.statusClass === 'return_requested' || order.statusClass === 'returned') && order.returnReason">
          <div class="card-header">
            <h3>
              <span class="material-icon">assignment_return</span>
              {{ order.statusClass === 'return_requested' ? 'Yêu cầu trả hàng' : 'Đã trả hàng' }}
            </h3>
            <div class="return-request-badge" *ngIf="order.statusClass === 'return_requested'">
              <span class="status-badge return_requested">Chờ xử lý</span>
            </div>
          </div>
          <div class="return-request-content">
            <div class="return-info-item" *ngIf="order.returnRequestedAt">
              <span class="info-label">Ngày yêu cầu:</span>
              <span class="info-value">{{ order.returnRequestedAt }}</span>
            </div>
            <div class="return-info-item">
              <span class="info-label">Lý do trả hàng:</span>
              <span class="info-value">{{ order.returnReason }}</span>
            </div>
          </div>
        </section>

        <section class="card order-notes-card" *ngIf="order.notes">
          <div class="card-header">
            <h3><span class="material-icon">chat</span>Ghi chú khách hàng</h3>
          </div>
          <div class="note-content">{{ order.notes }}</div>
        </section>

        <section class="card admin-notes-card" *ngIf="order.adminNotes || isEditing('adminNotes')">
          <div class="card-header">
            <h4>
              <span class="material-icon">sticky_note_2</span>
              Ghi chú nội bộ
            </h4>
            <ng-container *ngIf="!isEditing('adminNotes'); else adminNotesActions">
              <button type="button" class="edit-btn" (click)="startEdit('adminNotes', order.adminNotes || '')">
                <span class="material-icon">edit_note</span>
                Chỉnh sửa
              </button>
            </ng-container>
            <ng-template #adminNotesActions>
              <div class="inline-actions">
                <button type="button" class="ghost" (click)="cancelEdit('adminNotes')">
                  <span class="material-icon">close</span>
                  Hủy
                </button>
                <button type="button" class="primary" (click)="applyInlineOrder('adminNotes')">
                  <span class="material-icon">save</span>
                  Lưu
                </button>
              </div>
            </ng-template>
          </div>
          <div *ngIf="!isEditing('adminNotes'); else editAdminNotes" class="rich-text">{{ order.adminNotes }}</div>
          <ng-template #editAdminNotes>
            <textarea class="edit-textarea" rows="4" [ngModel]="getDraft('adminNotes')" (ngModelChange)="setDraft('adminNotes', $event)" placeholder="Nhập ghi chú quản trị..."></textarea>
          </ng-template>
        </section>

        <section class="card compact-card">
          <div class="card-header">
            <h3><span class="material-icon">info</span>Chi tiết đơn hàng</h3>
          </div>
          <dl class="spec-list compact">
            <div class="spec-item" *ngFor="let item of order.specList">
              <dt class="spec-label">{{ item.label }}</dt>
              <dd class="spec-value" [class.mono]="item.mono">{{ item.value }}</dd>
            </div>
          </dl>
        </section>
      </ng-container>

      <ng-container *ngIf="pharmacistChatView() as chat">
        <section class="card chat-summary-card">
          <div class="chat-summary-header">
            <div>
              <h2>{{ chat.customerName }}</h2>
              <p class="chat-subtitle">Cuộc trò chuyện tư vấn dược sĩ</p>
            </div>
            <div class="chat-summary-meta">
              <span class="chat-status" [ngClass]="chat.statusClass">{{ chat.statusLabel }}</span>
              <div class="chat-timestamps">
                <span><span class="material-icon">schedule</span>{{ chat.createdAt || '—' }}</span>
                <span *ngIf="chat.lastMessageAt"><span class="material-icon">chat</span>Lần cuối: {{ chat.lastMessageAt }}</span>
              </div>
            </div>
          </div>
        </section>

        <div class="chat-layout">
          <section class="card chat-info-card">
            <div class="card-header">
              <h3><span class="material-icon">person</span>Khách hàng</h3>
            </div>
            <dl class="spec-list compact">
              <div class="spec-item">
                <dt>Họ tên</dt>
                <dd>{{ chat.customerName }}</dd>
              </div>
              <div class="spec-item" *ngIf="chat.customerPhone">
                <dt>Số điện thoại</dt>
                <dd class="mono">{{ chat.customerPhone }}</dd>
              </div>
              <div class="spec-item">
                <dt>Trạng thái</dt>
                <dd><span class="chat-status" [ngClass]="chat.statusClass">{{ chat.statusLabel }}</span></dd>
              </div>
              <div class="spec-item">
                <dt>Tạo lúc</dt>
                <dd>{{ chat.createdAt || '—' }}</dd>
              </div>
              <div class="spec-item">
                <dt>Cập nhật</dt>
                <dd>{{ chat.updatedAt || '—' }}</dd>
              </div>
            </dl>
          </section>

          <section class="card chat-window-card">
            <div class="chat-window-header">
              <div>
                <h3><span class="material-icon">forum</span>Hộp thoại</h3>
                <p *ngIf="chat.lastMessageAt" class="chat-window-sub">Lần tương tác gần nhất: {{ chat.lastMessageAt }}</p>
              </div>
            </div>
            <div class="chat-messages" #pharmacistChatMessages>
              <div class="empty-chat" *ngIf="!chat.messages.length">Chưa có tin nhắn nào.</div>
              <div
                class="chat-message"
                *ngFor="let message of chat.messages"
                [ngClass]="{
                  'from-pharmacist': message.isPharmacist,
                  'from-user': !message.isPharmacist && !message.isSystem,
                  'system-message': message.isSystem
                }"
              >
                <div class="message-meta">
                  <span class="sender">{{ message.senderLabel }}</span>
                  <span class="timestamp">{{ message.timestamp || '—' }}</span>
                </div>
                <div class="message-body">{{ message.content }}</div>
              </div>
            </div>

            <form class="chat-input" (ngSubmit)="sendPharmacistReply()">
              <textarea
                name="pharmacistReply"
                rows="2"
                placeholder="Nhập nội dung phản hồi..."
                [ngModel]="pharmacistReplyDraft()"
                (ngModelChange)="pharmacistReplyDraft.set($event)"
                [disabled]="sendingPharmacistReply()"
              ></textarea>
              <div class="chat-input-actions">
                <button type="submit" class="primary" [disabled]="sendingPharmacistReply() || !pharmacistReplyDraft().trim()">
                  <ng-container *ngIf="!sendingPharmacistReply(); else sendingSpinner">
                    <span class="material-icon">send</span>
                    Gửi
                  </ng-container>
                </button>
                <ng-template #sendingSpinner>
                  <span class="spinner"></span>
                </ng-template>
              </div>
            </form>
          </section>
        </div>
      </ng-container>

      <ng-container *ngIf="tuvanThuocView() as tuvan">
        <section class="card tuvan-summary-card">
          <div class="tuvan-summary-header">
            <div>
              <h2>{{ tuvan.fullName }}</h2>
              <p class="tuvan-subtitle">Yêu cầu tư vấn thuốc</p>
            </div>
            <div class="tuvan-summary-meta">
              <span class="status-badge" [ngClass]="tuvan.statusClass">{{ tuvan.statusLabel }}</span>
              <div class="tuvan-timestamps">
                <span><span class="material-icon">schedule</span>{{ tuvan.createdAt || '—' }}</span>
                <span *ngIf="tuvan.updatedAt"><span class="material-icon">update</span>Cập nhật: {{ tuvan.updatedAt }}</span>
              </div>
            </div>
          </div>
        </section>

        <div class="tuvan-layout">
          <section class="card tuvan-info-card">
            <div class="card-header">
              <h3><span class="material-icon">person</span>Thông tin khách hàng</h3>
            </div>
            <dl class="spec-list compact">
              <div class="spec-item" *ngIf="tuvan.userId">
                <dt>ID Người dùng</dt>
                <dd class="mono">{{ tuvan.userId }}</dd>
              </div>
              <div class="spec-item">
                <dt>Họ và tên</dt>
                <dd>{{ tuvan.fullName }}</dd>
              </div>
              <div class="spec-item">
                <dt>Số điện thoại</dt>
                <dd class="mono">{{ tuvan.phoneNumber }}</dd>
              </div>
              <div class="spec-item">
                <dt>Trạng thái</dt>
                <dd><span class="status-badge" [ngClass]="tuvan.statusClass">{{ tuvan.statusLabel }}</span></dd>
              </div>
              <div class="spec-item" *ngIf="tuvan.notes">
                <dt>Ghi chú</dt>
                <dd>{{ tuvan.notes }}</dd>
              </div>
              <div class="spec-item">
                <dt>Ngày tạo</dt>
                <dd>{{ tuvan.createdAt || '—' }}</dd>
              </div>
              <div class="spec-item">
                <dt>Cập nhật lần cuối</dt>
                <dd>{{ tuvan.updatedAt || '—' }}</dd>
              </div>
            </dl>
          </section>

          <section class="card tuvan-content-card">
            <div class="card-header">
              <h3><span class="material-icon">medication</span>Thông tin yêu cầu</h3>
            </div>
            
            <div class="tuvan-section" *ngIf="tuvan.prescriptionImages.length > 0">
              <h4><span class="material-icon">image</span>Ảnh đơn thuốc ({{ tuvan.prescriptionImages.length }})</h4>
              <div class="prescription-images-grid">
                <div class="prescription-image-item" *ngFor="let img of tuvan.prescriptionImages; let i = index">
                  <img [src]="img" [alt]="'Đơn thuốc ' + (i + 1)" (click)="openImageInNewTab(img)" loading="lazy" style="cursor: pointer;" />
                  <div class="image-overlay">
                    <button type="button" class="view-btn" (click)="openImageInNewTab(img)">
                      <span class="material-icon">zoom_in</span>
                      Xem lớn
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div class="tuvan-section" *ngIf="tuvan.medicineNames.length > 0">
              <h4><span class="material-icon">medication_liquid</span>Danh sách thuốc ({{ tuvan.medicineNames.length }})</h4>
              <div class="medicine-names-list">
                <div class="medicine-name-item" *ngFor="let medicine of tuvan.medicineNames">
                  <span class="material-icon">medication</span>
                  <span>{{ medicine }}</span>
                </div>
              </div>
            </div>

            <div class="tuvan-section" *ngIf="tuvan.prescriptionImages.length === 0 && tuvan.medicineNames.length === 0">
              <p class="empty-state">Chưa có thông tin đơn thuốc hoặc danh sách thuốc.</p>
            </div>
          </section>
        </div>

        <section class="card tuvan-timeline-card" *ngIf="tuvan.timeline.length > 0">
          <div class="card-header">
            <h3><span class="material-icon">history</span>Lịch sử</h3>
          </div>
          <div class="timeline">
            <div class="timeline-item" *ngFor="let item of tuvan.timeline">
              <span class="material-icon">{{ item.icon }}</span>
              <div>
                <p class="timeline-label">{{ item.label }}</p>
                <p class="timeline-value">{{ item.value }}</p>
              </div>
            </div>
          </div>
        </section>
      </ng-container>

      <ng-container *ngIf="productView() as product; else defaultPreview">
        <section class="card product-summary-card">
          <div class="card-header">
            <span class="product-status" [ngClass]="product.statusClass">{{ product.status }}</span>
            <div class="card-actions">
              <button type="button" class="primary" (click)="toggleEditDrawer(true)">
                <span class="material-icon">edit_square</span>
                Chỉnh sửa nhanh
              </button>
            </div>
          </div>
          <div class="product-summary-body">
            <div class="product-image" [class.placeholder]="!product.image">
              <ng-container *ngIf="product.image; else productImageFallback">
                <img [src]="product.image" [alt]="product.name || 'Ảnh sản phẩm'" loading="lazy" />
              </ng-container>
            </div>
            <ng-template #productImageFallback>
              <span>{{ (product.name || product.brand || 'SP') | slice:0:2 | uppercase }}</span>
            </ng-template>
            <div class="product-info">
              <h3>{{ product.name || 'Sản phẩm' }}</h3>
              <p class="product-brand" *ngIf="product.brand">{{ product.brand }}</p>
              <p class="product-sku" *ngIf="product.sku">Mã sản phẩm: {{ product.sku }}</p>
              <div class="product-pricing">
                <span class="final">{{ product.finalPrice | currency: 'VND':'symbol':'1.0-0' }}</span>
                <span class="original" *ngIf="product.discount > 0">{{ product.price | currency: 'VND':'symbol':'1.0-0' }}</span>
                <span class="discount" *ngIf="product.discount > 0">-{{ product.discount }}%</span>
              </div>
            </div>
          </div>
        </section>

        <section class="card product-spec-card">
          <div class="card-header">
            <h4>Thông số sản phẩm</h4>
            <button type="button" class="ghost" (click)="toggleSpecEditMode()" *ngIf="!isEditingSpecs()">
              <span class="material-icon">edit_note</span>
              Chỉnh sửa
            </button>
            <div class="inline-actions" *ngIf="isEditingSpecs()">
              <button type="button" class="ghost" (click)="cancelSpecEdit()">
                <span class="material-icon">close</span>
                Hủy
              </button>
              <button type="button" class="primary" (click)="saveSpecs()">
                <span class="material-icon">save</span>
                Lưu
              </button>
            </div>
          </div>
          <div class="product-spec-grid">
            <div class="spec-field">
              <span class="spec-label">Mã sản phẩm</span>
              <span class="spec-value mono">{{ product.sku || '—' }}</span>
              <span class="spec-note" *ngIf="isCreate()">(Chỉ tạo mới)</span>
            </div>
            <div class="spec-field">
              <span class="spec-label">Tồn kho</span>
              <span class="spec-value" *ngIf="!isEditingSpec('stock')">{{ product.stock ?? '—' }}</span>
              <input 
                *ngIf="isEditingSpec('stock')" 
                type="number" 
                class="spec-input" 
                [ngModel]="getSpecDraft('stock')" 
                (ngModelChange)="setSpecDraft('stock', $event)"
                placeholder="Nhập tồn kho"
              />
            </div>
            <div class="spec-field">
              <span class="spec-label">Đơn vị</span>
              <span class="spec-value" *ngIf="!isEditingSpec('unit')">{{ product.unit || '—' }}</span>
              <input 
                *ngIf="isEditingSpec('unit')" 
                type="text" 
                class="spec-input" 
                [ngModel]="getSpecDraft('unit')" 
                (ngModelChange)="setSpecDraft('unit', $event)"
                placeholder="Nhập đơn vị"
              />
            </div>
            <div class="spec-field">
              <span class="spec-label">Xuất xứ</span>
              <span class="spec-value" *ngIf="!isEditingSpec('country')">{{ product.country || '—' }}</span>
              <input 
                *ngIf="isEditingSpec('country')" 
                type="text" 
                class="spec-input" 
                [ngModel]="getSpecDraft('country')" 
                (ngModelChange)="setSpecDraft('country', $event)"
                placeholder="Nhập xuất xứ"
              />
            </div>
            <div class="spec-field" *ngIf="product.slug || isEditingSpec('slug')">
              <span class="spec-label">Slug</span>
              <span class="spec-value mono" *ngIf="!isEditingSpec('slug')">{{ product.slug || '—' }}</span>
              <input 
                *ngIf="isEditingSpec('slug')" 
                type="text" 
                class="spec-input" 
                [ngModel]="getSpecDraft('slug')" 
                (ngModelChange)="setSpecDraft('slug', $event)"
                placeholder="Nhập slug"
              />
            </div>
          </div>
        </section>

        <div class="product-info-grid">
          <section class="card info-card editable-section" *ngIf="product.description || isEditing('description')">
            <div class="card-header">
              <h4>
                <span class="material-icon">description</span>
                Mô tả sản phẩm
              </h4>
              <ng-container *ngIf="!isEditing('description'); else editingDescActions">
                <button type="button" class="edit-btn" (click)="startEdit('description')">
                  <span class="material-icon">edit_note</span>
                  Chỉnh sửa
                </button>
              </ng-container>
              <ng-template #editingDescActions>
                <div class="inline-actions">
                  <button type="button" class="ghost" (click)="cancelEdit('description')">
                    <span class="material-icon">close</span>
                    Hủy
                  </button>
                  <button type="button" class="primary" (click)="applyInline('description')">
                    <span class="material-icon">save</span>
                    Lưu
                  </button>
                </div>
              </ng-template>
            </div>
            <div *ngIf="!isEditing('description'); else editDesc" class="rich-text" [innerHTML]="product.description"></div>
            <ng-template #editDesc>
              <textarea class="edit-textarea" rows="8" [ngModel]="getDraft('description')" (ngModelChange)="setDraft('description', $event)" placeholder="Nhập mô tả sản phẩm..."></textarea>
            </ng-template>
          </section>

          <section class="card info-card editable-section" *ngIf="product.usage || isEditing('usage')">
            <div class="card-header">
              <h4>
                <span class="material-icon">medical_information</span>
                Cách dùng
              </h4>
              <ng-container *ngIf="!isEditing('usage'); else editingUsageActions">
                <button type="button" class="edit-btn" (click)="startEdit('usage')">
                  <span class="material-icon">edit_note</span>
                  Chỉnh sửa
                </button>
              </ng-container>
              <ng-template #editingUsageActions>
                <div class="inline-actions">
                  <button type="button" class="ghost" (click)="cancelEdit('usage')">
                    <span class="material-icon">close</span>
                    Hủy
                  </button>
                  <button type="button" class="primary" (click)="applyInline('usage')">
                    <span class="material-icon">save</span>
                    Lưu
                  </button>
                </div>
              </ng-template>
            </div>
            <div *ngIf="!isEditing('usage'); else editUsage" class="rich-text" [innerHTML]="product.usage"></div>
            <ng-template #editUsage>
              <textarea class="edit-textarea" rows="8" [ngModel]="getDraft('usage')" (ngModelChange)="setDraft('usage', $event)" placeholder="Nhập hướng dẫn sử dụng..."></textarea>
            </ng-template>
          </section>

          <section class="card info-card editable-section" *ngIf="product.ingredients || isEditing('ingredients')">
            <div class="card-header">
              <h4>
                <span class="material-icon">science</span>
                Thành phần
              </h4>
              <ng-container *ngIf="!isEditing('ingredients'); else editingIngActions">
                <button type="button" class="edit-btn" (click)="startEdit('ingredients')">
                  <span class="material-icon">edit_note</span>
                  Chỉnh sửa
                </button>
              </ng-container>
              <ng-template #editingIngActions>
                <div class="inline-actions">
                  <button type="button" class="ghost" (click)="cancelEdit('ingredients')">
                    <span class="material-icon">close</span>
                    Hủy
                  </button>
                  <button type="button" class="primary" (click)="applyInline('ingredients')">
                    <span class="material-icon">save</span>
                    Lưu
                  </button>
                </div>
              </ng-template>
            </div>
            <div *ngIf="!isEditing('ingredients'); else editIng" class="rich-text" [innerHTML]="product.ingredients"></div>
            <ng-template #editIng>
              <textarea class="edit-textarea" rows="8" [ngModel]="getDraft('ingredients')" (ngModelChange)="setDraft('ingredients', $event)" placeholder="Nhập thành phần..."></textarea>
            </ng-template>
          </section>

          <section class="card info-card editable-section" *ngIf="product.warnings || isEditing('warnings')">
            <div class="card-header">
              <h4>
                <span class="material-icon">warning</span>
                Lưu ý
              </h4>
              <ng-container *ngIf="!isEditing('warnings'); else editingWarnActions">
                <button type="button" class="edit-btn" (click)="startEdit('warnings')">
                  <span class="material-icon">edit_note</span>
                  Chỉnh sửa
                </button>
              </ng-container>
              <ng-template #editingWarnActions>
                <div class="inline-actions">
                  <button type="button" class="ghost" (click)="cancelEdit('warnings')">
                    <span class="material-icon">close</span>
                    Hủy
                  </button>
                  <button type="button" class="primary" (click)="applyInline('warnings')">
                    <span class="material-icon">save</span>
                    Lưu
                  </button>
                </div>
              </ng-template>
            </div>
            <div *ngIf="!isEditing('warnings'); else editWarning" class="rich-text" [innerHTML]="product.warnings"></div>
            <ng-template #editWarning>
              <textarea class="edit-textarea" rows="8" [ngModel]="getDraft('warnings')" (ngModelChange)="setDraft('warnings', $event)" placeholder="Nhập lưu ý, cảnh báo..."></textarea>
            </ng-template>
          </section>

          <!-- Thư Viện Ảnh -->
          <section class="card info-card" *ngIf="product && product.gallery && product.gallery.length > 0">
            <div class="card-header">
              <h4>
                <span class="material-icon">photo_library</span>
                Thư Viện Ảnh
              </h4>
              <span class="gallery-count">{{ product.gallery.length }} ảnh</span>
            </div>
            <div class="gallery-library">
              <div class="gallery-item-view" *ngFor="let img of product.gallery; let i = index; trackBy: trackByGalleryIndex">
                <img 
                  [src]="img" 
                  [alt]="'Ảnh ' + (i + 1)" 
                  (error)="onImageError($event)" 
                />
                <div class="image-error" style="display: none;">
                  <span class="material-icon">broken_image</span>
                  <span>Không thể tải ảnh</span>
                </div>
              </div>
            </div>
          </section>

          <section class="card info-card" *ngIf="product.tags.length">
            <div class="card-header">
              <h4>Từ khóa</h4>
              <button type="button" class="ghost" (click)="toggleJsonModal(true)">
                <span class="material-icon">label</span>
                Chỉnh sửa
              </button>
            </div>
            <div class="tag-list">
              <span *ngFor="let tag of product.tags">#{{ tag }}</span>
            </div>
          </section>
        </div>

        <!-- Edit Modal (Popup) -->
        <div class="modal-backdrop" *ngIf="showEditDrawer()" (click)="toggleEditDrawer(false)"></div>
        <div class="edit-modal" [class.voucher-edit]="isPromotionCollection()" *ngIf="showEditDrawer()">
          <div class="modal-header">
            <h3>
              <span class="material-icon">edit_square</span>
              {{ isPromotionCollection() ? 'Chỉnh sửa mã giảm giá' : 'Chỉnh sửa nhanh sản phẩm' }}
            </h3>
            <button type="button" class="close-btn" (click)="toggleEditDrawer(false)">
              <span class="material-icon">close</span>
            </button>
          </div>
          
          <!-- Voucher Edit Form -->
          <ng-container *ngIf="isPromotionCollection() && voucherView() as voucher">
            <form [formGroup]="productForm" (ngSubmit)="submitProductForm()" class="modal-form">
              <div class="form-section">
                <h4>
                  <span class="material-icon">info</span>
                  Thông tin cơ bản
                </h4>
                <div class="form-grid">
                  <label class="full-width">
                    <span class="label-text">Mã giảm giá <span class="required">*</span></span>
                    <input type="text" formControlName="code" placeholder="VD: WELCOME10" class="form-input" />
                  </label>
                  <label class="full-width">
                    <span class="label-text">Tiêu đề <span class="required">*</span></span>
                    <input type="text" formControlName="title" placeholder="VD: Chào mừng khách hàng mới" class="form-input" />
                  </label>
                  <label class="full-width">
                    <span class="label-text">Mô tả</span>
                    <textarea formControlName="voucherDescription" rows="3" placeholder="Mô tả về mã giảm giá..." class="form-textarea"></textarea>
                  </label>
                </div>
              </div>

              <div class="form-section">
                <h4>
                  <span class="material-icon">percent</span>
                  Thông tin giảm giá
                </h4>
                <div class="form-grid">
                  <label>
                    <span class="label-text">Phần trăm giảm giá (%) <span class="required">*</span></span>
                    <input type="number" formControlName="discountPercent" min="0" max="100" placeholder="0" class="form-input" />
                  </label>
                  <label>
                    <span class="label-text">Giảm giá cố định (₫)</span>
                    <input type="number" formControlName="voucherDiscount" min="0" placeholder="Để trống nếu dùng phần trăm" class="form-input" />
                    <small class="hint">Để trống nếu chỉ dùng phần trăm</small>
                  </label>
                  <label>
                    <span class="label-text">Đơn hàng tối thiểu (₫)</span>
                    <input type="number" formControlName="minOrderAmount" min="0" placeholder="0" class="form-input" />
                    <small class="hint">0 = không giới hạn</small>
                  </label>
                  <label>
                    <span class="label-text">Số lượt sử dụng tối đa</span>
                    <input type="number" formControlName="maxUsage" min="1" placeholder="Để trống = không giới hạn" class="form-input" />
                    <small class="hint">Để trống = không giới hạn</small>
                  </label>
                </div>
              </div>

              <div class="form-section">
                <h4>
                  <span class="material-icon">event</span>
                  Thời gian áp dụng
                </h4>
                <div class="form-grid">
                  <label>
                    <span class="label-text">Ngày bắt đầu</span>
                    <input type="datetime-local" formControlName="startsAt" class="form-input" />
                    <small class="hint">Để trống = ngay lập tức</small>
                  </label>
                  <label>
                    <span class="label-text">Ngày hết hạn</span>
                    <input type="datetime-local" formControlName="expiresAt" class="form-input" />
                    <small class="hint">Để trống = không hết hạn</small>
                  </label>
                </div>
              </div>

              <div class="form-section">
                <label class="checkbox-label">
                  <input type="checkbox" formControlName="isActive" />
                  <span>Kích hoạt mã giảm giá</span>
                </label>
              </div>

              <div class="modal-actions">
                <button type="button" class="ghost" (click)="toggleEditDrawer(false)">Hủy</button>
                <button type="submit" class="primary" [disabled]="saving()">
                  <span class="material-icon" *ngIf="!saving()">save</span>
                  <span class="spinner" *ngIf="saving()"></span>
                  {{ saving() ? 'Đang lưu...' : 'Lưu thay đổi' }}
                </button>
              </div>
            </form>
          </ng-container>

          <!-- Enhanced Category Edit Form -->
          <form [formGroup]="categoryForm" (ngSubmit)="submitCategoryForm()" class="modal-form enhanced-form" *ngIf="isCategoryCollection()">
            
            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">category</span>
                  Thông tin cơ bản
                </h4>
                <span class="required-note">* Bắt buộc</span>
              </div>
              <div class="form-grid">
                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">label</span>
                    Tên danh mục <span class="required">*</span>
                  </span>
                  <input 
                    type="text" 
                    formControlName="name" 
                    placeholder="VD: Thuốc giảm đau, Vitamin, Dụng cụ y tế"
                    [class.error]="categoryForm.get('name')?.invalid && categoryForm.get('name')?.touched"
                  />
                  <span class="helper-text">Tên danh mục hiển thị trên website</span>
                  <span class="error-text" *ngIf="categoryForm.get('name')?.invalid && categoryForm.get('name')?.touched">
                    Tên danh mục là bắt buộc
                  </span>
                </label>
                
                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">link</span>
                    Slug (URL)
                  </span>
                  <div class="input-with-action">
                    <input type="text" formControlName="slug" placeholder="tu-dong-tao-tu-ten" />
                    <button type="button" class="generate-slug-btn" (click)="generateCategorySlug()" title="Tạo slug từ tên">
                      <span class="material-icon">auto_fix_high</span>
                    </button>
                  </div>
                  <span class="helper-text">Tự động tạo từ tên hoặc nhập tùy chỉnh</span>
                </label>
              </div>
            </div>

            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">account_tree</span>
                  Phân cấp & Hiển thị
                </h4>
              </div>
              <div class="form-grid">
                <label>
                  <span class="label-text">
                    <span class="material-icon">layers</span>
                    Cấp độ <span class="required">*</span>
                  </span>
                  <select formControlName="level" [class.error]="categoryForm.get('level')?.invalid && categoryForm.get('level')?.touched">
                    <option [value]="1">Cấp 1 (Danh mục chính)</option>
                    <option [value]="2">Cấp 2 (Danh mục con)</option>
                    <option [value]="3">Cấp 3 (Danh mục nhỏ)</option>
                  </select>
                  <span class="helper-text">Chọn cấp độ phân cấp của danh mục</span>
                </label>
                
                <label>
                  <span class="label-text">
                    <span class="material-icon">folder</span>
                    Danh mục cha
                  </span>
                  <select formControlName="parentId">
                    <option value="">-- Không có (Danh mục gốc) --</option>
                    <option 
                      *ngFor="let cat of availableCategories()" 
                      [value]="cat._id"
                      [disabled]="cat._id === document()?._id"
                    >
                      {{ '  '.repeat(cat.level - 1) }}{{ cat.name }} (Cấp {{ cat.level }})
                    </option>
                  </select>
                  <span class="helper-text">Chọn danh mục cha (chỉ áp dụng cho cấp 2, 3)</span>
                </label>
                
                <label>
                  <span class="label-text">
                    <span class="material-icon">sort</span>
                    Thứ tự hiển thị
                  </span>
                  <input 
                    type="number" 
                    formControlName="displayOrder" 
                    min="0" 
                    placeholder="Để trống = tự động"
                  />
                  <span class="helper-text">Số nhỏ hơn sẽ hiển thị trước</span>
                </label>
              </div>
            </div>

            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">image</span>
                  Icon & Trạng thái
                </h4>
              </div>
              <div class="form-grid">
                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">image</span>
                    Icon (URL hoặc Material Icon)
                  </span>
                  <input 
                    type="text" 
                    formControlName="icon" 
                    placeholder="VD: https://example.com/icon.png hoặc category"
                  />
                  <span class="helper-text">URL hình ảnh hoặc tên Material Icon</span>
                  <div class="icon-preview" *ngIf="categoryForm.value.icon">
                    <span class="material-icon" *ngIf="!categoryForm.value.icon.startsWith('http')">
                      {{ categoryForm.value.icon }}
                    </span>
                    <img *ngIf="categoryForm.value.icon.startsWith('http')" [src]="categoryForm.value.icon" alt="Icon preview" onerror="this.style.display='none'" />
                  </div>
                </label>
                
                <div class="full-width">
                  <div class="toggle-switch">
                    <input 
                      type="checkbox" 
                      formControlName="isActive" 
                      id="category-active"
                    />
                    <label for="category-active" class="toggle-label">
                      <span class="toggle-slider"></span>
                      <span class="toggle-text">
                        <span class="material-icon">toggle_on</span>
                        <span>Trạng thái: <strong>{{ categoryForm.value.isActive ? 'Hoạt động' : 'Ẩn' }}</strong></span>
                      </span>
                    </label>
                  </div>
                  <span class="helper-text">Danh mục ẩn sẽ không hiển thị trên website</span>
                </div>
              </div>
            </div>

            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">description</span>
                  Mô tả danh mục
                </h4>
                <span class="optional-note">Tùy chọn</span>
              </div>
              <label class="full-width">
                <span class="label-text">
                  <span class="material-icon">article</span>
                  Mô tả chi tiết
                </span>
                <textarea 
                  formControlName="description" 
                  rows="6" 
                  placeholder="Nhập mô tả về danh mục, công dụng, đặc điểm..."
                  class="form-textarea"
                ></textarea>
                <span class="helper-text">Mô tả đầy đủ về danh mục để khách hàng hiểu rõ</span>
              </label>
            </div>

            <div class="modal-actions">
              <button type="button" class="ghost" (click)="toggleEditDrawer(false)">
                <span class="material-icon">close</span>
                Hủy
              </button>
              <button type="submit" class="primary">
                <span class="material-icon">save</span>
                Lưu thay đổi
              </button>
            </div>
          </form>

          <!-- Enhanced Blog Edit Form -->
          <form [formGroup]="blogForm" (ngSubmit)="submitBlogForm()" class="modal-form enhanced-form" *ngIf="isBlogCollection()">
            
            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">article</span>
                  Thông tin cơ bản
                </h4>
                <span class="required-note">* Bắt buộc</span>
              </div>
              <div class="form-grid">
                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">title</span>
                    Tiêu đề bài viết <span class="required">*</span>
                  </span>
                  <input 
                    type="text" 
                    formControlName="title" 
                    placeholder="VD: 10 cách giảm đau đầu hiệu quả"
                    [class.error]="blogForm.get('title')?.invalid && blogForm.get('title')?.touched"
                  />
                  <span class="helper-text">Tiêu đề chính của bài viết, sẽ hiển thị trên website</span>
                  <span class="error-text" *ngIf="blogForm.get('title')?.invalid && blogForm.get('title')?.touched">
                    Tiêu đề bài viết là bắt buộc
                  </span>
                </label>
                
                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">link</span>
                    Slug (URL)
                  </span>
                  <div class="input-with-action">
                    <input type="text" formControlName="slug" placeholder="tu-dong-tao-tu-tieu-de" />
                    <button type="button" class="generate-slug-btn" (click)="generateBlogSlug()" title="Tạo slug từ tiêu đề">
                      <span class="material-icon">auto_fix_high</span>
                    </button>
                  </div>
                  <span class="helper-text">Tự động tạo từ tiêu đề hoặc nhập tùy chỉnh</span>
                </label>

                <label>
                  <span class="label-text">
                    <span class="material-icon">badge</span>
                    Mã bài viết
                  </span>
                  <input type="text" formControlName="articleId" placeholder="ID từ hệ thống nguồn" />
                  <span class="helper-text">Mã ID từ hệ thống nguồn (nếu có)</span>
                </label>

                <label>
                  <span class="label-text">
                    <span class="material-icon">format_quote</span>
                    Headline
                  </span>
                  <input type="text" formControlName="headline" placeholder="Tiêu đề phụ, câu nổi bật" />
                  <span class="helper-text">Tiêu đề phụ hoặc câu nổi bật</span>
                </label>
              </div>
            </div>

            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">image</span>
                  Hình ảnh & Mô tả
                </h4>
              </div>
              <div class="form-grid">
                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">image</span>
                    Ảnh bìa (URL)
                  </span>
                  <input type="url" formControlName="coverImage" placeholder="https://example.com/cover.jpg" />
                  <span class="helper-text">URL hình ảnh bìa của bài viết</span>
                  <div class="image-preview" *ngIf="blogForm.value.coverImage">
                    <img [src]="blogForm.value.coverImage" alt="Cover preview" onerror="this.style.display='none'" />
                  </div>
                </label>

                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">description</span>
                    Mô tả ngắn
                  </span>
                  <textarea 
                    formControlName="shortDescription" 
                    rows="4" 
                    placeholder="Nhập mô tả ngắn gọn về bài viết..."
                    class="form-textarea"
                  ></textarea>
                  <span class="helper-text">Mô tả ngắn gọn sẽ hiển thị trong danh sách bài viết</span>
                </label>
              </div>
            </div>

            <div class="form-section content-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">article</span>
                  Nội dung bài viết
                </h4>
                <span class="required-note">* Bắt buộc</span>
              </div>
              <div class="content-editor-wrapper">
                <div class="editor-tabs">
                  <button 
                    type="button" 
                    class="editor-tab" 
                    [class.active]="!blogPreviewMode()"
                    (click)="blogPreviewMode.set(false)"
                  >
                    <span class="material-icon">edit_note</span>
                    Soạn thảo
                  </button>
                  <button 
                    type="button" 
                    class="editor-tab" 
                    [class.active]="blogPreviewMode()"
                    (click)="blogPreviewMode.set(true)"
                  >
                    <span class="material-icon">visibility</span>
                    Xem trước
                  </button>
                </div>

                <div class="content-stats">
                  <span class="stat-item">
                    <span class="material-icon">text_fields</span>
                    <strong>{{ contentWordCount() }}</strong> từ
                  </span>
                  <span class="stat-item">
                    <span class="material-icon">subject</span>
                    <strong>{{ contentCharCount() }}</strong> ký tự
                  </span>
                  <span class="stat-item" *ngIf="contentWordCount() > 0">
                    <span class="material-icon">schedule</span>
                    ~<strong>{{ Math.ceil(contentWordCount() / 200) }}</strong> phút đọc
                  </span>
                </div>

                <div class="formatting-toolbar" *ngIf="!blogPreviewMode()">
                  <div class="toolbar-group">
                    <button type="button" class="format-btn" (click)="insertHtmlTag('h2')" title="Tiêu đề H2">
                      <span class="material-icon">title</span>
                      H2
                    </button>
                    <button type="button" class="format-btn" (click)="insertHtmlTag('h3')" title="Tiêu đề H3">
                      <span class="material-icon">title</span>
                      H3
                    </button>
                  </div>
                  <div class="toolbar-separator"></div>
                  <div class="toolbar-group">
                    <button type="button" class="format-btn" (click)="insertHtmlTag('p')" title="Đoạn văn">
                      <span class="material-icon">notes</span>
                    </button>
                    <button type="button" class="format-btn" (click)="insertHtmlTag('strong')" title="In đậm">
                      <span class="material-icon">format_bold</span>
                    </button>
                    <button type="button" class="format-btn" (click)="insertHtmlTag('em')" title="In nghiêng">
                      <span class="material-icon">format_italic</span>
                    </button>
                  </div>
                  <div class="toolbar-separator"></div>
                  <div class="toolbar-group">
                    <button type="button" class="format-btn" (click)="insertHtmlTag('ul')" title="Danh sách">
                      <span class="material-icon">format_list_bulleted</span>
                    </button>
                    <button type="button" class="format-btn" (click)="insertHtmlTag('ol')" title="Danh sách số">
                      <span class="material-icon">format_list_numbered</span>
                    </button>
                  </div>
                  <div class="toolbar-separator"></div>
                  <div class="toolbar-group">
                    <button type="button" class="format-btn" (click)="insertHtmlTag('link')" title="Chèn link">
                      <span class="material-icon">link</span>
                    </button>
                    <button type="button" class="format-btn" (click)="insertHtmlTag('img')" title="Chèn ảnh">
                      <span class="material-icon">image</span>
                    </button>
                  </div>
                </div>

                <div class="editor-container" *ngIf="!blogPreviewMode()">
                  <textarea 
                    formControlName="content" 
                    rows="20" 
                    placeholder="Nhập nội dung đầy đủ của bài viết tại đây...&#10;&#10;Bạn có thể:&#10;- Nhập văn bản thuần&#10;- Sử dụng HTML để định dạng&#10;- Chọn văn bản và click các nút phía trên để format&#10;&#10;Ví dụ:&#10;&lt;h2&gt;Tiêu đề phụ&lt;/h2&gt;&#10;&lt;p&gt;Đoạn văn đầu tiên...&lt;/p&gt;&#10;&lt;p&gt;&lt;strong&gt;In đậm&lt;/strong&gt; và &lt;em&gt;in nghiêng&lt;/em&gt;&lt;/p&gt;"
                    class="form-textarea content-textarea"
                    [class.error]="blogForm.get('content')?.invalid && blogForm.get('content')?.touched"
                  ></textarea>
                  <div class="content-validation-hints">
                    <span class="validation-hint" *ngIf="contentCharCount() === 0">
                      <span class="material-icon">error</span>
                      Vui lòng nhập nội dung bài viết
                    </span>
                    <span class="validation-hint warning" *ngIf="contentCharCount() > 0 && contentCharCount() < 100">
                      <span class="material-icon">warning</span>
                      Nội dung quá ngắn (tối thiểu 100 ký tự)
                    </span>
                    <span class="validation-hint success" *ngIf="contentCharCount() >= 100">
                      <span class="material-icon">check_circle</span>
                      Nội dung đủ dài
                    </span>
                  </div>
                </div>

                <div class="preview-container" *ngIf="blogPreviewMode()">
                  <div class="preview-header">
                    <span class="material-icon">visibility</span>
                    <span>Xem trước nội dung</span>
                  </div>
                  <div class="preview-content rich-text" [innerHTML]="blogForm.value.content || '<p class=\'empty\'>Chưa có nội dung</p>'"></div>
                </div>
              </div>
            </div>

            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">person</span>
                  Tác giả & Phân loại
                </h4>
              </div>
              <div class="form-grid">
                <label>
                  <span class="label-text">
                    <span class="material-icon">person</span>
                    Tên tác giả
                  </span>
                  <input type="text" formControlName="authorName" placeholder="VD: Bác sĩ Nguyễn Văn A" />
                  <span class="helper-text">Tên đầy đủ của tác giả</span>
                </label>

                <label>
                  <span class="label-text">
                    <span class="material-icon">work</span>
                    Chức danh
                  </span>
                  <input type="text" formControlName="authorTitle" placeholder="VD: Bác sĩ, Chuyên gia" />
                  <span class="helper-text">Chức danh hoặc vai trò của tác giả</span>
                </label>

                <label>
                  <span class="label-text">
                    <span class="material-icon">account_circle</span>
                    Avatar (URL)
                  </span>
                  <input type="url" formControlName="authorAvatar" placeholder="https://example.com/avatar.jpg" />
                  <span class="helper-text">URL ảnh đại diện của tác giả</span>
                </label>

                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">folder</span>
                    Chuyên mục
                  </span>
                  <input 
                    type="text" 
                    formControlName="categories" 
                    placeholder="VD: Sức khỏe, Y tế, Dinh dưỡng"
                  />
                  <span class="helper-text">Nhập các chuyên mục, phân cách bằng dấu phẩy</span>
                </label>

                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">local_offer</span>
                    Tags (Từ khóa)
                  </span>
                  <input 
                    type="text" 
                    formControlName="tags" 
                    placeholder="VD: sức khỏe, dinh dưỡng, bệnh tật"
                  />
                  <span class="helper-text">Nhập các từ khóa, phân cách bằng dấu phẩy</span>
                </label>
              </div>
            </div>

            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">link</span>
                  Liên kết & Trạng thái
                </h4>
              </div>
              <div class="form-grid">
                <label>
                  <span class="label-text">
                    <span class="material-icon">link</span>
                    URL hiển thị
                  </span>
                  <input type="url" formControlName="url" placeholder="https://example.com/article" />
                  <span class="helper-text">URL hiển thị trên website</span>
                </label>

                <label>
                  <span class="label-text">
                    <span class="material-icon">open_in_new</span>
                    Link nguồn
                  </span>
                  <input type="url" formControlName="originalUrl" placeholder="https://source.com/article" />
                  <span class="helper-text">URL gốc từ nguồn (nếu có)</span>
                </label>

                <label>
                  <span class="label-text">
                    <span class="material-icon">event</span>
                    Ngày xuất bản
                  </span>
                  <input type="datetime-local" formControlName="publishedAt" />
                  <span class="helper-text">Thời gian xuất bản bài viết</span>
                </label>

                <label>
                  <span class="label-text">
                    <span class="material-icon">flag</span>
                    Trạng thái
                  </span>
                  <select formControlName="status">
                    <option value="published">Đã xuất bản</option>
                    <option value="draft">Bản nháp</option>
                    <option value="scheduled">Đã lên lịch</option>
                    <option value="hidden">Ẩn</option>
                    <option value="pending">Chờ phê duyệt</option>
                  </select>
                  <span class="helper-text">Trạng thái hiển thị của bài viết</span>
                </label>

                <label class="full-width">
                  <div class="toggle-switch">
                    <input 
                      type="checkbox" 
                      formControlName="isApproved" 
                      id="blog-approved"
                    />
                    <label for="blog-approved" class="toggle-label">
                      <span class="toggle-slider"></span>
                      <span class="toggle-text">
                        <span class="material-icon">check_circle</span>
                        <span>Đã phê duyệt: <strong>{{ blogForm.value.isApproved ? 'Có' : 'Chưa' }}</strong></span>
                      </span>
                    </label>
                  </div>
                  <span class="helper-text">Bài viết chưa phê duyệt sẽ không hiển thị công khai</span>
                </label>

                <label class="full-width">
                  <div class="toggle-switch">
                    <input 
                      type="checkbox" 
                      formControlName="isVisible" 
                      id="blog-visible"
                    />
                    <label for="blog-visible" class="toggle-label">
                      <span class="toggle-slider"></span>
                      <span class="toggle-text">
                        <span class="material-icon">visibility</span>
                        <span>Hiển thị: <strong>{{ blogForm.value.isVisible ? 'Có' : 'Ẩn' }}</strong></span>
                      </span>
                    </label>
                  </div>
                  <span class="helper-text">Bài viết ẩn sẽ không hiển thị trên website</span>
                </label>
              </div>
            </div>

            <div class="form-section seo-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">search</span>
                  SEO & Metadata
                </h4>
                <span class="optional-note">Tối ưu SEO</span>
              </div>
              <div class="form-grid">
                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">title</span>
                    Meta Title (SEO)
                  </span>
                  <input 
                    type="text" 
                    formControlName="metaTitle" 
                    placeholder="Để trống = dùng tiêu đề bài viết"
                    maxlength="60"
                  />
                  <span class="helper-text">Tiêu đề hiển thị trên Google (tối đa 60 ký tự)</span>
                </label>

                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">description</span>
                    Meta Description (SEO)
                  </span>
                  <textarea 
                    formControlName="metaDescription" 
                    rows="3" 
                    placeholder="Để trống = dùng mô tả ngắn"
                    maxlength="160"
                    class="form-textarea"
                  ></textarea>
                  <span class="helper-text">Mô tả hiển thị trên Google (tối đa 160 ký tự)</span>
                </label>

                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">label</span>
                    Meta Keywords (SEO)
                  </span>
                  <input 
                    type="text" 
                    formControlName="metaKeywords" 
                    placeholder="Để trống = dùng tags"
                  />
                  <span class="helper-text">Từ khóa SEO, phân cách bằng dấu phẩy</span>
                </label>

                <label>
                  <span class="label-text">
                    <span class="material-icon">schedule</span>
                    Thời gian đọc (phút)
                  </span>
                  <input 
                    type="number" 
                    formControlName="readTime" 
                    min="1" 
                    placeholder="Auto"
                  />
                  <span class="helper-text">Tự động: ~{{ Math.ceil(contentWordCount() / 200) }} phút</span>
                </label>
              </div>
            </div>

            <div class="form-section settings-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">settings</span>
                  Cài đặt bổ sung
                </h4>
              </div>
              <div class="form-grid">
                <label class="full-width">
                  <div class="toggle-switch">
                    <input 
                      type="checkbox" 
                      formControlName="featured" 
                      id="blog-featured"
                    />
                    <label for="blog-featured" class="toggle-label">
                      <span class="toggle-slider"></span>
                      <span class="toggle-text">
                        <span class="material-icon">star</span>
                        <span>Bài viết nổi bật: <strong>{{ blogForm.value.featured ? 'Có' : 'Không' }}</strong></span>
                      </span>
                    </label>
                  </div>
                  <span class="helper-text">Bài viết nổi bật sẽ hiển thị ở vị trí ưu tiên</span>
                </label>

                <label class="full-width">
                  <div class="toggle-switch">
                    <input 
                      type="checkbox" 
                      formControlName="allowComments" 
                      id="blog-comments"
                    />
                    <label for="blog-comments" class="toggle-label">
                      <span class="toggle-slider"></span>
                      <span class="toggle-text">
                        <span class="material-icon">comment</span>
                        <span>Cho phép bình luận: <strong>{{ blogForm.value.allowComments ? 'Có' : 'Không' }}</strong></span>
                      </span>
                    </label>
                  </div>
                  <span class="helper-text">Người dùng có thể bình luận vào bài viết này</span>
                </label>
              </div>
            </div>

            <div class="modal-actions">
              <button type="button" class="ghost" (click)="toggleEditDrawer(false)">
                <span class="material-icon">close</span>
                Hủy
              </button>
              <button type="submit" class="primary">
                <span class="material-icon">save</span>
                Lưu thay đổi
              </button>
            </div>
          </form>

          <!-- Enhanced Disease Edit Form -->
          <form [formGroup]="diseaseForm" (ngSubmit)="submitDiseaseForm()" class="modal-form enhanced-form" *ngIf="isDiseaseCollection()">
            
            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">healing</span>
                  Thông tin cơ bản
                </h4>
                <span class="required-note">* Bắt buộc</span>
              </div>
              <div class="form-grid">
                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">label</span>
                    Tên bệnh lý <span class="required">*</span>
                  </span>
                  <input 
                    type="text" 
                    formControlName="name" 
                    placeholder="VD: Cảm cúm, Đau đầu, Viêm họng"
                    [class.error]="diseaseForm.get('name')?.invalid && diseaseForm.get('name')?.touched"
                  />
                  <span class="helper-text">Tên bệnh lý chính thức</span>
                  <span class="error-text" *ngIf="diseaseForm.get('name')?.invalid && diseaseForm.get('name')?.touched">
                    Tên bệnh lý là bắt buộc
                  </span>
                </label>
                
                <label>
                  <span class="label-text">
                    <span class="material-icon">badge</span>
                    Mã bệnh
                  </span>
                  <input type="text" formControlName="code" placeholder="Mã ID từ hệ thống nguồn" />
                  <span class="helper-text">Mã ID từ hệ thống nguồn (nếu có)</span>
                </label>

                <label>
                  <span class="label-text">
                    <span class="material-icon">link</span>
                    Slug (URL)
                  </span>
                  <div class="input-with-action">
                    <input type="text" formControlName="slug" placeholder="tu-dong-tao-tu-ten" />
                    <button type="button" class="generate-slug-btn" (click)="generateDiseaseSlug()" title="Tạo slug từ tên">
                      <span class="material-icon">auto_fix_high</span>
                    </button>
                  </div>
                  <span class="helper-text">Tự động tạo từ tên hoặc nhập tùy chỉnh</span>
                </label>

                <label>
                  <span class="label-text">
                    <span class="material-icon">format_quote</span>
                    Headline
                  </span>
                  <input type="text" formControlName="headline" placeholder="Tiêu đề phụ, câu nổi bật" />
                  <span class="helper-text">Tiêu đề phụ hoặc câu nổi bật</span>
                </label>
              </div>
            </div>

            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">image</span>
                  Hình ảnh & Liên kết
                </h4>
              </div>
              <div class="form-grid">
                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">image</span>
                    Ảnh bìa (URL)
                  </span>
                  <input type="url" formControlName="coverImage" placeholder="https://example.com/cover.jpg" />
                  <span class="helper-text">URL hình ảnh bìa của bệnh lý</span>
                  <div class="image-preview" *ngIf="diseaseForm.value.coverImage">
                    <img [src]="diseaseForm.value.coverImage" alt="Cover preview" onerror="this.style.display='none'" />
                  </div>
                </label>

                <label>
                  <span class="label-text">
                    <span class="material-icon">link</span>
                    URL hiển thị
                  </span>
                  <input type="url" formControlName="url" placeholder="https://example.com/disease" />
                  <span class="helper-text">URL hiển thị trên website</span>
                </label>

                <label>
                  <span class="label-text">
                    <span class="material-icon">open_in_new</span>
                    Link nguồn
                  </span>
                  <input type="url" formControlName="originalUrl" placeholder="https://source.com/disease" />
                  <span class="helper-text">URL gốc từ nguồn (nếu có)</span>
                </label>
              </div>
            </div>

            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">description</span>
                  Mô tả & Thông tin chi tiết
                </h4>
              </div>
              <div class="form-grid">
                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">summary</span>
                    Tóm tắt
                  </span>
                  <textarea 
                    formControlName="summary" 
                    rows="4" 
                    placeholder="Tóm tắt ngắn gọn về bệnh lý..."
                    class="form-textarea"
                  ></textarea>
                  <span class="helper-text">Tóm tắt ngắn gọn về bệnh lý</span>
                </label>

                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">sick</span>
                    Triệu chứng
                  </span>
                  <textarea 
                    formControlName="symptoms" 
                    rows="6" 
                    placeholder="Mô tả các triệu chứng của bệnh..."
                    class="form-textarea"
                  ></textarea>
                  <span class="helper-text">Các triệu chứng thường gặp</span>
                </label>

                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">science</span>
                    Nguyên nhân
                  </span>
                  <textarea 
                    formControlName="causes" 
                    rows="6" 
                    placeholder="Mô tả nguyên nhân gây bệnh..."
                    class="form-textarea"
                  ></textarea>
                  <span class="helper-text">Nguyên nhân gây ra bệnh</span>
                </label>

                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">medication</span>
                    Điều trị
                  </span>
                  <textarea 
                    formControlName="treatment" 
                    rows="6" 
                    placeholder="Mô tả phương pháp điều trị..."
                    class="form-textarea"
                  ></textarea>
                  <span class="helper-text">Phương pháp điều trị</span>
                </label>

                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">shield</span>
                    Phòng ngừa
                  </span>
                  <textarea 
                    formControlName="prevention" 
                    rows="6" 
                    placeholder="Mô tả cách phòng ngừa..."
                    class="form-textarea"
                  ></textarea>
                  <span class="helper-text">Cách phòng ngừa bệnh</span>
                </label>

                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">note</span>
                    Ghi chú
                  </span>
                  <textarea 
                    formControlName="notes" 
                    rows="4" 
                    placeholder="Ghi chú bổ sung..."
                    class="form-textarea"
                  ></textarea>
                  <span class="helper-text">Ghi chú bổ sung (nếu có)</span>
                </label>
              </div>
            </div>

            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">category</span>
                  Phân loại & Tên gọi
                </h4>
              </div>
              <div class="form-grid">
                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">folder</span>
                    Chuyên mục
                  </span>
                  <input 
                    type="text" 
                    formControlName="categories" 
                    placeholder="VD: Bệnh hô hấp, Bệnh tiêu hóa, Bệnh da liễu"
                  />
                  <span class="helper-text">Nhập các chuyên mục, phân cách bằng dấu phẩy</span>
                </label>

                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">label</span>
                    Tên gọi khác
                  </span>
                  <input 
                    type="text" 
                    formControlName="alternateNames" 
                    placeholder="VD: Cảm lạnh, Sổ mũi, Ho khan"
                  />
                  <span class="helper-text">Các tên gọi khác của bệnh, phân cách bằng dấu phẩy</span>
                </label>
              </div>
            </div>

            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">settings</span>
                  Trạng thái
                </h4>
              </div>
              <div class="form-grid">
                <label class="full-width">
                  <div class="toggle-switch">
                    <input 
                      type="checkbox" 
                      formControlName="isVisible" 
                      id="disease-visible"
                    />
                    <label for="disease-visible" class="toggle-label">
                      <span class="toggle-slider"></span>
                      <span class="toggle-text">
                        <span class="material-icon">visibility</span>
                        <span>Hiển thị: <strong>{{ diseaseForm.value.isVisible ? 'Có' : 'Ẩn' }}</strong></span>
                      </span>
                    </label>
                  </div>
                  <span class="helper-text">Bệnh lý ẩn sẽ không hiển thị trên website</span>
                </label>
              </div>
            </div>

            <div class="modal-actions">
              <button type="button" class="ghost" (click)="toggleEditDrawer(false)">
                <span class="material-icon">close</span>
                Hủy
              </button>
              <button type="submit" class="primary" [disabled]="diseaseForm.invalid">
                <span class="material-icon">save</span>
                Lưu thay đổi
              </button>
            </div>
          </form>

          <!-- Enhanced Banner Edit Form -->
          <form [formGroup]="bannerForm" (ngSubmit)="submitBannerForm()" class="modal-form enhanced-form" *ngIf="isBannerCollection()">
            
            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">image</span>
                  Thông tin cơ bản
                </h4>
                <span class="required-note">* Bắt buộc</span>
              </div>
              <div class="form-grid">
                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">label</span>
                    Tên banner <span class="required">*</span>
                  </span>
                  <input 
                    type="text" 
                    formControlName="name" 
                    placeholder="VD: Hero Banner 1, Feature Banner, Promotion Banner"
                    [class.error]="bannerForm.get('name')?.invalid && bannerForm.get('name')?.touched"
                  />
                  <span class="helper-text">Tên banner để quản lý</span>
                  <span class="error-text" *ngIf="bannerForm.get('name')?.invalid && bannerForm.get('name')?.touched">
                    Tên banner là bắt buộc
                  </span>
                </label>

                <label>
                  <span class="label-text">
                    <span class="material-icon">category</span>
                    Loại banner <span class="required">*</span>
                  </span>
                  <select formControlName="type" [class.error]="bannerForm.get('type')?.invalid && bannerForm.get('type')?.touched">
                    <option value="hero">Hero Banner</option>
                    <option value="feature">Feature Banner</option>
                    <option value="sub">Sub Banner</option>
                    <option value="marketing">Marketing Banner</option>
                  </select>
                  <span class="helper-text">Loại banner hiển thị</span>
                </label>

                <label>
                  <span class="label-text">
                    <span class="material-icon">place</span>
                    Vị trí <span class="required">*</span>
                  </span>
                  <select formControlName="position" [class.error]="bannerForm.get('position')?.invalid && bannerForm.get('position')?.touched">
                    <option value="homepage">Homepage</option>
                    <option value="category">Category Page</option>
                    <option value="product">Product Page</option>
                    <option value="sidebar">Sidebar</option>
                  </select>
                  <span class="helper-text">Vị trí hiển thị banner</span>
                </label>

                <label>
                  <span class="label-text">
                    <span class="material-icon">sort</span>
                    Thứ tự hiển thị
                  </span>
                  <input 
                    type="number" 
                    formControlName="order" 
                    min="0" 
                    placeholder="0"
                  />
                  <span class="helper-text">Số nhỏ hơn sẽ hiển thị trước</span>
                </label>
              </div>
            </div>

            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">image</span>
                  Hình ảnh
                </h4>
              </div>
              <div class="form-grid">
                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">image</span>
                    Hình ảnh chính (URL)
                  </span>
                  <input type="url" formControlName="image" placeholder="https://example.com/image.jpg" />
                  <span class="helper-text">URL hình ảnh chính của banner</span>
                  <div class="image-preview" *ngIf="bannerForm.value.image">
                    <img [src]="bannerForm.value.image" alt="Image preview" onerror="this.style.display='none'" />
                  </div>
                </label>

                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">wallpaper</span>
                    Background Image (URL)
                  </span>
                  <input type="url" formControlName="backgroundImage" placeholder="https://example.com/bg.jpg" />
                  <span class="helper-text">URL hình ảnh nền</span>
                  <div class="image-preview" *ngIf="bannerForm.value.backgroundImage">
                    <img [src]="bannerForm.value.backgroundImage" alt="Background preview" onerror="this.style.display='none'" />
                  </div>
                </label>

                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">slideshow</span>
                    Slide Image (URL)
                  </span>
                  <input type="url" formControlName="slideImage" placeholder="https://example.com/slide.jpg" />
                  <span class="helper-text">URL hình ảnh slide (nếu có)</span>
                  <div class="image-preview" *ngIf="bannerForm.value.slideImage">
                    <img [src]="bannerForm.value.slideImage" alt="Slide preview" onerror="this.style.display='none'" />
                  </div>
                </label>
              </div>
            </div>

            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">text_fields</span>
                  Nội dung văn bản
                </h4>
              </div>
              <div class="form-grid">
                <label>
                  <span class="label-text">
                    <span class="material-icon">title</span>
                    Tiêu đề
                  </span>
                  <input type="text" formControlName="title" placeholder="VD: Khuyến mãi đặc biệt" />
                  <span class="helper-text">Tiêu đề hiển thị trên banner</span>
                </label>

                <label>
                  <span class="label-text">
                    <span class="material-icon">subtitles</span>
                    Phụ đề
                  </span>
                  <input type="text" formControlName="subtitle" placeholder="VD: Giảm giá lên đến 50%" />
                  <span class="helper-text">Phụ đề hiển thị dưới tiêu đề</span>
                </label>

                <label>
                  <span class="label-text">
                    <span class="material-icon">smart_button</span>
                    Nút bấm
                  </span>
                  <input type="text" formControlName="buttonText" placeholder="VD: Mua ngay, Xem thêm" />
                  <span class="helper-text">Text hiển thị trên nút bấm</span>
                </label>
              </div>
            </div>

            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">local_offer</span>
                  Badge & Khuyến mãi
                </h4>
              </div>
              <div class="form-grid">
                <label>
                  <span class="label-text">
                    <span class="material-icon">label</span>
                    Badge 1 - Text
                  </span>
                  <input type="text" formControlName="badge1Text" placeholder="VD: Sale, New, Hot" />
                  <span class="helper-text">Text hiển thị trên badge 1</span>
                </label>

                <label>
                  <span class="label-text">
                    <span class="material-icon">percent</span>
                    Badge 1 - Discount
                  </span>
                  <input type="text" formControlName="badge1Discount" placeholder="VD: -50%, 30%" />
                  <span class="helper-text">Giảm giá hiển thị trên badge 1</span>
                </label>

                <label>
                  <span class="label-text">
                    <span class="material-icon">label</span>
                    Badge 2 - Text
                  </span>
                  <input type="text" formControlName="badge2Text" placeholder="VD: Limited, Flash Sale" />
                  <span class="helper-text">Text hiển thị trên badge 2</span>
                </label>

                <label>
                  <span class="label-text">
                    <span class="material-icon">percent</span>
                    Badge 2 - Discount
                  </span>
                  <input type="text" formControlName="badge2Discount" placeholder="VD: -30%, 20%" />
                  <span class="helper-text">Giảm giá hiển thị trên badge 2</span>
                </label>
              </div>
            </div>

            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">link</span>
                  Liên kết & Sản phẩm
                </h4>
              </div>
              <div class="form-grid">
                <label>
                  <span class="label-text">
                    <span class="material-icon">link</span>
                    Link
                  </span>
                  <input type="url" formControlName="link" placeholder="https://example.com/page" />
                  <span class="helper-text">URL khi click vào banner</span>
                </label>

                <label>
                  <span class="label-text">
                    <span class="material-icon">inventory</span>
                    Product ID
                  </span>
                  <input type="text" formControlName="productId" placeholder="ID sản phẩm liên kết" />
                  <span class="helper-text">ID sản phẩm liên kết (nếu có)</span>
                </label>

                <label>
                  <span class="label-text">
                    <span class="material-icon">event</span>
                    Khoảng thời gian
                  </span>
                  <input type="text" formControlName="dateRange" placeholder="VD: 01/11 - 30/11/2025" />
                  <span class="helper-text">Khoảng thời gian áp dụng khuyến mãi</span>
                </label>
              </div>
            </div>

            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">settings</span>
                  Trạng thái
                </h4>
              </div>
              <div class="form-grid">
                <label class="full-width">
                  <div class="toggle-switch">
                    <input 
                      type="checkbox" 
                      formControlName="isActive" 
                      id="banner-active"
                    />
                    <label for="banner-active" class="toggle-label">
                      <span class="toggle-slider"></span>
                      <span class="toggle-text">
                        <span class="material-icon">toggle_on</span>
                        <span>Trạng thái: <strong>{{ bannerForm.value.isActive ? 'Hoạt động' : 'Ẩn' }}</strong></span>
                      </span>
                    </label>
                  </div>
                  <span class="helper-text">Banner ẩn sẽ không hiển thị trên website</span>
                </label>
              </div>
            </div>

            <div class="modal-actions">
              <button type="button" class="ghost" (click)="toggleEditDrawer(false)">
                <span class="material-icon">close</span>
                Hủy
              </button>
              <button type="submit" class="primary" [disabled]="bannerForm.invalid">
                <span class="material-icon">save</span>
                Lưu thay đổi
              </button>
            </div>
          </form>

          <!-- Enhanced Product Edit Form -->
          <form [formGroup]="productForm" (ngSubmit)="submitProductForm()" class="modal-form enhanced-form" *ngIf="!isPromotionCollection() && !isCategoryCollection() && !isBlogCollection() && !isDiseaseCollection() && !isBannerCollection()">
            
            <!-- Progress Steps -->
            <div class="form-progress">
              <div class="progress-step active">
                <span class="step-number">1</span>
                <span class="step-label">Cơ bản</span>
              </div>
              <div class="progress-line"></div>
              <div class="progress-step">
                <span class="step-number">2</span>
                <span class="step-label">Giá & Kho</span>
              </div>
              <div class="progress-line"></div>
              <div class="progress-step">
                <span class="step-number">3</span>
                <span class="step-label">Chi tiết</span>
              </div>
            </div>

            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">info</span>
                  Thông tin cơ bản
                </h4>
                <span class="required-note">* Bắt buộc</span>
              </div>
              <div class="form-grid">
                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">inventory</span>
                    Tên sản phẩm <span class="required">*</span>
                  </span>
                  <input 
                    type="text" 
                    formControlName="name" 
                    placeholder="VD: Panadol Extra giảm đau hạ sốt"
                    [class.error]="productForm.get('name')?.invalid && productForm.get('name')?.touched"
                  />
                  <span class="helper-text">Tên đầy đủ và mô tả ngắn gọn</span>
                  <span class="error-text" *ngIf="productForm.get('name')?.invalid && productForm.get('name')?.touched">
                    Tên sản phẩm là bắt buộc
                  </span>
                </label>
                
                <label>
                  <span class="label-text">
                    <span class="material-icon">sell</span>
                    Thương hiệu
                  </span>
                  <input type="text" formControlName="brand" placeholder="VD: GSK, Sanofi, Abbott" />
                  <span class="helper-text">Nhà sản xuất hoặc thương hiệu</span>
                </label>
                
                <label>
                  <span class="label-text">
                    <span class="material-icon">qr_code</span>
                    Mã SKU
                  </span>
                  <input type="text" formControlName="sku" placeholder="VD: PRD-001" />
                  <span class="helper-text">Mã riêng để quản lý</span>
                </label>
                
                <label>
                  <span class="label-text">
                    <span class="material-icon">link</span>
                    Slug (URL)
                  </span>
                  <div class="input-with-action">
                    <input type="text" formControlName="slug" placeholder="tu-dong-tao-tu-ten" />
                    <button type="button" class="generate-slug-btn" (click)="generateSlug()" title="Tạo slug từ tên">
                      <span class="material-icon">auto_fix_high</span>
                    </button>
                  </div>
                  <span class="helper-text">Tự động tạo từ tên hoặc nhập tùy chỉnh</span>
                </label>
                
                <label>
                  <span class="label-text">
                    <span class="material-icon">public</span>
                    Xuất xứ
                  </span>
                  <input type="text" formControlName="country" placeholder="VD: Việt Nam, USA, Japan" />
                </label>
              </div>
            </div>

            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">payments</span>
                  Giá & Khuyến mãi
                </h4>
              </div>
              <div class="form-grid">
                <label>
                  <span class="label-text">
                    <span class="material-icon">attach_money</span>
                    Giá niêm yết (VND) <span class="required">*</span>
                  </span>
                  <input 
                    type="number" 
                    formControlName="price" 
                    min="0" 
                    step="1000" 
                    placeholder="0"
                    [class.error]="productForm.get('price')?.invalid && productForm.get('price')?.touched"
                  />
                  <span class="helper-text">Giá gốc trước khi giảm</span>
                </label>
                
                <label>
                  <span class="label-text">
                    <span class="material-icon">local_offer</span>
                    Giảm giá (%)
                  </span>
                  <input type="number" formControlName="discount" min="0" max="100" step="5" placeholder="0" />
                  <span class="helper-text">Phần trăm giảm giá (0-100%)</span>
                </label>
              </div>
              
              <div class="price-calculator" *ngIf="(productForm.value.price ?? 0) > 0">
                <div class="calc-row">
                  <span>Giá gốc:</span>
                  <span class="original-price">{{ (productForm.value.price ?? 0) | number }}đ</span>
                </div>
                <div class="calc-row" *ngIf="(productForm.value.discount ?? 0) > 0">
                  <span>Giảm {{ productForm.value.discount ?? 0 }}%:</span>
                  <span class="discount-amount">-{{ ((productForm.value.price ?? 0) * (productForm.value.discount ?? 0) / 100) | number }}đ</span>
                </div>
                <div class="calc-row total">
                  <span>Giá bán:</span>
                  <span class="final-price">{{ pricePreviewValue | currency:'VND':'symbol':'1.0-0' }}</span>
                </div>
              </div>
            </div>

            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">warehouse</span>
                  Kho & Đơn vị
                </h4>
              </div>
              <div class="form-grid">
                <label>
                  <span class="label-text">
                    <span class="material-icon">inventory_2</span>
                    Tồn kho
                  </span>
                  <input 
                    type="number" 
                    formControlName="stock" 
                    min="0" 
                    placeholder="Số lượng"
                  />
                  <span class="helper-text stock-indicator" [class.low]="(productForm.value.stock ?? 0) < 10">
                    {{ (productForm.value.stock ?? 0) < 10 ? '⚠️ Tồn kho thấp' : '✅ Tồn kho đủ' }}
                  </span>
                </label>
                
                <label>
                  <span class="label-text">
                    <span class="material-icon">scale</span>
                    Đơn vị tính
                  </span>
                  <select formControlName="unit">
                    <option value="Hộp">Hộp</option>
                    <option value="Chai">Chai</option>
                    <option value="Vỉ">Vỉ</option>
                    <option value="Viên">Viên</option>
                    <option value="Gói">Gói</option>
                    <option value="Tuýp">Tuýp</option>
                    <option value="Ống">Ống</option>
                  </select>
                  <span class="helper-text">Đơn vị bán lẻ</span>
                </label>
              </div>
            </div>

            <div class="form-section">
              <h4>Hình ảnh sản phẩm</h4>
              <div class="image-management">
                <div class="main-image-section">
                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">image</span>
                      Ảnh chính (URL)
                    </span>
                    <input type="url" formControlName="image" placeholder="https://example.com/image.jpg" />
                  </label>
                  <div class="image-preview" *ngIf="productForm.value.image">
                    <img [src]="productForm.value.image" alt="Preview" onerror="this.style.display='none'" />
                  </div>
                </div>
                
                <div class="gallery-section">
                  <div class="gallery-header">
                    <span class="label-text">
                      <span class="material-icon">collections</span>
                      Thư viện ảnh ({{ imageGalleryList().length }} ảnh)
                    </span>
                    <button type="button" class="add-image-btn" (click)="addImageUrl()">
                      <span class="material-icon">add</span>
                      Thêm URL
                    </button>
                  </div>
                  <div class="gallery-list">
                    <div class="gallery-item" *ngFor="let img of imageGalleryList(); let i = index">
                      <div class="gallery-item-preview">
                        <img [src]="img" alt="Gallery {{ i + 1 }}" onerror="this.parentElement.classList.add('error')" />
                        <button type="button" class="remove-image-btn" (click)="removeImageUrl(i)" title="Xóa ảnh">
                          <span class="material-icon">close</span>
                        </button>
                      </div>
                      <input type="url" [value]="img" (input)="updateImageUrl(i, $event)" placeholder="URL ảnh" />
                    </div>
                    <div class="gallery-item new">
                      <input 
                        type="url" 
                        [value]="newImageUrl()" 
                        (input)="updateNewImageUrl($event)"
                        (keyup.enter)="addImageUrl()"
                        placeholder="Nhập URL ảnh và nhấn Enter" 
                      />
                      <button type="button" class="add-btn" (click)="addImageUrl()" [disabled]="!newImageUrl().trim()">
                        <span class="material-icon">add</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-section">
              <div class="section-title">
                <h4>
                  <span class="material-icon">article</span>
                  Chi tiết sản phẩm
                </h4>
                <span class="optional-note">Tùy chọn</span>
              </div>
              
              <div class="form-grid">
                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">description</span>
                    Mô tả sản phẩm
                  </span>
                  <textarea 
                    formControlName="description" 
                    rows="6" 
                    placeholder="Nhập mô tả chi tiết về sản phẩm, công dụng, đặc điểm nổi bật..."
                    class="form-textarea"
                  ></textarea>
                  <span class="helper-text">Mô tả đầy đủ về sản phẩm để khách hàng hiểu rõ</span>
                </label>

                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">medication</span>
                    Cách sử dụng
                  </span>
                  <textarea 
                    formControlName="usage" 
                    rows="5" 
                    placeholder="Nhập hướng dẫn sử dụng, liều lượng, cách dùng..."
                    class="form-textarea"
                  ></textarea>
                  <span class="helper-text">Hướng dẫn chi tiết cách sử dụng sản phẩm</span>
                </label>

                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">science</span>
                    Thành phần
                  </span>
                  <textarea 
                    formControlName="ingredients" 
                    rows="4" 
                    placeholder="Nhập danh sách thành phần, hoạt chất..."
                    class="form-textarea"
                  ></textarea>
                  <span class="helper-text">Liệt kê các thành phần chính của sản phẩm</span>
                </label>

                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">warning</span>
                    Cảnh báo & Lưu ý
                  </span>
                  <textarea 
                    formControlName="warnings" 
                    rows="4" 
                    placeholder="Nhập các cảnh báo, chống chỉ định, tác dụng phụ..."
                    class="form-textarea"
                  ></textarea>
                  <span class="helper-text">Các lưu ý quan trọng khi sử dụng sản phẩm</span>
                </label>

                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">local_offer</span>
                    Tags (Thẻ)
                  </span>
                  <input 
                    type="text" 
                    formControlName="tags" 
                    placeholder="VD: thuốc, giảm đau, hạ sốt, kháng viêm"
                  />
                  <span class="helper-text">Nhập các từ khóa, phân cách bằng dấu phẩy (VD: thuốc, giảm đau, hạ sốt)</span>
                </label>
              </div>
            </div>

            <div class="form-section">
              <h4>Trạng thái</h4>
              <label class="full-width">
                <span class="label-text">
                  <span class="material-icon">toggle_on</span>
                  Trạng thái hiển thị
                </span>
                <input type="text" formControlName="status" placeholder="Còn hàng, Hết hàng, ..." />
              </label>
            </div>

            <div class="modal-actions">
              <button type="button" class="ghost" (click)="toggleEditDrawer(false)">
                <span class="material-icon">close</span>
                Hủy
              </button>
              <button type="submit" class="primary">
                <span class="material-icon">save</span>
                Lưu thay đổi
              </button>
            </div>
          </form>
        </div>

        <div class="json-preview">
          <button type="button" class="ghost" (click)="toggleJsonModal(true)">
            <span class="material-icon">code</span>
            Xem JSON gốc
          </button>
        </div>
      </ng-container>

      <ng-template #defaultPreview>
        <!-- CREATE MODE: Show forms directly -->
        <ng-container *ngIf="isCreate()">
          <!-- Blog Create Form -->
          <section class="card create-form-card" *ngIf="isBlogCollection()">
            <div class="card-header">
              <h3>
                <span class="material-icon">article</span>
                Tạo bài viết mới
              </h3>
            </div>
            <form [formGroup]="blogForm" (ngSubmit)="submitBlogForm()" class="create-form enhanced-form">
              
              <div class="form-section">
                <div class="section-title">
                  <h4>
                    <span class="material-icon">article</span>
                    Thông tin cơ bản
                  </h4>
                  <span class="required-note">* Bắt buộc</span>
                </div>
                <div class="form-grid">
                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">title</span>
                      Tiêu đề bài viết <span class="required">*</span>
                    </span>
                    <input 
                      type="text" 
                      formControlName="title" 
                      placeholder="VD: 10 cách giảm đau đầu hiệu quả"
                      [class.error]="blogForm.get('title')?.invalid && blogForm.get('title')?.touched"
                    />
                    <span class="helper-text">Tiêu đề chính của bài viết, sẽ hiển thị trên website</span>
                    <span class="error-text" *ngIf="blogForm.get('title')?.invalid && blogForm.get('title')?.touched">
                      Tiêu đề bài viết là bắt buộc
                    </span>
                  </label>
                  
                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">link</span>
                      Slug (URL)
                    </span>
                    <div class="input-with-action">
                      <input type="text" formControlName="slug" placeholder="tu-dong-tao-tu-tieu-de" />
                      <button type="button" class="generate-slug-btn" (click)="generateBlogSlug()" title="Tạo slug từ tiêu đề">
                        <span class="material-icon">auto_fix_high</span>
                      </button>
                    </div>
                    <span class="helper-text">Tự động tạo từ tiêu đề hoặc nhập tùy chỉnh</span>
                  </label>

                  <label>
                    <span class="label-text">
                      <span class="material-icon">badge</span>
                      Mã bài viết
                    </span>
                    <input type="text" formControlName="articleId" placeholder="ID từ hệ thống nguồn" />
                    <span class="helper-text">Mã ID từ hệ thống nguồn (nếu có)</span>
                  </label>

                  <label>
                    <span class="label-text">
                      <span class="material-icon">format_quote</span>
                      Headline
                    </span>
                    <input type="text" formControlName="headline" placeholder="Tiêu đề phụ, câu nổi bật" />
                    <span class="helper-text">Tiêu đề phụ hoặc câu nổi bật</span>
                  </label>
                </div>
              </div>

              <div class="form-section">
                <div class="section-title">
                  <h4>
                    <span class="material-icon">image</span>
                    Hình ảnh & Mô tả
                  </h4>
                </div>
                <div class="form-grid">
                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">image</span>
                      Ảnh bìa (URL)
                    </span>
                    <input type="url" formControlName="coverImage" placeholder="https://example.com/cover.jpg" />
                    <span class="helper-text">URL hình ảnh bìa của bài viết</span>
                    <div class="image-preview" *ngIf="blogForm.value.coverImage">
                      <img [src]="blogForm.value.coverImage" alt="Cover preview" onerror="this.style.display='none'" />
                    </div>
                  </label>

                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">description</span>
                      Mô tả ngắn
                    </span>
                    <textarea 
                      formControlName="shortDescription" 
                      rows="4" 
                      placeholder="Nhập mô tả ngắn gọn về bài viết..."
                      class="form-textarea"
                    ></textarea>
                    <span class="helper-text">Mô tả ngắn gọn sẽ hiển thị trong danh sách bài viết</span>
                  </label>
                </div>
              </div>

              <div class="form-section content-section">
                <div class="section-title">
                  <h4>
                    <span class="material-icon">article</span>
                    Nội dung bài viết
                  </h4>
                  <span class="required-note">* Bắt buộc</span>
                </div>
                <div class="content-editor-wrapper">
                  <div class="editor-tabs">
                    <button 
                      type="button" 
                      class="editor-tab" 
                      [class.active]="!blogPreviewMode()"
                      (click)="blogPreviewMode.set(false)"
                    >
                      <span class="material-icon">edit_note</span>
                      Soạn thảo
                    </button>
                    <button 
                      type="button" 
                      class="editor-tab" 
                      [class.active]="blogPreviewMode()"
                      (click)="blogPreviewMode.set(true)"
                    >
                      <span class="material-icon">visibility</span>
                      Xem trước
                    </button>
                  </div>

                  <div class="content-stats">
                    <span class="stat-item">
                      <span class="material-icon">text_fields</span>
                      <strong>{{ contentWordCount() }}</strong> từ
                    </span>
                    <span class="stat-item">
                      <span class="material-icon">subject</span>
                      <strong>{{ contentCharCount() }}</strong> ký tự
                    </span>
                    <span class="stat-item" *ngIf="contentWordCount() > 0">
                      <span class="material-icon">schedule</span>
                      ~<strong>{{ estimatedReadTime() }}</strong> phút đọc
                    </span>
                  </div>

                  <div class="formatting-toolbar" *ngIf="!blogPreviewMode()">
                    <div class="toolbar-group">
                      <button type="button" class="format-btn" (click)="insertHtmlTag('h2')" title="Tiêu đề H2">
                        <span class="material-icon">title</span>
                        H2
                      </button>
                      <button type="button" class="format-btn" (click)="insertHtmlTag('h3')" title="Tiêu đề H3">
                        <span class="material-icon">title</span>
                        H3
                      </button>
                    </div>
                    <div class="toolbar-separator"></div>
                    <div class="toolbar-group">
                      <button type="button" class="format-btn" (click)="insertHtmlTag('p')" title="Đoạn văn">
                        <span class="material-icon">notes</span>
                      </button>
                      <button type="button" class="format-btn" (click)="insertHtmlTag('strong')" title="In đậm">
                        <span class="material-icon">format_bold</span>
                      </button>
                      <button type="button" class="format-btn" (click)="insertHtmlTag('em')" title="In nghiêng">
                        <span class="material-icon">format_italic</span>
                      </button>
                    </div>
                    <div class="toolbar-separator"></div>
                    <div class="toolbar-group">
                      <button type="button" class="format-btn" (click)="insertHtmlTag('ul')" title="Danh sách">
                        <span class="material-icon">format_list_bulleted</span>
                      </button>
                      <button type="button" class="format-btn" (click)="insertHtmlTag('ol')" title="Danh sách số">
                        <span class="material-icon">format_list_numbered</span>
                      </button>
                    </div>
                    <div class="toolbar-separator"></div>
                    <div class="toolbar-group">
                      <button type="button" class="format-btn" (click)="insertHtmlTag('link')" title="Chèn link">
                        <span class="material-icon">link</span>
                      </button>
                      <button type="button" class="format-btn" (click)="insertHtmlTag('img')" title="Chèn ảnh">
                        <span class="material-icon">image</span>
                      </button>
                    </div>
                  </div>

                  <div class="editor-container" *ngIf="!blogPreviewMode()">
                    <textarea 
                      formControlName="content" 
                      rows="20" 
                      placeholder="Nhập nội dung đầy đủ của bài viết tại đây...&#10;&#10;Bạn có thể:&#10;- Nhập văn bản thuần&#10;- Sử dụng HTML để định dạng&#10;- Chọn văn bản và click các nút phía trên để format&#10;&#10;Ví dụ:&#10;&lt;h2&gt;Tiêu đề phụ&lt;/h2&gt;&#10;&lt;p&gt;Đoạn văn đầu tiên...&lt;/p&gt;&#10;&lt;p&gt;&lt;strong&gt;In đậm&lt;/strong&gt; và &lt;em&gt;in nghiêng&lt;/em&gt;&lt;/p&gt;"
                      class="form-textarea content-textarea"
                      [class.error]="blogForm.get('content')?.invalid && blogForm.get('content')?.touched"
                    ></textarea>
                    <div class="content-validation-hints">
                      <span class="validation-hint" *ngIf="contentCharCount() === 0">
                        <span class="material-icon">error</span>
                        Vui lòng nhập nội dung bài viết
                      </span>
                      <span class="validation-hint warning" *ngIf="contentCharCount() > 0 && contentCharCount() < 100">
                        <span class="material-icon">warning</span>
                        Nội dung quá ngắn (tối thiểu 100 ký tự)
                      </span>
                      <span class="validation-hint success" *ngIf="contentCharCount() >= 100">
                        <span class="material-icon">check_circle</span>
                        Nội dung đủ dài
                      </span>
                    </div>
                  </div>

                  <div class="preview-container" *ngIf="blogPreviewMode()">
                    <div class="preview-header">
                      <span class="material-icon">visibility</span>
                      <span>Xem trước nội dung</span>
                    </div>
                    <div class="preview-content rich-text" [innerHTML]="blogForm.value.content || '<p class=\'empty\'>Chưa có nội dung</p>'"></div>
                  </div>
                </div>
              </div>

              <div class="form-section">
                <div class="section-title">
                  <h4>
                    <span class="material-icon">person</span>
                    Tác giả & Phân loại
                  </h4>
                </div>
                <div class="form-grid">
                  <label>
                    <span class="label-text">
                      <span class="material-icon">person</span>
                      Tên tác giả
                    </span>
                    <input type="text" formControlName="authorName" placeholder="VD: Bác sĩ Nguyễn Văn A" />
                    <span class="helper-text">Tên đầy đủ của tác giả</span>
                  </label>

                  <label>
                    <span class="label-text">
                      <span class="material-icon">work</span>
                      Chức danh
                    </span>
                    <input type="text" formControlName="authorTitle" placeholder="VD: Bác sĩ, Chuyên gia" />
                    <span class="helper-text">Chức danh hoặc vai trò của tác giả</span>
                  </label>

                  <label>
                    <span class="label-text">
                      <span class="material-icon">account_circle</span>
                      Avatar (URL)
                    </span>
                    <input type="url" formControlName="authorAvatar" placeholder="https://example.com/avatar.jpg" />
                    <span class="helper-text">URL ảnh đại diện của tác giả</span>
                  </label>

                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">folder</span>
                      Chuyên mục
                    </span>
                    <input 
                      type="text" 
                      formControlName="categories" 
                      placeholder="VD: Sức khỏe, Y tế, Dinh dưỡng"
                    />
                    <span class="helper-text">Nhập các chuyên mục, phân cách bằng dấu phẩy</span>
                  </label>

                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">local_offer</span>
                      Tags (Từ khóa)
                    </span>
                    <input 
                      type="text" 
                      formControlName="tags" 
                      placeholder="VD: sức khỏe, dinh dưỡng, bệnh tật"
                    />
                    <span class="helper-text">Nhập các từ khóa, phân cách bằng dấu phẩy</span>
                  </label>
                </div>
              </div>

              <div class="form-section">
                <div class="section-title">
                  <h4>
                    <span class="material-icon">link</span>
                    Liên kết & Trạng thái
                  </h4>
                </div>
                <div class="form-grid">
                  <label>
                    <span class="label-text">
                      <span class="material-icon">link</span>
                      URL hiển thị
                    </span>
                    <input type="url" formControlName="url" placeholder="https://example.com/article" />
                    <span class="helper-text">URL hiển thị trên website</span>
                  </label>

                  <label>
                    <span class="label-text">
                      <span class="material-icon">open_in_new</span>
                      Link nguồn
                    </span>
                    <input type="url" formControlName="originalUrl" placeholder="https://source.com/article" />
                    <span class="helper-text">URL gốc từ nguồn (nếu có)</span>
                  </label>

                  <label>
                    <span class="label-text">
                      <span class="material-icon">event</span>
                      Ngày xuất bản
                    </span>
                    <input type="datetime-local" formControlName="publishedAt" />
                    <span class="helper-text">Thời gian xuất bản bài viết</span>
                  </label>

                  <label>
                    <span class="label-text">
                      <span class="material-icon">flag</span>
                      Trạng thái
                    </span>
                    <select formControlName="status">
                      <option value="published">Đã xuất bản</option>
                      <option value="draft">Bản nháp</option>
                      <option value="scheduled">Đã lên lịch</option>
                      <option value="hidden">Ẩn</option>
                      <option value="pending">Chờ phê duyệt</option>
                    </select>
                    <span class="helper-text">Trạng thái hiển thị của bài viết</span>
                  </label>

                  <label class="full-width">
                    <div class="toggle-switch">
                      <input 
                        type="checkbox" 
                        formControlName="isApproved" 
                        id="blog-approved-create"
                      />
                      <label for="blog-approved-create" class="toggle-label">
                        <span class="toggle-slider"></span>
                        <span class="toggle-text">
                          <span class="material-icon">check_circle</span>
                          <span>Đã phê duyệt: <strong>{{ blogForm.value.isApproved ? 'Có' : 'Chưa' }}</strong></span>
                        </span>
                      </label>
                    </div>
                    <span class="helper-text">Bài viết chưa phê duyệt sẽ không hiển thị công khai</span>
                  </label>

                  <label class="full-width">
                    <div class="toggle-switch">
                      <input 
                        type="checkbox" 
                        formControlName="isVisible" 
                        id="blog-visible-create"
                      />
                      <label for="blog-visible-create" class="toggle-label">
                        <span class="toggle-slider"></span>
                        <span class="toggle-text">
                          <span class="material-icon">visibility</span>
                          <span>Hiển thị: <strong>{{ blogForm.value.isVisible ? 'Có' : 'Ẩn' }}</strong></span>
                        </span>
                      </label>
                    </div>
                    <span class="helper-text">Bài viết ẩn sẽ không hiển thị trên website</span>
                  </label>
                </div>
              </div>

              <div class="form-section seo-section">
                <div class="section-title">
                  <h4>
                    <span class="material-icon">search</span>
                    SEO & Metadata
                  </h4>
                  <span class="optional-note">Tối ưu SEO</span>
                </div>
                <div class="form-grid">
                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">title</span>
                      Meta Title (SEO)
                    </span>
                    <input 
                      type="text" 
                      formControlName="metaTitle" 
                      placeholder="Để trống = dùng tiêu đề bài viết"
                      maxlength="60"
                    />
                    <span class="helper-text">Tiêu đề hiển thị trên Google (tối đa 60 ký tự)</span>
                  </label>

                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">description</span>
                      Meta Description (SEO)
                    </span>
                    <textarea 
                      formControlName="metaDescription" 
                      rows="3" 
                      placeholder="Để trống = dùng mô tả ngắn"
                      maxlength="160"
                      class="form-textarea"
                    ></textarea>
                    <span class="helper-text">Mô tả hiển thị trên Google (tối đa 160 ký tự)</span>
                  </label>

                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">label</span>
                      Meta Keywords (SEO)
                    </span>
                    <input 
                      type="text" 
                      formControlName="metaKeywords" 
                      placeholder="Để trống = dùng tags"
                    />
                    <span class="helper-text">Từ khóa SEO, phân cách bằng dấu phẩy</span>
                  </label>

                  <label>
                    <span class="label-text">
                      <span class="material-icon">schedule</span>
                      Thời gian đọc (phút)
                    </span>
                    <input 
                      type="number" 
                      formControlName="readTime" 
                      min="1" 
                      placeholder="Auto"
                    />
                    <span class="helper-text">Tự động: ~{{ estimatedReadTime() }} phút</span>
                  </label>
                </div>
              </div>

              <div class="form-section settings-section">
                <div class="section-title">
                  <h4>
                    <span class="material-icon">settings</span>
                    Cài đặt bổ sung
                  </h4>
                </div>
                <div class="form-grid">
                  <label class="full-width">
                    <div class="toggle-switch">
                      <input 
                        type="checkbox" 
                        formControlName="featured" 
                        id="blog-featured-create"
                      />
                      <label for="blog-featured-create" class="toggle-label">
                        <span class="toggle-slider"></span>
                        <span class="toggle-text">
                          <span class="material-icon">star</span>
                          <span>Bài viết nổi bật: <strong>{{ blogForm.value.featured ? 'Có' : 'Không' }}</strong></span>
                        </span>
                      </label>
                    </div>
                    <span class="helper-text">Bài viết nổi bật sẽ hiển thị ở vị trí ưu tiên</span>
                  </label>

                  <label class="full-width">
                    <div class="toggle-switch">
                      <input 
                        type="checkbox" 
                        formControlName="allowComments" 
                        id="blog-comments-create"
                      />
                      <label for="blog-comments-create" class="toggle-label">
                        <span class="toggle-slider"></span>
                        <span class="toggle-text">
                          <span class="material-icon">comment</span>
                          <span>Cho phép bình luận: <strong>{{ blogForm.value.allowComments ? 'Có' : 'Không' }}</strong></span>
                        </span>
                      </label>
                    </div>
                    <span class="helper-text">Người dùng có thể bình luận vào bài viết này</span>
                  </label>
                </div>
              </div>

              <div class="form-actions">
                <button type="button" class="ghost" routerLink="/collections/blogs">
                  <span class="material-icon">close</span>
                  Hủy
                </button>
                <button type="submit" class="primary" [disabled]="blogForm.invalid">
                  <span class="material-icon">save</span>
                  Tạo bài viết
                </button>
              </div>
            </form>
          </section>

          <!-- Category Create Form -->
          <section class="card create-form-card" *ngIf="isCategoryCollection()">
            <div class="card-header">
              <h3>
                <span class="material-icon">category</span>
                Tạo danh mục mới
              </h3>
            </div>
            <form [formGroup]="categoryForm" (ngSubmit)="submitCategoryForm()" class="create-form enhanced-form">
              
              <div class="form-section">
                <div class="section-title">
                  <h4>
                    <span class="material-icon">category</span>
                    Thông tin cơ bản
                  </h4>
                  <span class="required-note">* Bắt buộc</span>
                </div>
                <div class="form-grid">
                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">label</span>
                      Tên danh mục <span class="required">*</span>
                    </span>
                    <input 
                      type="text" 
                      formControlName="name" 
                      placeholder="VD: Thuốc giảm đau, Vitamin, Dụng cụ y tế"
                      [class.error]="categoryForm.get('name')?.invalid && categoryForm.get('name')?.touched"
                    />
                    <span class="helper-text">Tên danh mục hiển thị trên website</span>
                    <span class="error-text" *ngIf="categoryForm.get('name')?.invalid && categoryForm.get('name')?.touched">
                      Tên danh mục là bắt buộc
                    </span>
                  </label>
                  
                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">link</span>
                      Slug (URL)
                    </span>
                    <div class="input-with-action">
                      <input type="text" formControlName="slug" placeholder="tu-dong-tao-tu-ten" />
                      <button type="button" class="generate-slug-btn" (click)="generateCategorySlug()" title="Tạo slug từ tên">
                        <span class="material-icon">auto_fix_high</span>
                      </button>
                    </div>
                    <span class="helper-text">Tự động tạo từ tên hoặc nhập tùy chỉnh</span>
                  </label>
                </div>
              </div>

              <div class="form-section">
                <div class="section-title">
                  <h4>
                    <span class="material-icon">account_tree</span>
                    Phân cấp & Hiển thị
                  </h4>
                </div>
                <div class="form-grid">
                  <label>
                    <span class="label-text">
                      <span class="material-icon">layers</span>
                      Cấp độ <span class="required">*</span>
                    </span>
                    <select formControlName="level" [class.error]="categoryForm.get('level')?.invalid && categoryForm.get('level')?.touched">
                      <option [value]="1">Cấp 1 (Danh mục chính)</option>
                      <option [value]="2">Cấp 2 (Danh mục con)</option>
                      <option [value]="3">Cấp 3 (Danh mục nhỏ)</option>
                    </select>
                    <span class="helper-text">Chọn cấp độ phân cấp của danh mục</span>
                  </label>
                  
                  <label>
                    <span class="label-text">
                      <span class="material-icon">folder</span>
                      Danh mục cha
                    </span>
                    <select formControlName="parentId">
                      <option value="">-- Không có (Danh mục gốc) --</option>
                      <option 
                        *ngFor="let cat of availableCategories()" 
                        [value]="cat._id"
                      >
                        {{ '  '.repeat(cat.level - 1) }}{{ cat.name }} (Cấp {{ cat.level }})
                      </option>
                    </select>
                    <span class="helper-text">Chọn danh mục cha (chỉ áp dụng cho cấp 2, 3)</span>
                  </label>
                  
                  <label>
                    <span class="label-text">
                      <span class="material-icon">sort</span>
                      Thứ tự hiển thị
                    </span>
                    <input 
                      type="number" 
                      formControlName="displayOrder" 
                      min="0" 
                      placeholder="Để trống = tự động"
                    />
                    <span class="helper-text">Số nhỏ hơn sẽ hiển thị trước</span>
                  </label>
                </div>
              </div>

              <div class="form-section">
                <div class="section-title">
                  <h4>
                    <span class="material-icon">image</span>
                    Icon & Trạng thái
                  </h4>
                </div>
                <div class="form-grid">
                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">image</span>
                      Icon (URL hoặc Material Icon)
                    </span>
                    <input 
                      type="text" 
                      formControlName="icon" 
                      placeholder="VD: https://example.com/icon.png hoặc category"
                    />
                    <span class="helper-text">URL hình ảnh hoặc tên Material Icon</span>
                    <div class="icon-preview" *ngIf="categoryForm.value.icon">
                      <span class="material-icon" *ngIf="!categoryForm.value.icon.startsWith('http')">
                        {{ categoryForm.value.icon }}
                      </span>
                      <img *ngIf="categoryForm.value.icon.startsWith('http')" [src]="categoryForm.value.icon" alt="Icon preview" onerror="this.style.display='none'" />
                    </div>
                  </label>
                  
                  <div class="full-width">
                    <div class="toggle-switch">
                      <input 
                        type="checkbox" 
                        formControlName="isActive" 
                        id="category-active-create"
                      />
                      <label for="category-active-create" class="toggle-label">
                        <span class="toggle-slider"></span>
                        <span class="toggle-text">
                          <span class="material-icon">toggle_on</span>
                          <span>Trạng thái: <strong>{{ categoryForm.value.isActive ? 'Hoạt động' : 'Ẩn' }}</strong></span>
                        </span>
                      </label>
                    </div>
                    <span class="helper-text">Danh mục ẩn sẽ không hiển thị trên website</span>
                  </div>
                </div>
              </div>

              <div class="form-section">
                <div class="section-title">
                  <h4>
                    <span class="material-icon">description</span>
                    Mô tả danh mục
                  </h4>
                  <span class="optional-note">Tùy chọn</span>
                </div>
                <label class="full-width">
                  <span class="label-text">
                    <span class="material-icon">article</span>
                    Mô tả chi tiết
                  </span>
                  <textarea 
                    formControlName="description" 
                    rows="6" 
                    placeholder="Nhập mô tả về danh mục, công dụng, đặc điểm..."
                    class="form-textarea"
                  ></textarea>
                  <span class="helper-text">Mô tả đầy đủ về danh mục để khách hàng hiểu rõ</span>
                </label>
              </div>

              <div class="form-actions">
                <button type="button" class="ghost" routerLink="/collections/categories">
                  <span class="material-icon">close</span>
                  Hủy
                </button>
                <button type="submit" class="primary" [disabled]="categoryForm.invalid">
                  <span class="material-icon">save</span>
                  Tạo danh mục
                </button>
              </div>
            </form>
          </section>

          <!-- Disease Create Form -->
          <section class="card create-form-card" *ngIf="isDiseaseCollection()">
            <div class="card-header">
              <h3>
                <span class="material-icon">healing</span>
                Tạo bệnh lý mới
              </h3>
            </div>
            <form [formGroup]="diseaseForm" (ngSubmit)="submitDiseaseForm()" class="create-form enhanced-form">
              
              <div class="form-section">
                <div class="section-title">
                  <h4>
                    <span class="material-icon">healing</span>
                    Thông tin cơ bản
                  </h4>
                  <span class="required-note">* Bắt buộc</span>
                </div>
                <div class="form-grid">
                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">label</span>
                      Tên bệnh lý <span class="required">*</span>
                    </span>
                    <input 
                      type="text" 
                      formControlName="name" 
                      placeholder="VD: Cảm cúm, Đau đầu, Viêm họng"
                      [class.error]="diseaseForm.get('name')?.invalid && diseaseForm.get('name')?.touched"
                    />
                    <span class="helper-text">Tên bệnh lý chính thức</span>
                    <span class="error-text" *ngIf="diseaseForm.get('name')?.invalid && diseaseForm.get('name')?.touched">
                      Tên bệnh lý là bắt buộc
                    </span>
                  </label>
                  
                  <label>
                    <span class="label-text">
                      <span class="material-icon">badge</span>
                      Mã bệnh
                    </span>
                    <input type="text" formControlName="code" placeholder="Mã ID từ hệ thống nguồn" />
                    <span class="helper-text">Mã ID từ hệ thống nguồn (nếu có)</span>
                  </label>

                  <label>
                    <span class="label-text">
                      <span class="material-icon">link</span>
                      Slug (URL)
                    </span>
                    <div class="input-with-action">
                      <input type="text" formControlName="slug" placeholder="tu-dong-tao-tu-ten" />
                      <button type="button" class="generate-slug-btn" (click)="generateDiseaseSlug()" title="Tạo slug từ tên">
                        <span class="material-icon">auto_fix_high</span>
                      </button>
                    </div>
                    <span class="helper-text">Tự động tạo từ tên hoặc nhập tùy chỉnh</span>
                  </label>

                  <label>
                    <span class="label-text">
                      <span class="material-icon">format_quote</span>
                      Headline
                    </span>
                    <input type="text" formControlName="headline" placeholder="Tiêu đề phụ, câu nổi bật" />
                    <span class="helper-text">Tiêu đề phụ hoặc câu nổi bật</span>
                  </label>
                </div>
              </div>

              <div class="form-section">
                <div class="section-title">
                  <h4>
                    <span class="material-icon">image</span>
                    Hình ảnh & Liên kết
                  </h4>
                </div>
                <div class="form-grid">
                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">image</span>
                      Ảnh bìa (URL)
                    </span>
                    <input type="url" formControlName="coverImage" placeholder="https://example.com/cover.jpg" />
                    <span class="helper-text">URL hình ảnh bìa của bệnh lý</span>
                    <div class="image-preview" *ngIf="diseaseForm.value.coverImage">
                      <img [src]="diseaseForm.value.coverImage" alt="Cover preview" onerror="this.style.display='none'" />
                    </div>
                  </label>

                  <label>
                    <span class="label-text">
                      <span class="material-icon">link</span>
                      URL hiển thị
                    </span>
                    <input type="url" formControlName="url" placeholder="https://example.com/disease" />
                    <span class="helper-text">URL hiển thị trên website</span>
                  </label>

                  <label>
                    <span class="label-text">
                      <span class="material-icon">open_in_new</span>
                      Link nguồn
                    </span>
                    <input type="url" formControlName="originalUrl" placeholder="https://source.com/disease" />
                    <span class="helper-text">URL gốc từ nguồn (nếu có)</span>
                  </label>
                </div>
              </div>

              <div class="form-section">
                <div class="section-title">
                  <h4>
                    <span class="material-icon">description</span>
                    Mô tả & Thông tin chi tiết
                  </h4>
                </div>
                <div class="form-grid">
                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">summary</span>
                      Tóm tắt
                    </span>
                    <textarea 
                      formControlName="summary" 
                      rows="4" 
                      placeholder="Tóm tắt ngắn gọn về bệnh lý..."
                      class="form-textarea"
                    ></textarea>
                    <span class="helper-text">Tóm tắt ngắn gọn về bệnh lý</span>
                  </label>

                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">sick</span>
                      Triệu chứng
                    </span>
                    <textarea 
                      formControlName="symptoms" 
                      rows="6" 
                      placeholder="Mô tả các triệu chứng của bệnh..."
                      class="form-textarea"
                    ></textarea>
                    <span class="helper-text">Các triệu chứng thường gặp</span>
                  </label>

                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">science</span>
                      Nguyên nhân
                    </span>
                    <textarea 
                      formControlName="causes" 
                      rows="6" 
                      placeholder="Mô tả nguyên nhân gây bệnh..."
                      class="form-textarea"
                    ></textarea>
                    <span class="helper-text">Nguyên nhân gây ra bệnh</span>
                  </label>

                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">medication</span>
                      Điều trị
                    </span>
                    <textarea 
                      formControlName="treatment" 
                      rows="6" 
                      placeholder="Mô tả phương pháp điều trị..."
                      class="form-textarea"
                    ></textarea>
                    <span class="helper-text">Phương pháp điều trị</span>
                  </label>

                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">shield</span>
                      Phòng ngừa
                    </span>
                    <textarea 
                      formControlName="prevention" 
                      rows="6" 
                      placeholder="Mô tả cách phòng ngừa..."
                      class="form-textarea"
                    ></textarea>
                    <span class="helper-text">Cách phòng ngừa bệnh</span>
                  </label>

                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">note</span>
                      Ghi chú
                    </span>
                    <textarea 
                      formControlName="notes" 
                      rows="4" 
                      placeholder="Ghi chú bổ sung..."
                      class="form-textarea"
                    ></textarea>
                    <span class="helper-text">Ghi chú bổ sung (nếu có)</span>
                  </label>
                </div>
              </div>

              <div class="form-section">
                <div class="section-title">
                  <h4>
                    <span class="material-icon">category</span>
                    Phân loại & Tên gọi
                  </h4>
                </div>
                <div class="form-grid">
                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">folder</span>
                      Chuyên mục
                    </span>
                    <input 
                      type="text" 
                      formControlName="categories" 
                      placeholder="VD: Bệnh hô hấp, Bệnh tiêu hóa, Bệnh da liễu"
                    />
                    <span class="helper-text">Nhập các chuyên mục, phân cách bằng dấu phẩy</span>
                  </label>

                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">label</span>
                      Tên gọi khác
                    </span>
                    <input 
                      type="text" 
                      formControlName="alternateNames" 
                      placeholder="VD: Cảm lạnh, Sổ mũi, Ho khan"
                    />
                    <span class="helper-text">Các tên gọi khác của bệnh, phân cách bằng dấu phẩy</span>
                  </label>
                </div>
              </div>

              <div class="form-section">
                <div class="section-title">
                  <h4>
                    <span class="material-icon">settings</span>
                    Trạng thái
                  </h4>
                </div>
                <div class="form-grid">
                  <label class="full-width">
                    <div class="toggle-switch">
                      <input 
                        type="checkbox" 
                        formControlName="isVisible" 
                        id="disease-visible-create"
                      />
                      <label for="disease-visible-create" class="toggle-label">
                        <span class="toggle-slider"></span>
                        <span class="toggle-text">
                          <span class="material-icon">visibility</span>
                          <span>Hiển thị: <strong>{{ diseaseForm.value.isVisible ? 'Có' : 'Ẩn' }}</strong></span>
                        </span>
                      </label>
                    </div>
                    <span class="helper-text">Bệnh lý ẩn sẽ không hiển thị trên website</span>
                  </label>
                </div>
              </div>

              <div class="form-actions">
                <button type="button" class="ghost" routerLink="/collections/benh">
                  <span class="material-icon">close</span>
                  Hủy
                </button>
                <button type="submit" class="primary" [disabled]="diseaseForm.invalid">
                  <span class="material-icon">save</span>
                  Tạo bệnh lý
                </button>
              </div>
            </form>
          </section>

          <!-- Banner Create Form -->
          <section class="card create-form-card" *ngIf="isBannerCollection()">
            <div class="card-header">
              <h3>
                <span class="material-icon">image</span>
                Tạo banner mới
              </h3>
            </div>
            <form [formGroup]="bannerForm" (ngSubmit)="submitBannerForm()" class="create-form enhanced-form">
              
              <div class="form-section">
                <div class="section-title">
                  <h4>
                    <span class="material-icon">image</span>
                    Thông tin cơ bản
                  </h4>
                  <span class="required-note">* Bắt buộc</span>
                </div>
                <div class="form-grid">
                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">label</span>
                      Tên banner <span class="required">*</span>
                    </span>
                    <input 
                      type="text" 
                      formControlName="name" 
                      placeholder="VD: Hero Banner 1, Feature Banner, Promotion Banner"
                      [class.error]="bannerForm.get('name')?.invalid && bannerForm.get('name')?.touched"
                    />
                    <span class="helper-text">Tên banner để quản lý</span>
                    <span class="error-text" *ngIf="bannerForm.get('name')?.invalid && bannerForm.get('name')?.touched">
                      Tên banner là bắt buộc
                    </span>
                  </label>

                  <label>
                    <span class="label-text">
                      <span class="material-icon">category</span>
                      Loại banner <span class="required">*</span>
                    </span>
                    <select formControlName="type" [class.error]="bannerForm.get('type')?.invalid && bannerForm.get('type')?.touched">
                      <option value="hero">Hero Banner</option>
                      <option value="feature">Feature Banner</option>
                      <option value="sub">Sub Banner</option>
                      <option value="marketing">Marketing Banner</option>
                    </select>
                    <span class="helper-text">Loại banner hiển thị</span>
                  </label>

                  <label>
                    <span class="label-text">
                      <span class="material-icon">place</span>
                      Vị trí <span class="required">*</span>
                    </span>
                    <select formControlName="position" [class.error]="bannerForm.get('position')?.invalid && bannerForm.get('position')?.touched">
                      <option value="homepage">Homepage</option>
                      <option value="category">Category Page</option>
                      <option value="product">Product Page</option>
                      <option value="sidebar">Sidebar</option>
                    </select>
                    <span class="helper-text">Vị trí hiển thị banner</span>
                  </label>

                  <label>
                    <span class="label-text">
                      <span class="material-icon">sort</span>
                      Thứ tự hiển thị
                    </span>
                    <input 
                      type="number" 
                      formControlName="order" 
                      min="0" 
                      placeholder="0"
                    />
                    <span class="helper-text">Số nhỏ hơn sẽ hiển thị trước</span>
                  </label>
                </div>
              </div>

              <div class="form-section">
                <div class="section-title">
                  <h4>
                    <span class="material-icon">image</span>
                    Hình ảnh
                  </h4>
                </div>
                <div class="form-grid">
                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">image</span>
                      Hình ảnh chính (URL)
                    </span>
                    <input type="url" formControlName="image" placeholder="https://example.com/image.jpg" />
                    <span class="helper-text">URL hình ảnh chính của banner</span>
                    <div class="image-preview" *ngIf="bannerForm.value.image">
                      <img [src]="bannerForm.value.image" alt="Image preview" onerror="this.style.display='none'" />
                    </div>
                  </label>

                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">wallpaper</span>
                      Background Image (URL)
                    </span>
                    <input type="url" formControlName="backgroundImage" placeholder="https://example.com/bg.jpg" />
                    <span class="helper-text">URL hình ảnh nền</span>
                    <div class="image-preview" *ngIf="bannerForm.value.backgroundImage">
                      <img [src]="bannerForm.value.backgroundImage" alt="Background preview" onerror="this.style.display='none'" />
                    </div>
                  </label>

                  <label class="full-width">
                    <span class="label-text">
                      <span class="material-icon">slideshow</span>
                      Slide Image (URL)
                    </span>
                    <input type="url" formControlName="slideImage" placeholder="https://example.com/slide.jpg" />
                    <span class="helper-text">URL hình ảnh slide (nếu có)</span>
                    <div class="image-preview" *ngIf="bannerForm.value.slideImage">
                      <img [src]="bannerForm.value.slideImage" alt="Slide preview" onerror="this.style.display='none'" />
                    </div>
                  </label>
                </div>
              </div>

              <div class="form-section">
                <div class="section-title">
                  <h4>
                    <span class="material-icon">text_fields</span>
                    Nội dung văn bản
                  </h4>
                </div>
                <div class="form-grid">
                  <label>
                    <span class="label-text">
                      <span class="material-icon">title</span>
                      Tiêu đề
                    </span>
                    <input type="text" formControlName="title" placeholder="VD: Khuyến mãi đặc biệt" />
                    <span class="helper-text">Tiêu đề hiển thị trên banner</span>
                  </label>

                  <label>
                    <span class="label-text">
                      <span class="material-icon">subtitles</span>
                      Phụ đề
                    </span>
                    <input type="text" formControlName="subtitle" placeholder="VD: Giảm giá lên đến 50%" />
                    <span class="helper-text">Phụ đề hiển thị dưới tiêu đề</span>
                  </label>

                  <label>
                    <span class="label-text">
                      <span class="material-icon">smart_button</span>
                      Nút bấm
                    </span>
                    <input type="text" formControlName="buttonText" placeholder="VD: Mua ngay, Xem thêm" />
                    <span class="helper-text">Text hiển thị trên nút bấm</span>
                  </label>
                </div>
              </div>

              <div class="form-section">
                <div class="section-title">
                  <h4>
                    <span class="material-icon">local_offer</span>
                    Badge & Khuyến mãi
                  </h4>
                </div>
                <div class="form-grid">
                  <label>
                    <span class="label-text">
                      <span class="material-icon">label</span>
                      Badge 1 - Text
                    </span>
                    <input type="text" formControlName="badge1Text" placeholder="VD: Sale, New, Hot" />
                    <span class="helper-text">Text hiển thị trên badge 1</span>
                  </label>

                  <label>
                    <span class="label-text">
                      <span class="material-icon">percent</span>
                      Badge 1 - Discount
                    </span>
                    <input type="text" formControlName="badge1Discount" placeholder="VD: -50%, 30%" />
                    <span class="helper-text">Giảm giá hiển thị trên badge 1</span>
                  </label>

                  <label>
                    <span class="label-text">
                      <span class="material-icon">label</span>
                      Badge 2 - Text
                    </span>
                    <input type="text" formControlName="badge2Text" placeholder="VD: Limited, Flash Sale" />
                    <span class="helper-text">Text hiển thị trên badge 2</span>
                  </label>

                  <label>
                    <span class="label-text">
                      <span class="material-icon">percent</span>
                      Badge 2 - Discount
                    </span>
                    <input type="text" formControlName="badge2Discount" placeholder="VD: -30%, 20%" />
                    <span class="helper-text">Giảm giá hiển thị trên badge 2</span>
                  </label>
                </div>
              </div>

              <div class="form-section">
                <div class="section-title">
                  <h4>
                    <span class="material-icon">link</span>
                    Liên kết & Sản phẩm
                  </h4>
                </div>
                <div class="form-grid">
                  <label>
                    <span class="label-text">
                      <span class="material-icon">link</span>
                      Link
                    </span>
                    <input type="url" formControlName="link" placeholder="https://example.com/page" />
                    <span class="helper-text">URL khi click vào banner</span>
                  </label>

                  <label>
                    <span class="label-text">
                      <span class="material-icon">inventory</span>
                      Product ID
                    </span>
                    <input type="text" formControlName="productId" placeholder="ID sản phẩm liên kết" />
                    <span class="helper-text">ID sản phẩm liên kết (nếu có)</span>
                  </label>

                  <label>
                    <span class="label-text">
                      <span class="material-icon">event</span>
                      Khoảng thời gian
                    </span>
                    <input type="text" formControlName="dateRange" placeholder="VD: 01/11 - 30/11/2025" />
                    <span class="helper-text">Khoảng thời gian áp dụng khuyến mãi</span>
                  </label>
                </div>
              </div>

              <div class="form-section">
                <div class="section-title">
                  <h4>
                    <span class="material-icon">settings</span>
                    Trạng thái
                  </h4>
                </div>
                <div class="form-grid">
                  <label class="full-width">
                    <div class="toggle-switch">
                      <input 
                        type="checkbox" 
                        formControlName="isActive" 
                        id="banner-active-create"
                      />
                      <label for="banner-active-create" class="toggle-label">
                        <span class="toggle-slider"></span>
                        <span class="toggle-text">
                          <span class="material-icon">toggle_on</span>
                          <span>Trạng thái: <strong>{{ bannerForm.value.isActive ? 'Hoạt động' : 'Ẩn' }}</strong></span>
                        </span>
                      </label>
                    </div>
                    <span class="helper-text">Banner ẩn sẽ không hiển thị trên website</span>
                  </label>
                </div>
              </div>

              <div class="form-actions">
                <button type="button" class="ghost" routerLink="/collections/banners">
                  <span class="material-icon">close</span>
                  Hủy
                </button>
                <button type="submit" class="primary" [disabled]="bannerForm.invalid">
                  <span class="material-icon">save</span>
                  Tạo banner
                </button>
              </div>
            </form>
          </section>

          <!-- Default JSON Editor for other collections -->
          <div class="json-preview" *ngIf="!isBlogCollection() && !isCategoryCollection() && !isDiseaseCollection() && !isBannerCollection()">
            <button type="button" class="ghost" (click)="toggleJsonModal(true)">
              <span class="material-icon">code</span>
              Xem JSON gốc
            </button>
          </div>
        </ng-container>

        <!-- EDIT MODE: Default fallback -->
        <ng-container *ngIf="!isCreate() && !voucherView() && !categoryView() && !blogView() && !diseaseView() && !userView() && !orderView() && !tuvanThuocView()">
          <div class="json-preview">
            <button type="button" class="ghost" (click)="toggleJsonModal(true)">
              <span class="material-icon">code</span>
              Xem JSON gốc
            </button>
          </div>
        </ng-container>
      </ng-template>
    </article>
  </div>

  <div class="loading" *ngIf="loading()">
    <span class="spinner"></span>
    Đang tải dữ liệu...
  </div>
</section>

<ng-container *ngIf="showConfirmOrderModal()">
  <div class="modal-backdrop" (click)="closeConfirmOrderModal()"></div>
  <div class="confirm-modal">
    <div class="confirm-icon">
      <span class="material-icon">help</span>
    </div>
    <h3>Xác nhận đơn hàng?</h3>
    <p>Đơn hàng sẽ chuyển sang trạng thái <strong>Đang xử lý</strong> và hệ thống sẽ tự động đánh dấu <strong>Đã giao</strong> sau 2 ngày.</p>
    <div class="confirm-actions">
      <button type="button" class="ghost" (click)="closeConfirmOrderModal()">Hủy</button>
      <button type="button" class="primary" (click)="confirmOrder()" [disabled]="confirmingOrder()">
        <span *ngIf="!confirmingOrder()">Xác nhận</span>
        <span class="spinner" *ngIf="confirmingOrder()"></span>
      </button>
    </div>
  </div>
</ng-container>

<ng-container *ngIf="showJsonModal()">
  <div class="json-modal-backdrop" (click)="toggleJsonModal(false)"></div>
  <div class="json-modal">
    <header>
      <h3>Dữ liệu JSON</h3>
      <button type="button" (click)="toggleJsonModal(false)">
        <span class="material-icon">close</span>
      </button>
    </header>
    <textarea
      rows="24"
      [ngModel]="jsonValue()"
      (ngModelChange)="jsonValue.set($event)"
      spellcheck="false"
    ></textarea>
    <footer>
      <small>Ghi chú: API backend sẽ tự động chuẩn hóa các trường thời gian và ObjectId phù hợp.</small>
      <div class="actions">
        <button type="button" class="ghost" (click)="toggleJsonModal(false)">Đóng</button>
        <button type="button" class="primary" (click)="toggleJsonModal(false)">Xong</button>
      </div>
    </footer>
  </div>
</ng-container>

<ng-template #missing>
  <div class="empty">
    <span class="material-icon">report</span>
    <p>Không tìm thấy tài nguyên hoặc bạn không có quyền truy cập.</p>
    <a routerLink="/dashboard">Quay lại dashboard</a>
  </div>
</ng-template>

