<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thanh toán | MediCare</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/pages.css">
    <link rel="icon" type="image/png" href="../assets/images/logo_tròn.png">
    <meta name="robots" content="noindex">
</head>
<body>

    <!-- Top Bar -->
    <div class="top-bar">
        <div class="top-bar-content">
            <div class="top-bar-left">
                <span><img src="../assets/images/search-13-24.png" height="20" width="20" alt="Search Icon"></span>
                <span>Tìm hiểu về chúng tôi</span>
                <span>MediCare</span>
            </div>
            <div class="top-bar-right">
                <span><img src="../assets/images/phone-call-white-icon.png" height="20" width="20" alt="Call Icon"></span>
                <span>Tư vấn ngay: 1900 0908</span>
            </div>
        </div>
    </div>

    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <img src="../assets/images/LOGO Vàng MediCare.PNG" height="200" width="auto" alt="MediCare Logo">
            </div>
            <div class="search-bar">
                <input type="text" placeholder="Tìm tên thuốc, bệnh lý, ...">
                <div class="search-icons">
                    <div class="icon-btn"><img src="../assets/images/microphone_17695410.png" height="30" width="30" alt="Microphone Icon"></div>
                    <div class="icon-btn"><img src="../assets/images/photo_15307179.png" height="30" width="30" alt="Camera Icon"></div>
                </div>
            </div>
            <div class="personal-info">
                <div class="phone-icon"><img src="../assets/images/avatar_15657781.png" height="50" width="50" alt="Avatar Icon"></div>
                <div class="phone-number">0987654321</div>
                <div class="personal-popup">    
                    <div class="popup-item">
                        <div class="popup-icon"><img src="../assets/images/8324223_ui_essential_app_avatar_profile_icon.png" height="20" width="20" alt="Avatar Icon"></div>
                        <span>Thông tin cá nhân</span>
                    </div>
                    <div class="popup-item">
                        <div class="popup-icon"><img src="../assets/images/9025861_package_box_icon.png" height="20" width="20" alt="Amazon Icon"></div>
                        <span>Đơn hàng của tôi</span>
                    </div>
                    <div class="popup-item">
                        <div class="popup-icon"><img src="../assets/images/2849827_pointer_map_location_place_multimedia_icon.png" height="20" width="20" alt="Map Icon"></div>
                        <span>Quản lý sổ địa chỉ</span>
                    </div>
                    <div class="popup-item">
                        <div class="popup-icon"><img src="../assets/images/9104136_logout_sign out_exit_dooe_out_icon.png" height="20" width="20" alt="Sign Out Icon"></div>
                        <span>Đăng xuất</span>
                    </div>
                </div>
            </div>
            <div class="cart-container">
                <div class="cart-btn"><img src="../assets/images/shopping-cart_6387626.png" height="50" width="50" alt="Cart Icon"></div>
                <div class="cart-badge">1</div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="nav">
        <div class="nav-content">
            <div class="nav-item"><span>Thực phẩm chức năng</span><span class="nav-arrow">▼</span></div>
            <div class="nav-item"><span>Dược mỹ phẩm</span><span class="nav-arrow">▼</span></div>
            <div class="nav-item"><span>Thuốc</span><span class="nav-arrow">▼</span></div>
            <div class="nav-item"><span>Chăm sóc cá nhân</span><span class="nav-arrow">▼</span></div>
            <div class="nav-item"><span>Thiết bị y tế</span><span class="nav-arrow">▼</span></div>
            <div class="nav-item"><span>Góc sức khỏe</span><span class="nav-arrow">▼</span></div>
        </div>
    </div>

    <main class="container cart-container">
        <div class="cart-topbar">
            <a href="cart.html" class="back-link">← Quay lại giỏ hàng</a>
        </div>

        <section class="cart-main cart-shell">
            <!-- Cột trái: Địa chỉ giao hàng -->
            <div class="cart-list">
                <h3>Địa chỉ giao hàng</h3>
                
                <!-- Danh sách địa chỉ từ database -->
                <div class="address-section">
                    <div class="address-list" id="address-list">
                        <!-- Địa chỉ sẽ được load từ database -->
                        <div class="address-item">
                            <label class="address-radio">
                                <input type="radio" name="delivery-address" value="1" checked>
                                <div class="address-content">
                                    <div class="address-header">
                                        <span class="address-name">Nguyễn Văn A</span>
                                        <span class="address-phone">0987654321</span>
                                        <span class="address-default">Mặc định</span>
                                    </div>
                                    <div class="address-details">
                                        <span class="address-full">123 Đường ABC, Phường XYZ, Quận 1, TP.HCM</span>
                                    </div>
                                </div>
                            </label>
                        </div>
                        
                        <div class="address-item">
                            <label class="address-radio">
                                <input type="radio" name="delivery-address" value="2">
                                <div class="address-content">
                                    <div class="address-header">
                                        <span class="address-name">Nguyễn Văn A</span>
                                        <span class="address-phone">0987654321</span>
                                    </div>
                                    <div class="address-details">
                                        <span class="address-full">456 Đường DEF, Phường UVW, Quận 2, TP.HCM</span>
                                    </div>
                                </div>
                            </label>
                        </div>
                        
                        <div class="address-item">
                            <label class="address-radio">
                                <input type="radio" name="delivery-address" value="3">
                                <div class="address-content">
                                    <div class="address-header">
                                        <span class="address-name">Nguyễn Văn A</span>
                                        <span class="address-phone">0987654321</span>
                                    </div>
                                    <div class="address-details">
                                        <span class="address-full">789 Đường GHI, Phường RST, Quận 3, TP.HCM</span>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Nút thêm địa chỉ mới -->
                    <button class="btn-outline add-address-btn" id="add-address-btn">
                        <span>+</span> Thêm địa chỉ mới
                    </button>
                </div>

                <!-- Form thêm địa chỉ mới (ẩn mặc định) -->
                <div class="new-address-form" id="new-address-form" style="display: none;">
                    <h4>Thêm địa chỉ mới</h4>
                    <div class="form-section">
                        <input type="text" placeholder="Họ và tên người nhận" id="new-name">
                        <input type="text" placeholder="Số điện thoại" id="new-phone">
                        <input type="email" placeholder="Email (không bắt buộc)" id="new-email">
                    </div>
                    <div class="form-section">
                        <h4>Địa chỉ giao hàng</h4>
                        <input type="text" placeholder="Tỉnh/Thành phố" id="new-city">
                        <input type="text" placeholder="Quận/Huyện" id="new-district">
                        <input type="text" placeholder="Phường/Xã" id="new-ward">
                        <textarea rows="3" placeholder="Địa chỉ cụ thể (số nhà, đường...)" id="new-address"></textarea>
                        <label class="checkbox-label">
                            <input type="checkbox" id="set-default">
                            <span>Đặt làm địa chỉ mặc định</span>
                        </label>
                    </div>
                    <div class="form-actions">
                        <button class="btn-outline" id="cancel-add-address">Hủy</button>
                        <button class="btn-primary" id="save-address">Lưu địa chỉ</button>
                    </div>
                </div>

                <!-- Phương thức thanh toán -->
                <div class="form-section payment-methods">
                    <h4>Phương thức thanh toán</h4>

                    <label>
                        <span><img src="../assets/images/payment/cash.png" alt=""> Tiền mặt khi nhận hàng (COD)</span>
                        <input type="radio" name="payment" value="cod" checked>
                    </label>

                    <label>
                        <span><img src="../assets/images/payment/qr.png" alt=""> Chuyển khoản (QR Code)</span>
                        <input type="radio" name="payment" value="bank_transfer">
                    </label>

                    <label>
                        <span><img src="../assets/images/payment/bank.png" alt=""> Thẻ ATM nội địa/Ngân hàng</span>
                        <input type="radio" name="payment" value="bank_transfer">
                    </label>

                    <label>
                        <span><img src="../assets/images/payment/card.png" alt=""> Thẻ quốc tế Visa/Master/JCB/AMEX</span>
                        <input type="radio" name="payment" value="card">
                    </label>

                    <label>
                        <span><img src="../assets/images/payment/momo.png" alt=""> Ví MoMo</span>
                        <input type="radio" name="payment" value="momo">
                    </label>
                </div>
            </div>

            <!-- Cột phải: Tổng tiền -->
            <aside class="cart-summary cart-summary--card">
                <h3>Thông tin đơn hàng</h3>
                <div class="summary-row">
                    <span>Tạm tính</span>
                    <span class="subtotal">315.000₫</span>
                </div>
                <div class="summary-row">
                    <span>Giảm giá trực tiếp</span>
                    <span class="discount">123.000₫</span>
                </div>
                <div class="summary-row">
                    <span>Phí vận chuyển</span>
                    <span class="shipping">0₫</span>
                </div>
                <div class="summary-divider"></div>
                <div class="summary-row total">
                    <span>Thành tiền</span>
                    <span class="final-price">492.000₫</span>
                </div>
                <button class="btn-primary btn-pill" id="complete-order">Hoàn tất</button>
                <p class="cart-note">Bằng việc hoàn tất, bạn đồng ý với <a href="#">Điều khoản dịch vụ</a> và <a href="#">Chính sách xử lý dữ liệu cá nhân</a> của MediCare.</p>
            </aside>
        </section>

        <!-- Sản phẩm vừa xem -->
        <section class="recent-products">
            <h2>Sản phẩm vừa xem</h2>
            <div class="product-slider">
                <div class="product-card">
                    <img src="../assets/images/product1.jpg" alt="">
                    <p>Viên uống Glucosamine</p>
                    <p class="price">960.000₫</p>
                    <button class="btn-outline">Chọn mua</button>
                </div>
                <div class="product-card">
                    <img src="../assets/images/product2.jpg" alt="">
                    <p>Dung dịch LinhBon</p>
                    <p class="price">295.000₫</p>
                    <button class="btn-outline">Chọn mua</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <div class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>VỀ CHÚNG TÔI</h3>
                <a href="#">Giới thiệu</a>
                <a href="#">Chính sách đặt cọc</a>
                <a href="#">Chính sách đổi trả thuốc</a>
                <a href="#">Chính sách giao hàng</a>
                <a href="#">Chính sách thanh toán</a>
            </div>
            <div class="footer-section">
                <h3>DANH MỤC</h3>
                <a href="#">Thực phẩm chức năng</a>
                <a href="#">Dược mỹ phẩm</a>
                <a href="#">Thuốc</a>
                <a href="#">Chăm sóc cá nhân</a>
                <a href="#">Trang thiết bị y tế</a>
            </div>
            <div class="footer-section">
                <h3>TÌM HIỂU THÊM</h3>
                <a href="#">Góc sức khoẻ</a>
                <a href="#">Tra cứu thuốc</a>
                <a href="#">Bệnh thường gặp</a>
            </div>
            <div class="footer-section">
                <h3>TỔNG ĐÀI (8:00-22:00)</h3>
                <div>Tư vấn mua hàng</div>
                <div class="footer-phone">1900 0908</div>
                <div style="margin-top: 15px;">Góp ý, khiếu nại và tiếp nhận cảnh báo thông tin vi phạm</div>
                <div class="footer-phone">1900 0908</div>
                <h3 style="margin-top: 30px;">KẾT NỐI VỚI CHÚNG TÔI</h3>
                <div class="social-icons">
                    <div class="social-icon"><img src="../assets/images/Facebook_Logo_(2019).png"  alt="Facebook Icon"></div>
                    <div class="social-icon"><img src="../assets/images/icon-zalo.png"  alt="Zalo Icon"></div>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            © MediCare 2025 – Safe & Smart Healthcare Online.
        </div>
    </div>

    <script src="../js/utils.js"></script>
    <script>
        // Demo data for addresses
        const demoAddresses = [
            {
                id: 1,
                name: "Nguyễn Văn A",
                phone: "0987654321",
                email: "nguyenvana@email.com",
                address: "123 Đường ABC, Phường XYZ, Quận 1, TP.HCM",
                isDefault: true
            },
            {
                id: 2,
                name: "Nguyễn Văn A",
                phone: "0987654321",
                email: "nguyenvana@email.com",
                address: "456 Đường DEF, Phường UVW, Quận 2, TP.HCM",
                isDefault: false
            },
            {
                id: 3,
                name: "Nguyễn Văn A",
                phone: "0987654321",
                email: "nguyenvana@email.com",
                address: "789 Đường GHI, Phường RST, Quận 3, TP.HCM",
                isDefault: false
            }
        ];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Load addresses from database (demo)
            loadAddresses();
            
            // Initialize payment display
            updatePaymentDisplay();
            
            // Setup event listeners
            setupEventListeners();
        });

        // Load addresses from database
        function loadAddresses() {
            const addressList = document.getElementById('address-list');
            addressList.innerHTML = '';

            demoAddresses.forEach(address => {
                const addressItem = createAddressItem(address);
                addressList.appendChild(addressItem);
            });
        }

        // Create address item element
        function createAddressItem(address) {
            const addressItem = document.createElement('div');
            addressItem.className = 'address-item';
            
            addressItem.innerHTML = `
                <label class="address-radio">
                    <input type="radio" name="delivery-address" value="${address.id}" ${address.isDefault ? 'checked' : ''}>
                    <div class="address-content">
                        <div class="address-header">
                            <span class="address-name">${address.name}</span>
                            <span class="address-phone">${address.phone}</span>
                            ${address.isDefault ? '<span class="address-default">Mặc định</span>' : ''}
                        </div>
                        <div class="address-details">
                            <span class="address-full">${address.address}</span>
                        </div>
                    </div>
                </label>
            `;
            
            return addressItem;
        }

        // Update payment display
        function updatePaymentDisplay() {
            // Get cart data from sessionStorage or use default
            const cartData = JSON.parse(sessionStorage.getItem('cartData')) || {
                subtotal: 492000,
                discount: 123000,
                shipping: 0
            };
            
            // Update display
            const subtotalElement = document.querySelector('.subtotal');
            if (subtotalElement) {
                subtotalElement.textContent = formatVnd(cartData.subtotal);
            }
            
            const discountElement = document.querySelector('.discount');
            if (discountElement) {
                discountElement.textContent = formatVnd(cartData.discount);
            }
            
            const shippingElement = document.querySelector('.shipping');
            if (shippingElement) {
                shippingElement.textContent = formatVnd(cartData.shipping);
            }
            
            // Calculate final total
            const finalTotal = calculateFinalTotal(cartData.subtotal, cartData.discount, cartData.shipping);
            const finalPriceElement = document.querySelector('.final-price');
            if (finalPriceElement) {
                finalPriceElement.textContent = formatVnd(finalTotal);
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Add address button
            const addAddressBtn = document.getElementById('add-address-btn');
            const newAddressForm = document.getElementById('new-address-form');
            const cancelBtn = document.getElementById('cancel-add-address');
            const saveBtn = document.getElementById('save-address');

            addAddressBtn.addEventListener('click', () => {
                newAddressForm.style.display = 'block';
                addAddressBtn.style.display = 'none';
            });

            cancelBtn.addEventListener('click', () => {
                newAddressForm.style.display = 'none';
                addAddressBtn.style.display = 'block';
                clearNewAddressForm();
            });

            saveBtn.addEventListener('click', () => {
                saveNewAddress();
            });

            // Complete order button
            const completeOrderBtn = document.getElementById('complete-order');
            completeOrderBtn.addEventListener('click', () => {
                processOrder();
            });

            // Address selection
            document.addEventListener('change', (e) => {
                if (e.target.name === 'delivery-address') {
                    const selectedAddress = demoAddresses.find(addr => addr.id == e.target.value);
                    console.log('Selected address:', selectedAddress);
                }
            });
        }

        // Clear new address form
        function clearNewAddressForm() {
            document.getElementById('new-name').value = '';
            document.getElementById('new-phone').value = '';
            document.getElementById('new-email').value = '';
            document.getElementById('new-city').value = '';
            document.getElementById('new-district').value = '';
            document.getElementById('new-ward').value = '';
            document.getElementById('new-address').value = '';
            document.getElementById('set-default').checked = false;
        }

        // Save new address
        function saveNewAddress() {
            const name = document.getElementById('new-name').value.trim();
            const phone = document.getElementById('new-phone').value.trim();
            const email = document.getElementById('new-email').value.trim();
            const city = document.getElementById('new-city').value.trim();
            const district = document.getElementById('new-district').value.trim();
            const ward = document.getElementById('new-ward').value.trim();
            const address = document.getElementById('new-address').value.trim();
            const isDefault = document.getElementById('set-default').checked;

            // Validation
            if (!name || !phone || !city || !district || !ward || !address) {
                showNotification('Vui lòng điền đầy đủ thông tin bắt buộc', 'error');
                return;
            }

            if (!isValidPhone(phone)) {
                showNotification('Số điện thoại không hợp lệ', 'error');
                return;
            }

            if (email && !isValidEmail(email)) {
                showNotification('Email không hợp lệ', 'error');
                return;
            }

            // Create new address object
            const newAddress = {
                id: demoAddresses.length + 1,
                name,
                phone,
                email,
                address: `${address}, ${ward}, ${district}, ${city}`,
                isDefault
            };

            // If setting as default, unset other defaults
            if (isDefault) {
                demoAddresses.forEach(addr => addr.isDefault = false);
            }

            // Add to addresses array
            demoAddresses.push(newAddress);

            // Reload addresses
            loadAddresses();

            // Hide form
            document.getElementById('new-address-form').style.display = 'none';
            document.getElementById('add-address-btn').style.display = 'block';

            // Clear form
            clearNewAddressForm();

            showNotification('Địa chỉ đã được lưu thành công!', 'success');
        }

        // Show order success popup
        function showOrderSuccessPopup(orderId) {
            // Create popup overlay
            const overlay = document.createElement('div');
            overlay.className = 'order-success-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;
            
            // Create popup content
            const popup = document.createElement('div');
            popup.className = 'order-success-popup';
            popup.style.cssText = `
                background: white;
                border-radius: 12px;
                padding: 30px;
                max-width: 400px;
                width: 90%;
                text-align: center;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                animation: slideUp 0.3s ease;
            `;
            
            popup.innerHTML = `
                <div class="success-icon" style="
                    width: 60px;
                    height: 60px;
                    background-color: #4CAF50;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin: 0 auto 20px;
                    font-size: 30px;
                    color: white;
                ">✓</div>
                <h2 style="color: #333; margin-bottom: 10px;">Đặt hàng thành công!</h2>
                <p style="color: #666; margin-bottom: 20px;">Cảm ơn bạn đã mua sắm tại MediCare</p>
                <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 25px;">
                    <p style="margin: 0; color: #333; font-weight: 600;">Mã đơn hàng: <span style="color: #2196F3;">${orderId}</span></p>
                </div>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="btn-outline" id="go-home-btn" style="flex: 1; padding: 12px;">Trang chủ</button>
                    <button class="btn-primary" id="check-order-btn" style="flex: 1; padding: 12px;">Kiểm tra đơn hàng</button>
                </div>
            `;
            
            overlay.appendChild(popup);
            document.body.appendChild(overlay);
            
            // Add animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                @keyframes slideUp {
                    from { transform: translateY(30px); opacity: 0; }
                    to { transform: translateY(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            // Event listeners for buttons
            document.getElementById('go-home-btn').addEventListener('click', () => {
                window.location.href = '../index.html'; // Adjust path as needed
            });
            
            document.getElementById('check-order-btn').addEventListener('click', () => {
                window.location.href = 'order.html';
            });
            
            // Close popup when clicking overlay
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
        }

        // Process order
        function processOrder() {
            const selectedAddress = document.querySelector('input[name="delivery-address"]:checked');
            const selectedPayment = document.querySelector('input[name="payment"]:checked');

            if (!selectedAddress) {
                showNotification('Vui lòng chọn địa chỉ giao hàng', 'error');
                return;
            }

            if (!selectedPayment) {
                showNotification('Vui lòng chọn phương thức thanh toán', 'error');
                return;
            }

            // Get selected address details
            const addressId = selectedAddress.value;
            const address = demoAddresses.find(addr => addr.id == addressId);

            // Show loading state
            const completeBtn = document.getElementById('complete-order');
            completeBtn.textContent = 'Đang xử lý...';
            completeBtn.disabled = true;

            // Simulate order processing
            setTimeout(() => {
                const orderId = generateOrderId();
                showOrderSuccessPopup(orderId);
                
                // Reset button
                completeBtn.textContent = 'Hoàn tất';
                completeBtn.disabled = false;
            }, 2000);
        }
    </script>

    <style>
        /* Custom styles for address selection */
        .address-section {
            margin-bottom: 20px;
        }

        .address-list {
            margin-bottom: 15px;
        }

        .address-item {
            margin-bottom: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }

        .address-radio {
            display: block;
            cursor: pointer;
            padding: 0;
        }

        .address-radio input[type="radio"] {
            display: none;
        }

        .address-content {
            padding: 15px;
            transition: background-color 0.2s;
        }

        .address-radio:hover .address-content {
            background-color: #f8f9fa;
        }

        .address-radio input[type="radio"]:checked + .address-content {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
        }

        .address-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }

        .address-name {
            font-weight: 600;
            color: #333;
        }

        .address-phone {
            color: #666;
            font-size: 14px;
        }

        .address-default {
            background-color: #4caf50;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .address-details {
            color: #666;
            font-size: 14px;
        }

        .add-address-btn {
            width: 100%;
            padding: 12px;
            border: 2px dashed #ddd;
            background-color: transparent;
            color: #666;
            cursor: pointer;
            transition: all 0.2s;
        }

        .add-address-btn:hover {
            border-color: #2196f3;
            color: #2196f3;
        }

        .new-address-form {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            background-color: #f8f9fa;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 15px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            cursor: pointer;
        }

        .checkbox-label input[type="checkbox"] {
            margin: 0;
        }
    </style>
</body>
</html>
