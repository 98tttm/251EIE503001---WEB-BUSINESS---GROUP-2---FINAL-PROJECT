<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thanh toán | MediCare</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/pages.css">
    <link rel="icon" type="image/png" href="../assets/images/logo_tròn.png">
    <meta name="robots" content="noindex">
</head>
<body>

    <!-- Top Bar -->
    <div class="top-bar">
        <div class="top-bar-content">
            <div class="top-bar-left">
                <span><img src="../assets/images/search-13-24.png" height="20" width="20" alt="Search Icon"></span>
                <span>Tìm hiểu về chúng tôi</span>
                <span>MediCare</span>
            </div>
            <div class="top-bar-right">
                <span><img src="../assets/images/phone-call-white-icon.png" height="20" width="20" alt="Call Icon"></span>
                <span>Tư vấn ngay: 1900 0908</span>
            </div>
        </div>
    </div>

    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <img src="../assets/images/LOGO Vàng MediCare.PNG" height="200" width="auto" alt="MediCare Logo">
            </div>
            <div class="search-bar">
                <input type="text" placeholder="Tìm tên thuốc, bệnh lý, ...">
                <div class="search-icons">
                    <div class="icon-btn"><img src="../assets/images/microphone_17695410.png" height="30" width="30" alt="Microphone Icon"></div>
                    <div class="icon-btn"><img src="../assets/images/photo_15307179.png" height="30" width="30" alt="Camera Icon"></div>
                </div>
            </div>
            <div class="personal-info">
                <div class="phone-icon"><img src="../assets/images/avatar_15657781.png" height="50" width="50" alt="Avatar Icon"></div>
                <div class="phone-number">0987654321</div>
                <div class="personal-popup">    
                    <div class="popup-item">
                        <div class="popup-icon"><img src="../assets/images/8324223_ui_essential_app_avatar_profile_icon.png" height="20" width="20" alt="Avatar Icon"></div>
                        <span>Thông tin cá nhân</span>
                    </div>
                    <div class="popup-item">
                        <div class="popup-icon"><img src="../assets/images/9025861_package_box_icon.png" height="20" width="20" alt="Amazon Icon"></div>
                        <span>Đơn hàng của tôi</span>
                    </div>
                    <div class="popup-item">
                        <div class="popup-icon"><img src="../assets/images/2849827_pointer_map_location_place_multimedia_icon.png" height="20" width="20" alt="Map Icon"></div>
                        <span>Quản lý sổ địa chỉ</span>
                    </div>
                    <div class="popup-item">
                        <div class="popup-icon"><img src="../assets/images/9104136_logout_sign out_exit_dooe_out_icon.png" height="20" width="20" alt="Sign Out Icon"></div>
                        <span>Đăng xuất</span>
                    </div>
                </div>
            </div>
            <div class="cart-container">
                <div class="cart-btn"><img src="../assets/images/shopping-cart_6387626.png" height="50" width="50" alt="Cart Icon"></div>
                <div class="cart-badge">1</div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="nav">
        <div class="nav-content">
            <div class="nav-item"><span>Thực phẩm chức năng</span><span class="nav-arrow">▼</span></div>
            <div class="nav-item"><span>Dược mỹ phẩm</span><span class="nav-arrow">▼</span></div>
            <div class="nav-item"><span>Thuốc</span><span class="nav-arrow">▼</span></div>
            <div class="nav-item"><span>Chăm sóc cá nhân</span><span class="nav-arrow">▼</span></div>
            <div class="nav-item"><span>Thiết bị y tế</span><span class="nav-arrow">▼</span></div>
            <div class="nav-item"><span>Góc sức khỏe</span><span class="nav-arrow">▼</span></div>
        </div>
    </div>

    <main class="container cart-container">
        <div class="cart-topbar">
            <a href="cart.html" class="back-link">← Quay lại giỏ hàng</a>
        </div>

        <section class="cart-main cart-shell">
            <!-- Cột trái: Thông tin nhận hàng -->
            <div class="cart-list">
                <h3>Thông tin nhận hàng</h3>
                <div class="form-section">
                    <h4>Người nhận</h4>
                    <input type="text" placeholder="Họ và tên người nhận">
                    <input type="text" placeholder="Số điện thoại">
                    <input type="email" placeholder="Email (không bắt buộc)">
                </div>
                <div class="form-section">
                    <h4>Địa chỉ giao hàng</h4>
                    <input type="text" placeholder="Tỉnh/Thành phố">
                    <input type="text" placeholder="Quận/Huyện">
                    <input type="text" placeholder="Phường/Xã">
                    <textarea rows="3" placeholder="Địa chỉ cụ thể (số nhà, đường...)"></textarea>
                    <p class="note">Giao hàng toàn quốc. Vui lòng điền chính xác để giao nhanh.</p>
                </div>
                <div class="form-section payment-methods">
                    <h4>Phương thức thanh toán</h4>

                    <label>
                        <span><img src="../assets/images/payment/cash.png" alt=""> Tiền mặt khi nhận hàng (COD)</span>
                        <input type="radio" name="payment">
                    </label>

                    <label>
                        <span><img src="../assets/images/payment/qr.png" alt=""> Chuyển khoản (QR Code)</span>
                        <input type="radio" name="payment">
                    </label>

                    <label>
                        <span><img src="../assets/images/payment/bank.png" alt=""> Thẻ ATM nội địa/Ngân hàng</span>
                        <input type="radio" name="payment">
                    </label>

                    <label>
                        <span><img src="../assets/images/payment/card.png" alt=""> Thẻ quốc tế Visa/Master/JCB/AMEX</span>
                        <input type="radio" name="payment">
                    </label>

                    <label>
                        <span><img src="../assets/images/payment/momo.png" alt=""> Ví MoMo</span>
                        <input type="radio" name="payment">
                    </label>
                </div>
            </div>

            <!-- Cột phải: Tổng tiền -->
            <aside class="cart-summary cart-summary--card">
                <h3>Thông tin đơn hàng</h3>
                <div class="summary-row">
                    <span>Tạm tính</span>
                    <span class="subtotal">315.000₫</span>
                </div>
                <div class="summary-row">
                    <span>Giảm giá trực tiếp</span>
                    <span class="discount">123.000₫</span>
                </div>
                <div class="summary-row">
                    <span>Phí vận chuyển</span>
                    <span class="shipping">0₫</span>
                </div>
                <div class="summary-divider"></div>
                <div class="summary-row total">
                    <span>Thành tiền</span>
                    <span class="final-price">492.000₫</span>
                </div>
                <button class="btn-primary btn-pill">Hoàn tất</button>
                <p class="cart-note">Bằng việc hoàn tất, bạn đồng ý với <a href="#">Điều khoản dịch vụ</a> và <a href="#">Chính sách xử lý dữ liệu cá nhân</a> của MediCare.</p>
            </aside>
        </section>

        <!-- Sản phẩm vừa xem -->
        <section class="recent-products">
            <h2>Sản phẩm vừa xem</h2>
            <div class="product-slider">
                <div class="product-card">
                    <img src="../assets/images/product1.jpg" alt="">
                    <p>Viên uống Glucosamine</p>
                    <p class="price">960.000₫</p>
                    <button class="btn-outline">Chọn mua</button>
                </div>
                <div class="product-card">
                    <img src="../assets/images/product2.jpg" alt="">
                    <p>Dung dịch LinhBon</p>
                    <p class="price">295.000₫</p>
                    <button class="btn-outline">Chọn mua</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <div class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>VỀ CHÚNG TÔI</h3>
                <a href="#">Giới thiệu</a>
                <a href="#">Chính sách đặt cọc</a>
                <a href="#">Chính sách đổi trả thuốc</a>
                <a href="#">Chính sách giao hàng</a>
                <a href="#">Chính sách thanh toán</a>
            </div>
            <div class="footer-section">
                <h3>DANH MỤC</h3>
                <a href="#">Thực phẩm chức năng</a>
                <a href="#">Dược mỹ phẩm</a>
                <a href="#">Thuốc</a>
                <a href="#">Chăm sóc cá nhân</a>
                <a href="#">Trang thiết bị y tế</a>
            </div>
            <div class="footer-section">
                <h3>TÌM HIỂU THÊM</h3>
                <a href="#">Góc sức khoẻ</a>
                <a href="#">Tra cứu thuốc</a>
                <a href="#">Bệnh thường gặp</a>
            </div>
            <div class="footer-section">
                <h3>TỔNG ĐÀI (8:00-22:00)</h3>
                <div>Tư vấn mua hàng</div>
                <div class="footer-phone">1900 0908</div>
                <div style="margin-top: 15px;">Góp ý, khiếu nại và tiếp nhận cảnh báo thông tin vi phạm</div>
                <div class="footer-phone">1900 0908</div>
                <h3 style="margin-top: 30px;">KẾT NỐI VỚI CHÚNG TÔI</h3>
                <div class="social-icons">
                    <div class="social-icon"><img src="../assets/images/Facebook_Logo_(2019).png"  alt="Facebook Icon"></div>
                    <div class="social-icon"><img src="../assets/images/icon-zalo.png"  alt="Zalo Icon"></div>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            © MediCare 2025 – Safe & Smart Healthcare Online.
        </div>
    </div>

    <script src="../js/utils.js"></script>
    <script>
        // Initialize payment page
        document.addEventListener('DOMContentLoaded', function() {
            // Calculate and display totals
            function updatePaymentDisplay() {
                // Get cart data from sessionStorage or use default
                const cartData = JSON.parse(sessionStorage.getItem('cartData')) || {
                    subtotal: 492000,
                    discount: 123000,
                    shipping: 0
                };
                
                // Update display
                const subtotalElement = document.querySelector('.subtotal');
                if (subtotalElement) {
                    subtotalElement.textContent = formatVnd(cartData.subtotal);
                }
                
                const discountElement = document.querySelector('.discount');
                if (discountElement) {
                    discountElement.textContent = formatVnd(cartData.discount);
                }
                
                const shippingElement = document.querySelector('.shipping');
                if (shippingElement) {
                    shippingElement.textContent = formatVnd(cartData.shipping);
                }
                
                // Calculate final total
                const finalTotal = calculateFinalTotal(cartData.subtotal, cartData.discount, cartData.shipping);
                const finalPriceElement = document.querySelector('.final-price');
                if (finalPriceElement) {
                    finalPriceElement.textContent = formatVnd(finalTotal);
                }
            }
            
            // Initialize display
            updatePaymentDisplay();
            
            // Form validation and submission
            const form = document.querySelector('.cart-list');
            const submitBtn = document.querySelector('.btn-primary');
            
            if (submitBtn) {
                submitBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Basic form validation
                    const nameInput = form.querySelector('input[placeholder="Họ và tên người nhận"]');
                    const phoneInput = form.querySelector('input[placeholder="Số điện thoại"]');
                    const cityInput = form.querySelector('input[placeholder="Tỉnh/Thành phố"]');
                    const districtInput = form.querySelector('input[placeholder="Quận/Huyện"]');
                    const wardInput = form.querySelector('input[placeholder="Phường/Xã"]');
                    const addressInput = form.querySelector('textarea');
                    const paymentMethod = form.querySelector('input[name="payment"]:checked');
                    
                    let isValid = true;
                    let errorMessage = '';
                    
                    if (!nameInput.value.trim()) {
                        isValid = false;
                        errorMessage = 'Vui lòng nhập họ tên người nhận';
                    } else if (!phoneInput.value.trim()) {
                        isValid = false;
                        errorMessage = 'Vui lòng nhập số điện thoại';
                    } else if (!isValidPhone(phoneInput.value)) {
                        isValid = false;
                        errorMessage = 'Số điện thoại không hợp lệ';
                    } else if (!cityInput.value.trim()) {
                        isValid = false;
                        errorMessage = 'Vui lòng chọn tỉnh/thành phố';
                    } else if (!districtInput.value.trim()) {
                        isValid = false;
                        errorMessage = 'Vui lòng chọn quận/huyện';
                    } else if (!wardInput.value.trim()) {
                        isValid = false;
                        errorMessage = 'Vui lòng chọn phường/xã';
                    } else if (!addressInput.value.trim()) {
                        isValid = false;
                        errorMessage = 'Vui lòng nhập địa chỉ cụ thể';
                    } else if (!paymentMethod) {
                        isValid = false;
                        errorMessage = 'Vui lòng chọn phương thức thanh toán';
                    }
                    
                    if (!isValid) {
                        showNotification(errorMessage, 'error');
                        return;
                    }
                    
                    // Show loading state
                    submitBtn.textContent = 'Đang xử lý...';
                    submitBtn.disabled = true;
                    
                    // Simulate payment processing
                    setTimeout(() => {
                        const orderId = generateOrderId();
                        showOrderSuccessPopup(orderId);
                        
                        // Reset button
                        submitBtn.textContent = 'Hoàn tất';
                        submitBtn.disabled = false;
                    }, 2000);
                });
            }
            
            // Real-time form validation
            const inputs = form.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                input.addEventListener('blur', function() {
                    validateField(this);
                });
                
                input.addEventListener('input', debounce(function() {
                    validateField(this);
                }, 300));
            });
            
            // Field validation function
            function validateField(field) {
                const value = field.value.trim();
                const fieldName = field.placeholder || field.name;
                let isValid = true;
                let message = '';
                
                // Required field validation
                if (field.required && !value) {
                    isValid = false;
                    message = `${fieldName} là bắt buộc`;
                }
                
                // Phone validation
                if (field.placeholder && field.placeholder.includes('Số điện thoại') && value) {
                    if (!isValidPhone(value)) {
                        isValid = false;
                        message = 'Số điện thoại không hợp lệ';
                    }
                }
                
                // Email validation
                if (field.type === 'email' && value) {
                    if (!isValidEmail(value)) {
                        isValid = false;
                        message = 'Email không hợp lệ';
                    }
                }
                
                // Update field appearance
                if (isValid) {
                    field.style.borderColor = '#4CAF50';
                    removeFieldError(field);
                } else {
                    field.style.borderColor = '#f44336';
                    showFieldError(field, message);
                }
                
                return isValid;
            }
            
            // Show field error
            function showFieldError(field, message) {
                removeFieldError(field);
                
                const errorDiv = document.createElement('div');
                errorDiv.className = 'field-error';
                errorDiv.textContent = message;
                errorDiv.style.cssText = 'color: #f44336; font-size: 12px; margin-top: 4px;';
                
                field.parentNode.appendChild(errorDiv);
            }
            
            // Remove field error
            function removeFieldError(field) {
                const existingError = field.parentNode.querySelector('.field-error');
                if (existingError) {
                    existingError.remove();
                }
            }
            
            // Show order success popup
            function showOrderSuccessPopup(orderId) {
                // Create popup overlay
                const overlay = document.createElement('div');
                overlay.className = 'order-success-overlay';
                overlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0, 0, 0, 0.5);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                    animation: fadeIn 0.3s ease;
                `;
                
                // Create popup content
                const popup = document.createElement('div');
                popup.className = 'order-success-popup';
                popup.style.cssText = `
                    background: white;
                    border-radius: 12px;
                    padding: 30px;
                    max-width: 400px;
                    width: 90%;
                    text-align: center;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                    animation: slideUp 0.3s ease;
                `;
                
                popup.innerHTML = `
                    <div class="success-icon" style="
                        width: 60px;
                        height: 60px;
                        background-color: #4CAF50;
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        margin: 0 auto 20px;
                        font-size: 30px;
                        color: white;
                    ">✓</div>
                    <h2 style="color: #333; margin-bottom: 10px;">Đặt hàng thành công!</h2>
                    <p style="color: #666; margin-bottom: 20px;">Cảm ơn bạn đã mua sắm tại MediCare</p>
                    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 25px;">
                        <p style="margin: 0; color: #333; font-weight: 600;">Mã đơn hàng: <span style="color: #2196F3;">${orderId}</span></p>
                    </div>
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button class="btn-outline" id="go-home-btn" style="flex: 1; padding: 12px;">Trang chủ</button>
                        <button class="btn-primary" id="check-order-btn" style="flex: 1; padding: 12px;">Kiểm tra đơn hàng</button>
                    </div>
                `;
                
                overlay.appendChild(popup);
                document.body.appendChild(overlay);
                
                // Add animations
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes fadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    @keyframes slideUp {
                        from { transform: translateY(30px); opacity: 0; }
                        to { transform: translateY(0); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
                
                // Event listeners for buttons
                document.getElementById('go-home-btn').addEventListener('click', () => {
                    window.location.href = '../index.html'; // Adjust path as needed
                });
                
                document.getElementById('check-order-btn').addEventListener('click', () => {
                    window.location.href = 'order.html';
                });
                
                // Close popup when clicking overlay
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        document.body.removeChild(overlay);
                    }
                });
            }
        });
    </script>
</body>
</html>
