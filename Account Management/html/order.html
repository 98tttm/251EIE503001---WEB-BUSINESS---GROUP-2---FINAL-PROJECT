<section class="orders" id="orders">
    <!-- Header -->
    <div class="orders__header">
      <h2 class="orders__title">Đơn hàng của tôi</h2>
      <div class="orders__search">
        <input
          type="text"
          id="orders-search-input"
          class="orders__search-input"
          placeholder="Tìm theo tên đơn, mã đơn..."
        />
        <button class="orders__search-btn" id="orders-search-btn">Tìm</button>
      </div>
    </div>
  
    <!-- Filter Tabs -->
    <div class="orders__tabs" id="orders-tabs">
      <button class="orders__tab orders__tab--active" data-status="all">Tất cả</button>
      <button class="orders__tab" data-status="processing">Chờ xử lý</button>
      <button class="orders__tab" data-status="shipping">Đang giao</button>
      <button class="orders__tab" data-status="completed">Hoàn thành</button>
      <button class="orders__tab" data-status="cancelled">Đã hủy</button>
    </div>
  
    <!-- List -->
    <div class="orders__list" id="orders-list">
      <!-- Rendered by JS from ../database/Orders.xml -->
    </div>
  
    <!-- Pagination -->
    <nav class="orders__pagination">
      <button class="orders__page-btn orders__page-btn--disabled">Trước</button>
      <button class="orders__page-btn orders__page-btn--active">1</button>
      <button class="orders__page-btn">2</button>
      <button class="orders__page-btn">Sau</button>
    </nav>
  </section>
  
  <script>
  // ===== Load & render Orders from XML (keep existing structure/classes) =====
  document.addEventListener('DOMContentLoaded', () => {
    const listEl = document.getElementById('orders-list');
    const tabs = Array.from(document.querySelectorAll('.orders__tab'));
    const statusText = {
      processing: 'Chờ xử lý',
      shipping: 'Đang giao',
      completed: 'Hoàn thành',
      cancelled: 'Đã hủy'
    };
    function normalizeStatus(s) {
      const v = (s || '').toString().trim().toLowerCase();
      switch (v) {
        case 'processing':
        case 'chờ xử lý':
        case 'cho xu ly':
        case 'đang xử lý':
          return 'processing';
        case 'shipping':
        case 'đang giao':
        case 'đang giao hàng':
          return 'shipping';
        case 'completed':
        case 'hoàn thành':
          return 'completed';
        case 'cancelled':
        case 'canceled':
        case 'đã hủy':
        case 'da huy':
          return 'cancelled';
        default:
          return v || 'processing';
      }
    }

    const VND = n => new Intl.NumberFormat('vi-VN').format(Number(n || 0)) + 'đ';
    const ASSET_BASE = '../';

    let orders = [];
    let currentStatus = 'all';

    function render() {
      const filtered = currentStatus === 'all' ? orders : orders.filter(o => o.status === currentStatus);
      if (!filtered.length) {
        listEl.innerHTML = '<p>Không có đơn hàng phù hợp.</p>';
        return;
      }
      listEl.innerHTML = filtered.map(toCardHTML).join('');
    }

    function toCardHTML(o) {
      const itemsHTML = o.items.map(it => `
        <div class="order-item">
          <img class="order-item__thumb" src="${ASSET_BASE + it.image}" alt="">
          <div class="order-item__info">
            <div class="order-item__name">${it.name}</div>
            <div class="order-item__sub">x${it.quantity} • ${VND(it.price)}</div>
          </div>
        </div>`).join('');

      const actions = o.status === 'processing'
        ? `<button class="order-card__btn order-card__btn--primary">Xem chi tiết</button>
           <button class="order-card__btn order-card__btn--ghost">Hủy đơn</button>`
        : o.status === 'shipping'
          ? `<button class="order-card__btn order-card__btn--primary">Xem chi tiết</button>
             <button class="order-card__btn order-card__btn--ghost">Theo dõi</button>`
          : o.status === 'completed'
            ? `<button class="order-card__btn order-card__btn--primary">Mua lại</button>`
            : `<button class="order-card__btn order-card__btn--ghost" disabled>Đã hủy</button>`;

      return `
        <article class="order-card" data-status="${o.status}">
          <header class="order-card__head">
            <div>
              <span class="order-card__code">Mã đơn: <strong>${o.id}</strong></span>
              <span class="order-card__date">Ngày đặt: ${o.dateDisplay}</span>
            </div>
            <span class="order-card__badge order-card__badge--${o.status}">${statusText[o.status] || o.status}</span>
          </header>
          <div class="order-card__body">${itemsHTML}</div>
          <footer class="order-card__foot">
            <div class="order-card__summary">
              <span class="order-card__label">Tổng tiền:</span>
              <span class="order-card__total">${VND(o.total)}</span>
            </div>
            <div class="order-card__actions">${actions}</div>
          </footer>
        </article>`;
    }

    function ymdToVi(ymd) {
      if (!ymd || !/\d{4}-\d{2}-\d{2}/.test(ymd)) return ymd || '';
      const [y,m,d] = ymd.split('-');
      return `${d}/${m}/${y}`;
    }

    function parseXML(doc) {
      const out = [];
      const nodes = doc.getElementsByTagName('order');
      for (let i = 0; i < nodes.length; i++) {
        const el = nodes[i];
        const id = el.getAttribute('id') || '';
        const date = el.getAttribute('date') || '';
        const status = normalizeStatus(el.getAttribute('status'));
        const totalText = (el.getElementsByTagName('total')[0]?.textContent || '').trim();
        const items = [];
        const itemsEl = el.getElementsByTagName('items')[0];
        if (itemsEl) {
          const itemEls = itemsEl.getElementsByTagName('item');
          for (let j = 0; j < itemEls.length; j++) {
            const it = itemEls[j];
            items.push({
              name: (it.getElementsByTagName('name')[0]?.textContent || '').trim(),
              quantity: Number((it.getElementsByTagName('quantity')[0]?.textContent || '1').trim()),
              price: Number((it.getElementsByTagName('price')[0]?.textContent || '0').trim()),
              image: (it.getElementsByTagName('image')[0]?.textContent || '').trim()
            });
          }
        }
        out.push({ id, date, dateDisplay: ymdToVi(date), status, total: Number(totalText || 0), items });
      }
      return out;
    }

    // Fetch XML and render
    fetch('../database/Orders.xml', { cache: 'no-store' })
      .then(r => r.text())
      .then(txt => (new window.DOMParser()).parseFromString(txt, 'text/xml'))
      .then(xml => { orders = parseXML(xml); render(); })
      .catch(err => {
        console.error('Load Orders.xml failed:', err);
        listEl.innerHTML = '<p>Không tải được danh sách đơn hàng.</p>';
      });

    // Tabs filtering (works with dynamically rendered cards)
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('orders__tab--active'));
        tab.classList.add('orders__tab--active');
        currentStatus = tab.dataset.status || 'all';
        render();
      });
    });
  });
</script>