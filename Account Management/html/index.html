<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Qu·∫£n l√Ω t√†i kho·∫£n</title>
  <link rel="stylesheet" href="../css/style.css" />
  <link rel="stylesheet" href="../css/layout.css" />
  <link rel="stylesheet" href="../css/account.css" />
  <link rel="stylesheet" href="../css/order.css" />
  <link rel="stylesheet" href="../css/global.css" />
  <link rel="stylesheet" href="../css/address.css" />
</head>

<body>
  <!-- Top Bar -->
  <div class="top-bar">
    <div class="top-bar-content">
      <div class="top-bar-left">
        <span><img src="../assets/images/search-13-24.png" height="20" width="20" alt="Search Icon"></span>
        <span>T√¨m hi·ªÉu v·ªÅ ch√∫ng t√¥i</span>
        <span>MediCare</span>
      </div>
      <div class="top-bar-right">
        <span><img src="../assets/images/phone-call-white-icon.png" height="20" width="20" alt="Call Icon"></span>
        <span>T∆∞ v·∫•n ngay: 1900 0908</span>
      </div>
    </div>
  </div>

  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <div class="logo">
        <img src="../assets/images/LOGO V√†ng MediCare.PNG" height="200" width="auto" alt="MediCare Logo">
      </div>

      <div class="search-bar">
        <input type="text" placeholder="T√¨m t√™n thu·ªëc, b·ªánh l√Ω,...">
        <div class="search-icons">
          <div class="icon-btn"><img src="../assets/images/microphone_17695410.png" height="30" width="30"
              alt="Microphone Icon"></div>
          <div class="icon-btn"><img src="../assets/images/photo_15307179.png" height="30" width="30" alt="Camera Icon">
          </div>
        </div>
      </div>

      <div class="personal-info">
        <div class="phone-icon"><img src="../assets/images/avatar_15657781.png" height="50" width="50"
            alt="Avatar Icon"></div>
        <div class="phone-number">0987654321</div>
        <div class="personal-popup">
          <div class="popup-item">
            <div class="popup-icon"><img src="../assets/images/8324223_ui_essential_app_avatar_profile_icon.png"
                height="20" width="20" alt="Avatar Icon"></div>
            <span>Th√¥ng tin c√° nh√¢n</span>
          </div>
          <div class="popup-item">
            <div class="popup-icon"><img src="../assets/images/9025861_package_box_icon.png" height="20" width="20"
                alt="Amazon Icon"></div>
            <span>ƒê∆°n h√†ng c·ªßa t√¥i</span>
          </div>
          <div class="popup-item">
            <div class="popup-icon"><img src="../assets/images/2849827_pointer_map_location_place_multimedia_icon.png"
                height="20" width="20" alt="Map Icon"></div>
            <span>Qu·∫£n l√Ω s·ªï ƒë·ªãa ch·ªâ</span>
          </div>
          <div class="popup-item">
            <div class="popup-icon"><img src="../assets/images/9104136_logout_sign out_exit_dooe_out_icon.png"
                height="20" width="20" alt="Sign Out Icon"></div>
            <span>ƒêƒÉng xu·∫•t</span>
          </div>
        </div>
      </div>

      <div class="cart-container">
        <div class="cart-btn">
          <img src="../assets/images/shopping-cart_6387626.png" height="50" width="50" alt="Cart Icon">
        </div>
        <div class="cart-badge">1</div>

        <div class="cart-popup">
          <div class="cart-popup-header">
            <h3>Gi·ªè h√†ng</h3>
          </div>

          <div class="cart-items">
            <div class="cart-item">
              <div class="cart-item-image">
                <img src="../assets/images/vaseline-rosy-lotus.jpg" alt="Vaseline Rosy Lotus" width="60" height="60">
              </div>
              <div class="cart-item-details">
                <div class="cart-item-name">S√°p d∆∞·ª°ng ·∫©m Vaseline Rosy Lotus Fobelife l√†m m·ªÅm da,...</div>
                <div class="cart-item-price">35.000‚Ç´</div>
                <div class="cart-item-quantity">x1 H≈©</div>
              </div>
              <div class="cart-item-delete">
                <img src="../assets/images/delete-icon.png" alt="Delete" width="16" height="16">
              </div>
            </div>
          </div>

          <div class="cart-popup-footer">
            <div class="cart-summary">1 s·∫£n ph·∫©m</div>
            <button class="view-cart-btn">Xem gi·ªè h√†ng</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <div class="nav">
    <div class="nav-content">
      <!-- Th·ª±c ph·∫©m ch·ª©c nƒÉng -->
      <div class="nav-item">
        <span>Th·ª±c ph·∫©m ch·ª©c nƒÉng</span>
        <span class="nav-arrow">‚ñº</span>
        <div class="nav-popup">
          <div class="nav-popup-content">
            <div class="nav-popup-sidebar">
              <div class="nav-popup-item active">
                <div class="nav-popup-icon">üíä</div>
                <span>Vitamin & Kho√°ng ch·∫•t</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üß¨</div>
                <span>Sinh l√Ω - N·ªôi ti·∫øt t·ªë</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">‚ö°</div>
                <span>C·∫£i thi·ªán tƒÉng c∆∞·ªùng ch·ª©c nƒÉng</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üè•</div>
                <span>H·ªó tr·ª£ ƒëi·ªÅu tr·ªã</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üçΩÔ∏è</div>
                <span>H·ªó tr·ª£ ti√™u h√≥a</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üß†</div>
                <span>Th·∫ßn kinh n√£o</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üíÑ</div>
                <span>H·ªó tr·ª£ l√†m ƒë·∫πp</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">‚ù§Ô∏è</div>
                <span>S·ª©c kho·∫ª tim m·∫°ch</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">ü•ó</div>
                <span>Dinh d∆∞·ª°ng</span>
              </div>
            </div>
            <div class="nav-popup-main">
              <div class="nav-popup-grid">
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">ü¶¥</div>
                  <span>B·ªï sung Canxi & Vitamin D</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">üíä</div>
                  <span>Vitamin t·ªïng h·ª£p</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">üêü</div>
                  <span>D·∫ßu c√°, Omega 3, DHA</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">üçä</div>
                  <span>Vitamin C c√°c lo·∫°i</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">ü©∏</div>
                  <span>B·ªï sung S·∫Øt & Axit Folic</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">‚ãØ</div>
                  <span>Xem th√™m</span>
                </div>
              </div>
              <div class="nav-popup-bestsellers">
                <div class="nav-popup-bestsellers-header">
                  <h3>B√°n ch·∫°y nh·∫•t</h3>
                  <a href="#" class="nav-popup-view-all">Xem t·∫•t c·∫£ ‚Üí</a>
                </div>
                <div class="nav-popup-bestsellers-list">
                  <div class="nav-popup-product">
                    <img src="../assets/images/product1.jpg" alt="Product 1" width="80" height="80">
                    <div class="nav-popup-product-info">
                      <div class="nav-popup-product-name">Vi√™n u·ªëng NutriGrow Nutrimed b·ªï sung canxi,...</div>
                      <div class="nav-popup-product-price">480.000‚Ç´ / H·ªôp</div>
                    </div>
                  </div>
                  <div class="nav-popup-product">
                    <img src="../assets/images/product2.jpg" alt="Product 2" width="80" height="80">
                    <div class="nav-popup-product-info">
                      <div class="nav-popup-product-name">Vi√™n u·ªëng Immuvita Easylife b·ªï sung vitamin v√† kho√°ng...</div>
                      <div class="nav-popup-product-price">320.000‚Ç´ / H·ªôp</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- D∆∞·ª£c m·ªπ ph·∫©m -->
      <div class="nav-item">
        <span>D∆∞·ª£c m·ªπ ph·∫©m</span>
        <span class="nav-arrow">‚ñº</span>
        <div class="nav-popup">
          <div class="nav-popup-content">
            <div class="nav-popup-sidebar">
              <div class="nav-popup-item active">
                <div class="nav-popup-icon">üß¥</div>
                <span>ChƒÉm s√≥c da m·∫∑t</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üõÄ</div>
                <span>ChƒÉm s√≥c c∆° th·ªÉ</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">‚ú®</div>
                <span>Gi·∫£i ph√°p l√†n da</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üíá‚Äç‚ôÄÔ∏è</div>
                <span>ChƒÉm s√≥c t√≥c - da ƒë·∫ßu</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üíÑ</div>
                <span>M·ªπ ph·∫©m trang ƒëi·ªÉm</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üëÅÔ∏è</div>
                <span>ChƒÉm s√≥c da v√πng m·∫Øt</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üçÉ</div>
                <span>S·∫£n ph·∫©m t·ª´ thi√™n nhi√™n</span>
              </div>
            </div>
            <div class="nav-popup-main">
              <div class="nav-popup-grid">
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">üß¥</div>
                  <span>S·ªØa r·ª≠a m·∫∑t (Kem, gel, s·ªØa)</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">‚òÄÔ∏è</div>
                  <span>Kem ch·ªëng n·∫Øng da m·∫∑t</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">üíß</div>
                  <span>D∆∞·ª°ng da m·∫∑t</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">üé≠</div>
                  <span>M·∫∑t n·∫°</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">üß™</div>
                  <span>Serum, Essence ho·∫∑c Ampoule</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">‚ãØ</div>
                  <span>Xem th√™m</span>
                </div>
              </div>
              <div class="nav-popup-bestsellers">
                <div class="nav-popup-bestsellers-header">
                  <h3>B√°n ch·∫°y nh·∫•t</h3>
                  <a href="#" class="nav-popup-view-all">Xem t·∫•t c·∫£ ‚Üí</a>
                </div>
                <div class="nav-popup-bestsellers-list">
                  <div class="nav-popup-product">
                    <img src="../assets/images/skincare-sac-ngoc-khang.jpg" alt="S·ªØa r·ª≠a m·∫∑t S·∫Øc Ng·ªçc Khang" width="80"
                      height="80">
                    <div class="nav-popup-product-info">
                      <div class="nav-popup-product-name">S·ªØa r·ª≠a m·∫∑t th·∫£o d∆∞·ª£c S·∫Øc Ng·ªçc Khang gi√∫p s√°ng...</div>
                      <div class="nav-popup-product-price">69.000‚Ç´ / Tu√Ωp</div>
                    </div>
                  </div>
                  <div class="nav-popup-product">
                    <img src="../assets/images/skincare-on-the-body.jpg" alt="S·ªØa r·ª≠a m·∫∑t On: The Body" width="80"
                      height="80">
                    <div class="nav-popup-product-info">
                      <div class="nav-popup-product-name">S·ªØa r·ª≠a m·∫∑t On: The Body Rice Therapy Rice...</div>
                      <div class="nav-popup-product-price">165.000‚Ç´ / Tu√Ωp</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Thu·ªëc -->
      <div class="nav-item">
        <span>Thu·ªëc</span>
        <span class="nav-arrow">‚ñº</span>
        <div class="nav-popup">
          <div class="nav-popup-content">
            <div class="nav-popup-sidebar">
              <div class="nav-popup-item active">
                <div class="nav-popup-icon">üîç</div>
                <span>Tra c·ª©u thu·ªëc</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üß™</div>
                <span>Tra c·ª©u d∆∞·ª£c ch·∫•t</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üåø</div>
                <span>Tra c·ª©u d∆∞·ª£c li·ªáu</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üíä</div>
                <span>Thu·ªëc k√™ ƒë∆°n</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">ü©π</div>
                <span>Thu·ªëc kh√¥ng k√™ ƒë∆°n</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üíâ</div>
                <span>V·∫Øc xin</span>
              </div>
            </div>
            <div class="nav-popup-main">
              <div class="nav-popup-grid">
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">ü¶†</div>
                  <span>Thu·ªëc kh√°ng sinh, kh√°ng n·∫•m</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">üéóÔ∏è</div>
                  <span>Thu·ªëc ƒëi·ªÅu tr·ªã ung th∆∞</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">‚ù§Ô∏è</div>
                  <span>Thu·ªëc tim m·∫°ch & m√°u</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">üß†</div>
                  <span>Thu·ªëc th·∫ßn kinh</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">üçé</div>
                  <span>Thu·ªëc ti√™u ho√° & gan m·∫≠t</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">‚ãØ</div>
                  <span>Xem th√™m</span>
                </div>
              </div>
              <div class="nav-popup-bestsellers">
                <div class="nav-popup-bestsellers-header">
                  <h3>S·∫£n ph·∫©m n·ªïi b·∫≠t</h3>
                  <a href="#" class="nav-popup-view-all">Xem t·∫•t c·∫£ ‚Üí</a>
                </div>
                <div class="nav-popup-bestsellers-list">
                  <div class="nav-popup-product">
                    <img src="../assets/images/medicine1.jpg" alt="Medicine 1" width="80" height="80">
                    <div class="nav-popup-product-info">
                      <div class="nav-popup-product-name">Gel b√¥i da Klenzit MS ƒëi·ªÅu tr·ªã m·ª•...</div>
                      <div class="nav-popup-product-price">120.000‚Ç´ / Tu√Ωp</div>
                    </div>
                  </div>
                  <div class="nav-popup-product">
                    <img src="../assets/images/medicine2.jpg" alt="Medicine 2" width="80" height="80">
                    <div class="nav-popup-product-info">
                      <div class="nav-popup-product-name">Vi√™n s·ªßi Efferalgan 500mg UPSA...</div>
                      <div class="nav-popup-product-price">85.000‚Ç´ / H·ªôp</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ChƒÉm s√≥c c√° nh√¢n -->
      <div class="nav-item">
        <span>ChƒÉm s√≥c c√° nh√¢n</span>
        <span class="nav-arrow">‚ñº</span>
        <div class="nav-popup">
          <div class="nav-popup-content">
            <div class="nav-popup-sidebar">
              <div class="nav-popup-item active">
                <div class="nav-popup-icon">ü¶∑</div>
                <span>ChƒÉm s√≥c rƒÉng mi·ªáng</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üöø</div>
                <span>ChƒÉm s√≥c c∆° th·ªÉ</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üß¥</div>
                <span>ChƒÉm s√≥c t√≥c</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üë∂</div>
                <span>ChƒÉm s√≥c tr·∫ª em</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üë¥</div>
                <span>ChƒÉm s√≥c ng∆∞·ªùi cao tu·ªïi</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üë©</div>
                <span>ChƒÉm s√≥c ph·ª• n·ªØ</span>
              </div>
            </div>
            <div class="nav-popup-main">
              <div class="nav-popup-grid">
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">ü™•</div>
                  <span>Kem ƒë√°nh rƒÉng</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">üëÑ</div>
                  <span>N∆∞·ªõc s√∫c mi·ªáng</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">üßº</div>
                  <span>S·ªØa t·∫Øm</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">üß¥</div>
                  <span>D·∫ßu g·ªôi</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">üßΩ</div>
                  <span>KhƒÉn t·∫Øm</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">‚ãØ</div>
                  <span>Xem th√™m</span>
                </div>
              </div>
              <div class="nav-popup-bestsellers">
                <div class="nav-popup-bestsellers-header">
                  <h3>B√°n ch·∫°y nh·∫•t</h3>
                  <a href="#" class="nav-popup-view-all">Xem t·∫•t c·∫£ ‚Üí</a>
                </div>
                <div class="nav-popup-bestsellers-list">
                  <div class="nav-popup-product">
                    <img src="../assets/images/personal-care1.jpg" alt="Personal Care 1" width="80" height="80">
                    <div class="nav-popup-product-info">
                      <div class="nav-popup-product-name">D·∫ßu g·ªôi tr·ªã g√†u Nazorel Shampoo...</div>
                      <div class="nav-popup-product-price">98.000‚Ç´ / H·ªôp</div>
                    </div>
                  </div>
                  <div class="nav-popup-product">
                    <img src="../assets/images/personal-care2.jpg" alt="Personal Care 2" width="80" height="80">
                    <div class="nav-popup-product-info">
                      <div class="nav-popup-product-name">X·ªãt th∆°m mi·ªáng Aro Mouth 10ml...</div>
                      <div class="nav-popup-product-price">60.000‚Ç´ / H·ªôp</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Thi·∫øt b·ªã y t·∫ø -->
      <div class="nav-item">
        <span>Thi·∫øt b·ªã y t·∫ø</span>
        <span class="nav-arrow">‚ñº</span>
        <div class="nav-popup">
          <div class="nav-popup-content">
            <div class="nav-popup-sidebar">
              <div class="nav-popup-item active">
                <div class="nav-popup-icon">üìä</div>
                <span>D·ª•ng c·ª• theo d√µi</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">ü©π</div>
                <span>D·ª•ng c·ª• s∆° c·ª©u</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üò∑</div>
                <span>Kh·∫©u trang</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">ü©∫</div>
                <span>Thi·∫øt b·ªã ƒëo</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">‚ôø</div>
                <span>H·ªó tr·ª£ di chuy·ªÉn</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üè†</div>
                <span>Thi·∫øt b·ªã t·∫°i nh√†</span>
              </div>
            </div>
            <div class="nav-popup-main">
              <div class="nav-popup-grid">
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">ü©∏</div>
                  <span>M√°y ƒëo huy·∫øt √°p</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">üå°Ô∏è</div>
                  <span>Nhi·ªát k·∫ø</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">üò∑</div>
                  <span>Kh·∫©u trang</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">üíâ</div>
                  <span>Kim c√°c lo·∫°i</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">ü´Å</div>
                  <span>D·ª•ng c·ª• v·ªá sinh m≈©i</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">‚ãØ</div>
                  <span>Xem th√™m</span>
                </div>
              </div>
              <div class="nav-popup-bestsellers">
                <div class="nav-popup-bestsellers-header">
                  <h3>B√°n ch·∫°y nh·∫•t</h3>
                  <a href="#" class="nav-popup-view-all">Xem t·∫•t c·∫£ ‚Üí</a>
                </div>
                <div class="nav-popup-bestsellers-list">
                  <div class="nav-popup-product">
                    <img src="../assets/images/medical-device1.jpg" alt="Medical Device 1" width="80" height="80">
                    <div class="nav-popup-product-info">
                      <div class="nav-popup-product-name">X·ªãt m≈©i Otosan Nasal Spray Baby...</div>
                      <div class="nav-popup-product-price">295.000‚Ç´ / H·ªôp</div>
                    </div>
                  </div>
                  <div class="nav-popup-product">
                    <img src="../assets/images/medical-device2.jpg" alt="Medical Device 2" width="80" height="80">
                    <div class="nav-popup-product-info">
                      <div class="nav-popup-product-name">Gel Voltogel Mass gi·∫£m ƒëau c∆°...</div>
                      <div class="nav-popup-product-price">110.000‚Ç´ / H·ªôp</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- B·ªánh & G√≥c s·ª©c kh·ªèe -->
      <div class="nav-item">
        <span>B·ªánh & G√≥c s·ª©c kh·ªèe</span>
        <span class="nav-arrow">‚ñº</span>
        <div class="nav-popup">
          <div class="nav-popup-content">
            <div class="nav-popup-sidebar">
              <div class="nav-popup-item active">
                <div class="nav-popup-icon">üìç</div>
                <span>G√≥c s·ª©c kh·ªèe</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üéóÔ∏è</div>
                <span>Chuy√™n trang ung th∆∞</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">‚≠ê</div>
                <span>B·ªánh th∆∞·ªùng g·∫∑p</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">‚ú®</div>
                <span>Tin khuy·∫øn m·∫°i</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">üì∫</div>
                <span>Truy·ªÅn th√¥ng</span>
              </div>
              <div class="nav-popup-item">
                <div class="nav-popup-icon">‚ùì</div>
                <span>H·ªèi ƒë√°p b√°c sƒ©</span>
              </div>
            </div>
            <div class="nav-popup-main">
              <div class="nav-popup-grid">
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">‚ù§Ô∏è</div>
                  <span>B·ªánh tim m·∫°ch</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">üß†</div>
                  <span>B·ªánh th·∫ßn kinh</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">üçé</div>
                  <span>B·ªánh ti√™u h√≥a</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">ü´Å</div>
                  <span>B·ªánh h√¥ h·∫•p</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">ü¶¥</div>
                  <span>B·ªánh x∆∞∆°ng kh·ªõp</span>
                </div>
                <div class="nav-popup-card">
                  <div class="nav-popup-card-icon">‚ãØ</div>
                  <span>Xem th√™m</span>
                </div>
              </div>
              <div class="nav-popup-bestsellers">
                <div class="nav-popup-bestsellers-header">
                  <h3>B√†i vi·∫øt n·ªïi b·∫≠t</h3>
                  <a href="#" class="nav-popup-view-all">Xem t·∫•t c·∫£ ‚Üí</a>
                </div>
                <div class="nav-popup-bestsellers-list">
                  <div class="nav-popup-product">
                    <img src="../assets/images/health-article1.jpg" alt="Health Article 1" width="80" height="80">
                    <div class="nav-popup-product-info">
                      <div class="nav-popup-product-name">10 c√°ch ph√≤ng ng·ª´a b·ªánh tim m·∫°ch</div>
                      <div class="nav-popup-product-price">ƒê·ªçc ngay</div>
                    </div>
                  </div>
                  <div class="nav-popup-product">
                    <img src="../assets/images/health-article2.jpg" alt="Health Article 2" width="80" height="80">
                    <div class="nav-popup-product-info">
                      <div class="nav-popup-product-name">Dinh d∆∞·ª°ng cho ng∆∞·ªùi cao tu·ªïi</div>
                      <div class="nav-popup-product-price">ƒê·ªçc ngay</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- BREADCRUMB -->
  <div class="breadcrumb">
    <a href="#" class="breadcrumb__link">Trang ch·ªß</a> /
    <span class="breadcrumb__current">Qu·∫£n l√Ω t√†i kho·∫£n</span>
  </div>

  <!-- ACCOUNT SECTION -->
  <section class="account">
    <!-- LEFT -->
    <div class="account__left">
      <div class="account__avatar-card">
        <img src="../assets/images/avatar_15657781.png" alt="Avatar" class="account__avatar-icon" />
        <span class="account__avatar-name">‚Äî</span>
        <span class="account__avatar-phone">‚Äî</span>
      </div>

      <div class="account__menu">
        <div class="account__menu-item account__menu-item--active" data-page="../html/account.html">Th√¥ng tin c√° nh√¢n
        </div>
        <div class="account__menu-item" data-page="order.html">ƒê∆°n h√†ng c·ªßa t√¥i</div>
        <div class="account__menu-item" data-page="address.html">Qu·∫£n l√Ω s·ªë ƒë·ªãa ch·ªâ</div>
        <div class="account__menu-item" id="logout-btn"><span>ƒêƒÉng xu·∫•t</span></div>
      </div>
    </div>

    <!-- LOGOUT MODAL -->
    <div id="logout-modal" class="logout-modal">
      <div class="logout-modal__content">
        <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t kh√¥ng?</p>
        <div class="logout-modal__buttons">
          <button id="confirm-logout" class="logout-btn confirm">ƒêƒÉng xu·∫•t</button>
          <button id="cancel-logout" class="logout-btn cancel">H·ªßy</button>
        </div>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="account__info-card" id="right-side"></div>
  </section>

  <!-- Footer -->
  <div class="footer">
    <div class="footer-content">
      <div class="footer-section">
        <h3>V·ªÄ CH√öNG T√îI</h3>
        <a href="#">Gi·ªõi thi·ªáu</a>
        <a href="#">Ch√≠nh s√°ch ƒë·∫∑t c·ªçc</a>
        <a href="#">Ch√≠nh s√°ch n·ªôi dung</a>
        <a href="#">Ch√≠nh s√°ch ƒë·ªïi tr·∫£ thu·ªëc</a>
        <a href="#">Ch√≠nh s√°ch giao h√†ng</a>
        <a href="#">Ch√≠nh s√°ch b·∫£o m·∫≠t d·ªØ li·ªáu c√° nh√¢n kh√°ch h√†ng</a>
        <a href="#">Ch√≠nh s√°ch thanh to√°n</a>
        <a href="#">Ki·ªÉm tra h√≥a ƒë∆°n ƒëi·ªán t·ª≠</a>
        <a href="#">Ch√≠nh s√°ch thu th·∫≠p v√† x·ª≠ l√Ω d·ªØ li·ªáu c√° nh√¢n</a>
      </div>
      <div class="footer-section">
        <h3>DANH M·ª§C</h3>
        <a href="#">Th·ª±c ph·∫©m ch·ª©c nƒÉng</a>
        <a href="#">D∆∞·ª£c m·ªπ ph·∫©m</a>
        <a href="#">Thu·ªëc</a>
        <a href="#">ChƒÉm s√≥c c√° nh√¢n</a>
        <a href="#">Trang thi·∫øt b·ªã y t·∫ø</a>
        <a href="#">ƒê·∫∑t thu·ªëc online</a>
      </div>
      <div class="footer-section">
        <h3>T√åM HI·ªÇU TH√äM</h3>
        <a href="#">G√≥c s·ª©c kho·∫ª</a>
        <a href="#">Tra c·ª©u thu·ªëc</a>
        <a href="#">Tra c·ª©u d∆∞·ª£c ch·∫•t</a>
        <a href="#">Tra c·ª©u d∆∞·ª£c li·ªáu</a>
        <a href="#">B·ªánh th∆∞·ªùng g·∫∑p</a>
      </div>
      <div class="footer-section">
        <h3>T·ªîNG ƒê√ÄI (8:00-22:00)</h3>
        <div>T∆∞ v·∫•n mua h√†ng</div>
        <div class="footer-phone">1900 0908</div>
        <div style="margin-top: 15px;">G√≥p √Ω, khi·∫øu n·∫°i v√† ti·∫øp nh·∫≠n c·∫£nh b√°o th√¥ng tin vi ph·∫°m</div>
        <div class="footer-phone">1900 0908</div>
        <h3 style="margin-top: 30px;">K·∫æT N·ªêI V·ªöI CH√öNG T√îI</h3>
        <div class="social-icons">
          <div class="social-icon"><img src="../assets/images/Facebook_Logo_(2019).png" alt="Facebook Icon"></div>
          <div class="social-icon"><img src="../assets/images/icon-zalo.png" alt="Zalo Icon"></div>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      ¬© MediCare 2025 ‚Äì Safe & Smart Healthcare Online.
    </div>
  </div>

  <!-- SCRIPT -->
  <script>
    /* =========================
       CONFIG & HELPER
    ========================= */
    const STORAGE_DB = "db.users.v1";
    const STORAGE_UID = "currentUserId";

    /* ==== Helper chuy·ªÉn ƒë·ªïi ==== */
    function dobIsoToVi(iso) {
      if (!iso) return "";
      const [y, m, d] = iso.split("-");
      return [d, m, y].join("/");
    }
    function dobViToIso(vi) {
      if (!vi) return "";
      const [d, m, y] = vi.split("/");
      return [y, m, d].join("-");
    }
    function genderToView(g) {
      if (!g) return "";
      const low = g.toLowerCase();
      if (low === "male") return "Nam";
      if (low === "female") return "N·ªØ";
      return "Kh√°c";
    }
    function genderToData(g) {
      if (g === "Nam") return "male";
      if (g === "N·ªØ") return "female";
      return "other";
    }

    /* =========================
       DATABASE LOCAL
    ========================= */
    async function getDB() {
      const cached = localStorage.getItem(STORAGE_DB);
      if (cached) {
        try { return { users: JSON.parse(cached) }; } catch { }
      }
      const res = await fetch("../database/database.json", { cache: "no-store" });
      const data = await res.json();
      const users = Array.isArray(data.users) ? data.users : [];
      localStorage.setItem(STORAGE_DB, JSON.stringify(users));
      return { users };
    }

    function getUserById(db, id) {
      if (!db?.users?.length) return null;
      return db.users.find(u => u._id === id) || db.users[0];
    }

    /* ==== C·∫≠p nh·∫≠t DB khi ng∆∞·ªùi d√πng ch·ªânh s·ª≠a ==== */
    function updateUserInDB(db, updatedUser) {
      const users = Array.isArray(db.users) ? [...db.users] : [];
      const idx = users.findIndex(u => u._id === updatedUser._id);
      if (idx !== -1) users[idx] = updatedUser;
      else users.push(updatedUser);

      // L√†m s·∫°ch d·ªØ li·ªáu null
      users.forEach(u => {
        if (u.profile) {
          if (u.profile.fullName === null) u.profile.fullName = "";
          if (u.profile.gender === null) u.profile.gender = "other";
          if (u.profile.dob === null) u.profile.dob = "";
        }
      });

      localStorage.setItem(STORAGE_DB, JSON.stringify(users));
      return { users };
    }

    async function ensureCurrentUserId(db) {
      if (!localStorage.getItem(STORAGE_UID) && db.users?.length) {
        localStorage.setItem(STORAGE_UID, db.users[0]._id);
      }
      return localStorage.getItem(STORAGE_UID);
    }

    /* =========================
       RENDER + MODEL
    ========================= */
    function toViewModel(u) {
      return {
        _id: u._id,
        name: u.profile?.fullName || "",
        phone: u.phone || "",
        gender: genderToView(u.profile?.gender || ""),
        birthday: dobIsoToVi(u.profile?.dob || "")
      };
    }
    function toDataModel(vm, old) {
      return {
        ...old,
        phone: old.phone,
        profile: {
          ...old.profile,
          fullName: vm.name || old.profile?.fullName,
          gender: genderToData(vm.gender || old.profile?.gender),
          dob: dobViToIso(vm.birthday || old.profile?.dob)
        }
      };
    }
    function renderAvatar(vm) {
      document.querySelector(".account__avatar-name").textContent = vm.name || "‚Äî";
      document.querySelector(".account__avatar-phone").textContent = vm.phone || "‚Äî";
    }
    function renderUserInfo(vm) {
      document.querySelectorAll(".account__info-value").forEach(span => {
        span.textContent = vm[span.dataset.field] || "";
      });
    }

    /* =========================
       LOAD CONTENT (MAIN)
    ========================= */
    async function loadContent(page) {
      const container = document.getElementById("right-side");
      const html = await fetch(page).then(r => r.text());
      container.innerHTML = html;

      // X·ª≠ l√Ω t·ª´ng lo·∫°i trang
      if (page.includes("account.html")) {
        const db = await getDB();
        const uid = await ensureCurrentUserId(db);
        const user = getUserById(db, uid);
        if (user) {
          const vm = toViewModel(user);
          renderAvatar(vm);
          renderUserInfo(vm);
          initAccountEdit(vm, user, db);
        }
      }

      if (page.includes("order.html")) {
        initOrderFilter();
      }

      if (page.includes("address.html")) {
        initAddressPage();
      }
    }

    /* =========================
       ACCOUNT EDIT (CH·ªàNH S·ª¨A & L∆ØU)
    ========================= */
    function initAccountEdit(vm, user, db) {
      const editBtn = document.getElementById("edit-btn");
      const userInfo = document.getElementById("user-info");
      if (!editBtn || !userInfo) return;
      if (editBtn.dataset.bound === "true") return;
      editBtn.dataset.bound = "true";
      let isEditing = false;

      editBtn.addEventListener("click", () => {
        if (isEditing) return;
        isEditing = true;

        userInfo.querySelectorAll(".account__info-value").forEach(span => {
          const field = span.dataset.field;
          const val = span.textContent.trim();
          if (field === "phone") return;

          if (field === "birthday") {
            const input = document.createElement("input");
            input.type = "date";
            const [d, m, y] = val.split("/");
            input.value = y && m && d ? `${y}-${m}-${d}` : "";
            input.className = "account__info-input";
            input.dataset.field = field;
            span.replaceWith(input);
            return;
          }

          if (field === "gender") {
            const wrap = document.createElement("div");
            wrap.className = "account__gender-options";
            ["Nam", "N·ªØ", "Kh√°c"].forEach((g, i) => {
              const radio = document.createElement("input");
              const id = `gender-${i}`;
              radio.type = "radio";
              radio.name = "gender";
              radio.value = g;
              radio.id = id;
              if (g === val) radio.checked = true;

              const label = document.createElement("label");
              label.textContent = g;
              label.setAttribute("for", id);

              wrap.append(radio, label);
            });
            span.replaceWith(wrap);
            return;
          }

          const input = document.createElement("input");
          input.type = "text";
          input.value = val;
          input.className = "account__info-input";
          input.dataset.field = field;
          span.replaceWith(input);
        });

        const btnWrap = userInfo.querySelector(".account__info-buttons");
        btnWrap.innerHTML = "";
        const cancelBtn = document.createElement("button");
        cancelBtn.textContent = "H·ªßy";
        cancelBtn.className = "account__info-button";
        const saveBtn = document.createElement("button");
        saveBtn.textContent = "L∆∞u";
        saveBtn.className = "account__info-button";
        btnWrap.append(cancelBtn, saveBtn);

        cancelBtn.onclick = () => {
          isEditing = false;
          loadContent("account.html");
        };

        saveBtn.onclick = async () => {
          const updatedVM = { ...vm };
          userInfo.querySelectorAll(".account__info-input, .account__gender-options").forEach(el => {
            if (el.classList.contains("account__gender-options")) {
              const checked = el.querySelector("input[name='gender']:checked");
              updatedVM.gender = checked ? checked.value : vm.gender;
            } else if (el.type === "date") {
              const [y, m, d] = el.value.split("-");
              updatedVM.birthday = (y && m && d) ? `${d}/${m}/${y}` : vm.birthday;
            } else {
              updatedVM[el.dataset.field] = el.value.trim() || vm[el.dataset.field];
            }
          });

          // C·∫≠p nh·∫≠t d·ªØ li·ªáu
          const newUser = toDataModel(updatedVM, user);
          updateUserInDB(db, newUser);

          // C·∫≠p nh·∫≠t hi·ªÉn th·ªã avatar
          renderAvatar(updatedVM);

          // === FIX: chuy·ªÉn to√†n b·ªô input v·ªÅ span (view mode) ===
          userInfo.querySelectorAll(".account__info-input, .account__gender-options").forEach(el => {
            const span = document.createElement("span");
            span.className = "account__info-value";
            const field = el.dataset.field || (el.querySelector("input[name='gender']") ? "gender" : "");
            span.dataset.field = field;
            span.textContent = updatedVM[field] || "";
            el.replaceWith(span);
          });

          // Tr·∫£ l·∫°i n√∫t "Ch·ªânh s·ª≠a th√¥ng tin"
          btnWrap.innerHTML = "";
          btnWrap.append(editBtn);
          isEditing = false;

          console.log("‚úÖ Saved:", newUser._id);
        };
      });
    }

    /* =========================
       ORDER FILTER + PAGINATION (5/SP)
    ========================= */
    function initOrderFilter() {
      const tabs = document.querySelectorAll(".orders__tab");
      const orders = Array.from(document.querySelectorAll(".order-card"));
      const pagination = document.querySelector(".orders__pagination");
      const searchInput = document.getElementById("orders-search-input");
      if (!tabs.length || !orders.length || !pagination) {
        console.warn("initOrderFilter(): DOM ch∆∞a ƒë·ªß ph·∫ßn t·ª≠");
        return;
      }

      const DEBOUNCE_MS = 200;
      let currentStatus = "all";
      let currentPage = 1;
      let currentQuery = ""; // lowercase

      function debounce(fn, wait) {
        let t;
        return function (...args) {
          clearTimeout(t);
          t = setTimeout(() => fn.apply(this, args), wait);
        };
      }

      function orderMatchesQuery(o) {
        if (!currentQuery) return true;
        // Try data attributes first
        const code = (o.dataset.code || "").toLowerCase();
        const name = (o.dataset.name || o.dataset.title || "").toLowerCase();
        if (code.includes(currentQuery) || name.includes(currentQuery)) return true;
        // Fallback: scan common fields or the whole text
        const codeEl = o.querySelector('.order-card__code');
        const nameEl = o.querySelector('.order-card__name, .order-card__title, .order-card__product');
        const haystack = [codeEl?.textContent, nameEl?.textContent, o.textContent]
          .filter(Boolean)
          .join(' ')
          .toLowerCase();
        return haystack.includes(currentQuery);
      }

      const PER_PAGE = 5;

      function getFilteredOrders() {
        return orders.filter(o =>
          (currentStatus === "all" || o.dataset.status === currentStatus) &&
          orderMatchesQuery(o)
        );
      }

      function renderPage() {
        const filtered = getFilteredOrders();
        const totalPages = Math.ceil(filtered.length / PER_PAGE);
        if (currentPage > totalPages) currentPage = totalPages || 1;

        orders.forEach(o => (o.style.display = "none"));
        const start = (currentPage - 1) * PER_PAGE;
        const end = start + PER_PAGE;
        filtered.slice(start, end).forEach(o => (o.style.display = "flex"));

        renderPagination(totalPages);
      }

      function renderPagination(totalPages) {
        pagination.innerHTML = "";

        const prev = document.createElement("button");
        prev.textContent = "Tr∆∞·ªõc";
        prev.className = "orders__page-btn";
        if (currentPage === 1) prev.classList.add("orders__page-btn--disabled");
        pagination.appendChild(prev);

        for (let i = 1; i <= totalPages; i++) {
          const btn = document.createElement("button");
          btn.textContent = i;
          btn.className = "orders__page-btn";
          if (i === currentPage) btn.classList.add("orders__page-btn--active");
          pagination.appendChild(btn);
        }

        const next = document.createElement("button");
        next.textContent = "Sau";
        next.className = "orders__page-btn";
        if (currentPage === totalPages || totalPages === 0)
          next.classList.add("orders__page-btn--disabled");
        pagination.appendChild(next);

        pagination.querySelectorAll(".orders__page-btn").forEach(btn => {
          btn.addEventListener("click", () => {
            const text = btn.textContent.trim();
            if (text === "Tr∆∞·ªõc" && currentPage > 1) currentPage--;
            else if (text === "Sau" && currentPage < totalPages) currentPage++;
            else if (!isNaN(text)) currentPage = parseInt(text);
            renderPage();
          });
        });
      }

      tabs.forEach(tab => {
        tab.addEventListener("click", () => {
          tabs.forEach(t => t.classList.remove("orders__tab--active"));
          tab.classList.add("orders__tab--active");
          currentStatus = tab.dataset.status;
          currentPage = 1;
          renderPage();
        });
      });

      if (searchInput) {
        searchInput.addEventListener('input', debounce(() => {
          currentQuery = searchInput.value.trim().toLowerCase();
          currentPage = 1;
          renderPage();
        }, DEBOUNCE_MS));
      }

      renderPage();
      console.log("‚úÖ initOrderFilter(): filter + pagination ready");
    }

    /* =========================
       MENU + LOGOUT
    ========================= */
    document.querySelectorAll(".account__menu-item").forEach(item => {
      item.addEventListener("click", () => {
        if (item.id === "logout-btn") {
          document.getElementById("logout-modal").classList.add("active");
          return;
        }
        document.querySelectorAll(".account__menu-item").forEach(i => i.classList.remove("account__menu-item--active"));
        item.classList.add("account__menu-item--active");
        loadContent(item.dataset.page);
      });
    });

    document.getElementById("cancel-logout").onclick = () =>
      document.getElementById("logout-modal").classList.remove("active");
    document.getElementById("confirm-logout").onclick = () => {
      document.getElementById("logout-modal").classList.remove("active");
      window.location.href = "../html/homepage.html";
    };

    /* =========================
       ADDRESS MANAGEMENT
    ========================= */
    function initAddressPage() {
      const STORAGE_ADDRESS = "db.addresses.v1";
      const list = document.getElementById("address-list");
      const addBtn = document.getElementById("add-address-btn");

      // Pending delete index for custom confirm
      let pendingDeleteIndex = null;

      // Ensure custom delete confirm modal exists (reuse logout modal styles)
      function ensureDeleteModal() {
        if (document.getElementById('address-delete-modal')) return;
        const modal = document.createElement('div');
        modal.id = 'address-delete-modal';
        modal.className = 'logout-modal';
        modal.innerHTML = `
          <div class="logout-modal__content">
            <p>B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ƒë·ªãa ch·ªâ n√†y kh√¥ng?</p>
            <div class="logout-modal__buttons">
              <button id="confirm-address-delete" class="logout-btn confirm">X√≥a</button>
              <button id="cancel-address-delete" class="logout-btn cancel">H·ªßy</button>
            </div>
          </div>`;
        document.body.appendChild(modal);

        const cancelBtn = modal.querySelector('#cancel-address-delete');
        const confirmBtn = modal.querySelector('#confirm-address-delete');
        cancelBtn.addEventListener('click', () => {
          pendingDeleteIndex = null;
          modal.classList.remove('active');
        });
        confirmBtn.addEventListener('click', () => {
          if (pendingDeleteIndex === null || pendingDeleteIndex === undefined) {
            modal.classList.remove('active');
            return;
          }
          const addresses = loadAddresses();
          addresses.splice(pendingDeleteIndex, 1);
          saveAddresses(addresses);
          pendingDeleteIndex = null;
          modal.classList.remove('active');
          renderAddresses();
        });
      }

      function openDeleteModal(index) {
        ensureDeleteModal();
        pendingDeleteIndex = index;
        const modal = document.getElementById('address-delete-modal');
        modal.classList.add('active');
      }

      // Utils for localStorage
      const loadAddresses = () => {
        const cached = localStorage.getItem(STORAGE_ADDRESS);
        return cached ? JSON.parse(cached) : [];
      };
      const saveAddresses = (data) => {
        localStorage.setItem(STORAGE_ADDRESS, JSON.stringify(data));
      };

      // Build a safe, full address string (street, ward, district, province)
      function formatAddress(addr) {
        const ward = addr.wardName || addr.ward || "";
        const district = addr.districtName || addr.district || "";
        const province = addr.provinceName || addr.province || "";
        const parts = [addr.street, ward, district, province]
          .filter(Boolean)
          .map(escapeHtml);
        return parts.join(", ");
      }

      // Render list
      const renderAddresses = () => {
        list.innerHTML = "";
        const addresses = loadAddresses();

        addresses.forEach((a, index) => {
          const card = document.createElement("article");
          card.className = "address-card";
          card.dataset.index = index;
          card.innerHTML = `
        <header class="address-card__head">
          <h3 class="address-card__name">${escapeHtml(a.name)}</h3>
          <span class="address-card__phone">${escapeHtml(a.phone)}</span>
        </header>
        <p class="address-card__body">${formatAddress(a)}</p>
        <footer class="address-card__foot">
          <div class="address-card__actions">
            <button class="address-card__btn address-card__btn--edit">S·ª≠a</button>
            <button class="address-card__btn address-card__btn--delete">X√≥a</button>
          </div>
        </footer>
      `;
          list.appendChild(card);
        });

        if (!addresses.length) {
          list.innerHTML = `<p style="text-align:center; color:#666;">Ch∆∞a c√≥ ƒë·ªãa ch·ªâ n√†o.</p>`;
        }
      };

      // Basic html escape to avoid injection from prompt values
      function escapeHtml(str) {
        if (!str && str !== 0) return '';
        return String(str)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#039;');
      }

      // Create modal DOM if not present
      function ensureModal() {
        if (document.getElementById('address-modal')) return;
        const modal = document.createElement('div');
        modal.id = 'address-modal';
        modal.className = 'address-modal';
        modal.innerHTML = `
      <div class="address-modal__content" role="dialog" aria-modal="true">
        <h2 class="address-modal__title">Th√™m / S·ª≠a ƒë·ªãa ch·ªâ</h2>
        <form id="address-form">
          <div class="form-group">
            <label for="addr-name">H·ªç v√† t√™n</label>
            <input id="addr-name" name="name" type="text" required />
          </div>
          <div class="form-group">
            <label for="addr-phone">S·ªë ƒëi·ªán tho·∫°i</label>
            <input id="addr-phone" name="phone" type="tel" required />
          </div>
          <hr />
          <div class="form-group">
            <label for="addr-street">T√™n ƒë∆∞·ªùng, t√≤a nh√†, s·ªë nh√†</label>
            <input id="addr-street" name="street" type="text" required />
          </div>
          <div class="form-row">
            <div class="form-group" style="flex:1; min-width:120px;">
              <label for="addr-province">T·ªânh</label>
              <select id="addr-province" required><option value="">ƒêang t·∫£i...</option></select>
            </div>
            <div class="form-group" style="flex:1; min-width:120px;">
              <label for="addr-district">Qu·∫≠n / Huy·ªán</label>
              <select id="addr-district" required><option value="">Ch·ªçn t·ªânh tr∆∞·ªõc</option></select>
            </div>
            <div class="form-group" style="flex:1; min-width:120px;">
              <label for="addr-ward">Ph∆∞·ªùng / X√£</label>
              <select id="addr-ward" required><option value="">Ch·ªçn qu·∫≠n tr∆∞·ªõc</option></select>
            </div>
          </div>
          <div class="form-buttons">
            <button type="submit" class="btn-primary">L∆∞u</button>
            <button type="button" id="cancel-modal" class="btn-secondary">H·ªßy</button>
          </div>
        </form>
      </div>
    `;
        document.body.appendChild(modal);

        // Modal element references
        const provinceEl = modal.querySelector('#addr-province');
        const districtEl = modal.querySelector('#addr-district');
        const wardEl = modal.querySelector('#addr-ward');

        // Load provinces once
        fetchProvinces().then(provs => {
          provinceEl.innerHTML = '<option value="">-- Ch·ªçn t·ªânh --</option>';
          provs.forEach(p => {
            const opt = document.createElement('option');
            opt.value = p.code;
            opt.textContent = p.full_name || p.name || p.province_name;
            opt.dataset.raw = JSON.stringify(p);
            provinceEl.appendChild(opt);
          });
        }).catch(err => {
          provinceEl.innerHTML = '<option value="">Kh√¥ng th·ªÉ t·∫£i t·ªânh</option>';
          console.error('Load provinces failed', err);
        });

        provinceEl.addEventListener('change', async (e) => {
          const code = e.target.value;
          districtEl.innerHTML = '<option value="">ƒêang t·∫£i...</option>';
          wardEl.innerHTML = '<option value="">Ch·ªçn qu·∫≠n tr∆∞·ªõc</option>';
          if (!code) { districtEl.innerHTML = '<option value="">Ch·ªçn t·ªânh tr∆∞·ªõc</option>'; return; }
          try {
            const districts = await fetchDistricts(code);
            districtEl.innerHTML = '<option value="">-- Ch·ªçn qu·∫≠n/huy·ªán --</option>';
            districts.forEach(d => {
              const opt = document.createElement('option');
              opt.value = d.code;
              opt.textContent = d.full_name || d.name || d.district_name;
              opt.dataset.raw = JSON.stringify(d);
              districtEl.appendChild(opt);
            });
          } catch (err) {
            districtEl.innerHTML = '<option value="">Kh√¥ng th·ªÉ t·∫£i qu·∫≠n</option>';
            console.error(err);
          }
        });

        districtEl.addEventListener('change', async (e) => {
          const code = e.target.value;
          wardEl.innerHTML = '<option value="">ƒêang t·∫£i...</option>';
          if (!code) { wardEl.innerHTML = '<option value="">Ch·ªçn qu·∫≠n tr∆∞·ªõc</option>'; return; }
          try {
            // Ch·ªâ hi·ªÉn th·ªã ph∆∞·ªùng thu·ªôc ƒë√∫ng qu·∫≠n/huy·ªán c·ªßa t·ªânh ƒë√£ ch·ªçn
            const wards = await fetchWards(code);
            wardEl.innerHTML = '<option value="">-- Ch·ªçn ph∆∞·ªùng/x√£ --</option>';
            wards.forEach(w => {
              const opt = document.createElement('option');
              opt.value = w.code;
              opt.textContent = w.full_name || w.name || w.ward_name;
              opt.dataset.raw = JSON.stringify(w);
              wardEl.appendChild(opt);
            });
          } catch (err) {
            wardEl.innerHTML = '<option value="">Kh√¥ng th·ªÉ t·∫£i ph∆∞·ªùng</option>';
            console.error(err);
          }
        });

        // Cancel button
        modal.querySelector('#cancel-modal').addEventListener('click', () => closeModal());

        // Submit handler (delegated below when opening modal - to allow prefill)
      }

      // ====== API m·ªõi: provinces.open-api.vn ======
      async function fetchFullAddressData() {
        const url = "https://provinces.open-api.vn/api/v1/?depth=3";
        const res = await fetch(url);
        if (!res.ok) throw new Error("Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu h√†nh ch√≠nh Vi·ªát Nam");
        const data = await res.json();
        return data; // M·∫£ng g·ªìm c√°c t·ªânh/th√†nh, m·ªói ph·∫ßn t·ª≠ ch·ª©a districts v√† wards
      }

      let fullAddressData = [];

      async function fetchProvinces() {
        if (fullAddressData.length === 0) {
          fullAddressData = await fetchFullAddressData();
        }
        return fullAddressData.map(p => ({ code: p.code, name: p.name }));
      }

      async function fetchDistricts(provinceCode) {
        if (fullAddressData.length === 0) {
          fullAddressData = await fetchFullAddressData();
        }
        const province = fullAddressData.find(p => String(p.code) === String(provinceCode));
        if (!province || !province.districts) return [];
        return province.districts.map(d => ({ code: d.code, name: d.name }));
      }

      async function fetchWards(districtCode) {
        if (fullAddressData.length === 0) {
          fullAddressData = await fetchFullAddressData();
        }
        for (const p of fullAddressData) {
          const district = p.districts?.find(d => String(d.code) === String(districtCode));
          if (district && district.wards) {
            return district.wards.map(w => ({ code: w.code, name: w.name }));
          }
        }
        return [];
      }

      // helpers to open/close modal and prefill form
      function openModal(prefill) {
        ensureModal();
        const modal = document.getElementById('address-modal');
        const form = modal.querySelector('#address-form');
        const nameEl = modal.querySelector('#addr-name');
        const phoneEl = modal.querySelector('#addr-phone');
        const streetEl = modal.querySelector('#addr-street');
        const provinceEl = modal.querySelector('#addr-province');
        const districtEl = modal.querySelector('#addr-district');
        const wardEl = modal.querySelector('#addr-ward');

        // reset
        form.reset();
        districtEl.innerHTML = '<option value="">Ch·ªçn t·ªânh tr∆∞·ªõc</option>';
        wardEl.innerHTML = '<option value="">Ch·ªçn qu·∫≠n tr∆∞·ªõc</option>';

        // if prefill provided (for edit), set values and load dependent selects
        if (prefill && typeof prefill === 'object') {
          nameEl.value = prefill.name || '';
          phoneEl.value = prefill.phone || '';
          streetEl.value = prefill.street || '';

          // set province after provinces loaded (options may be available)
          (async () => {
            try {
              // ensure provinces loaded in DOM
              const waitForProvs = () => new Promise(res => {
                const check = () => {
                  const p = document.querySelectorAll('#addr-province option');
                  if (p && p.length > 0) return res();
                  setTimeout(check, 50);
                };
                check();
              });
              await waitForProvs();
              if (prefill.provinceId) {
                provinceEl.value = prefill.provinceId;
                // trigger change to load districts
                provinceEl.dispatchEvent(new Event('change'));
                // wait small time then set district
                const waitForDistricts = () => new Promise(res => {
                  const check = () => {
                    if (districtEl.options && districtEl.options.length > 1) return res();
                    setTimeout(check, 50);
                  }; check();
                });
                await waitForDistricts();
                if (prefill.districtId) {
                  districtEl.value = prefill.districtId;
                  districtEl.dispatchEvent(new Event('change'));
                }
                const waitForWards = () => new Promise(res => {
                  const check = () => {
                    if (wardEl.options && wardEl.options.length > 1) return res();
                    setTimeout(check, 50);
                  }; check();
                });
                await waitForWards();
                if (prefill.wardId) {
                  wardEl.value = prefill.wardId;
                }
              }
            } catch (e) { console.error('prefill error', e) }
          })();

          // store index if editing
          form.dataset.editIndex = (typeof prefill._idx === 'number') ? prefill._idx : '';
        } else {
          form.dataset.editIndex = '';
        }

        modal.classList.add('active');

        // attach submit handler once
        form.onsubmit = (evt) => {
          evt.preventDefault();
          const name = nameEl.value.trim();
          const phone = phoneEl.value.trim();
          const street = streetEl.value.trim();
          const provinceId = provinceEl.value;
          const districtId = districtEl.value;
          const wardId = wardEl.value;
          const provinceName = provinceEl.options[provinceEl.selectedIndex]?.text || '';
          const districtName = districtEl.options[districtEl.selectedIndex]?.text || '';
          const wardName = wardEl.options[wardEl.selectedIndex]?.text || '';

          if (!name || !phone || !street || !provinceId || !districtId || !wardId) {
            alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin.');
            return;
          }

          const addresses = loadAddresses();
          const editIndex = form.dataset.editIndex;
          const newAddr = {
            name, phone, street,
            provinceId, provinceName,
            districtId, districtName,
            wardId, wardName
          };

          if (editIndex !== '') {
            const idxNum = Number(editIndex);
            const merged = Object.assign({}, addresses[idxNum], newAddr);
            delete merged.isDefault;
            addresses[idxNum] = merged;
          } else {
            // ensure no default flag is set on newly added items
            delete newAddr.isDefault;
            addresses.push(newAddr);
          }
          saveAddresses(addresses);
          renderAddresses();
          closeModal();
        };
      }

      function closeModal() {
        const modal = document.getElementById('address-modal');
        if (modal) modal.classList.remove('active');
      }

      // click handlers: edit / delete
      list.addEventListener('click', (e) => {
        if (e.target.classList.contains('address-card__btn--edit')) {
          const card = e.target.closest('.address-card');
          const idx = Number(card.dataset.index);
          const addresses = loadAddresses();
          const item = addresses[idx];
          if (!item) return;
          // open modal prefilled
          openModal(Object.assign({}, item, { _idx: idx }));
        }
        if (e.target.classList.contains('address-card__btn--delete')) {
          const card = e.target.closest('.address-card');
          const idx = Number(card.dataset.index);
          openDeleteModal(idx);
        }
      });

      // add new
      addBtn.addEventListener('click', () => openModal());

      // initial render
      renderAddresses();
    }

    /* =========================
       INIT
    ========================= */
    document.addEventListener("DOMContentLoaded", async () => {
      const db = await getDB();
      await ensureCurrentUserId(db);
      loadContent("account.html");
      const user = getUserById(db, localStorage.getItem(STORAGE_UID));
      if (user) renderAvatar(toViewModel(user));

      // === Cart popup toggle (click + hover) ===
      (function initCartPopup() {
        const cartContainer = document.querySelector('.cart-container');
        if (!cartContainer) return;
        const cartBtn = cartContainer.querySelector('.cart-btn');
        const cartPopup = cartContainer.querySelector('.cart-popup');
        if (!cartBtn || !cartPopup) return;

        // Open/close on click of the cart button
        cartBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          cartContainer.classList.toggle('open');
        });

        // Optional: support hover to open
        cartContainer.addEventListener('mouseenter', () => {
          cartContainer.classList.add('open');
        });
        cartContainer.addEventListener('mouseleave', () => {
          cartContainer.classList.remove('open');
        });
      })();
    });
  </script>
</body>

</html>