<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login Popup (component)</title>
  <style>
    /* Namespaced styles to avoid collisions when embedded in homepage */
    :root { --lp-backdrop-z: 9999; }
    .lp-modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;z-index:var(--lp-backdrop-z)}
    .lp-modal-backdrop.lp-open{display:flex}
    .lp-modal{background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.15);width:380px;max-width:calc(100% - 32px);padding:20px;position:relative}
    .lp-modal h2{margin:0 0 8px;font-size:20px}
    .lp-field{margin-bottom:12px}
    .lp-field label{display:block;font-size:13px;margin-bottom:6px}
    .lp-field input{width:100%;box-sizing:border-box;padding:10px;border-radius:8px;border:1px solid #d1d5db}
    .lp-actions{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:12px}
    .lp-btn{display:inline-block;padding:10px 16px;border-radius:8px;border:1px solid #2b6cb0;background:#3182ce;color:#fff;cursor:pointer}
    .lp-btn.secondary{background:#eef2ff;color:#2b6cb0;border:1px solid #c7d2fe}
    .lp-close-btn{position:absolute;right:12px;top:12px;border:none;background:transparent;font-size:18px;cursor:pointer}
    .lp-note{font-size:13px;color:#6b7280;margin-top:8px}
    .lp-btn:focus, .lp-close-btn:focus, .lp-field input:focus{outline:3px solid rgba(66,153,225,0.25);outline-offset:2px}
    @media (max-width:420px){.lp-modal{width:92%}}
  </style>
</head>
<body>
  <!-- This file acts as a standalone demo AND as a component that homepage can call.
       If you include this file directly in your homepage (via server-side include or fetch & insert),
       call window.LoginPopup.open() to open the popup.
  -->

  <!-- Modal markup (kept in body so it can be inserted directly into homepage) -->
  <div id="lp-login-modal" class="lp-modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="lp-login-title" aria-hidden="true">
    <div class="lp-modal" role="document">
      <div class="lp-header">
        <h2 id="lp-login-title">ƒêƒÉng nh·∫≠p</h2>
        <button class="lp-close-btn" id="lp-close-login" aria-label="ƒê√≥ng">‚úï</button>
      </div>

      <form id="lp-login-form" novalidate>
        <div class="lp-field">
          <label for="lp-username">T√™n ƒëƒÉng nh·∫≠p</label>
          <input id="lp-username" name="username" type="text" autocomplete="username" required />
        </div>

        <div class="lp-field">
          <label for="lp-password">M·∫≠t kh·∫©u</label>
          <div style="position:relative;">
            <input id="lp-password" name="password" type="password" autocomplete="current-password" required />
            <button type="button" id="lp-toggle-password" aria-label="Hi·ªán m·∫≠t kh·∫©u" style="position:absolute;right:8px;top:50%;transform:translateY(-50%);border:none;background:transparent;cursor:pointer;font-size:14px">üëÅÔ∏è</button>
          </div>
        </div>

        <div class="lp-actions">
          <button type="button" class="lp-btn secondary" id="lp-cancel">H·ªßy</button>
          <button type="submit" class="lp-btn" id="lp-submit">ƒêƒÉng nh·∫≠p</button>
        </div>

        <p class="lp-note">L∆∞u √Ω: form demo ‚Äî submit s·∫Ω g·ªçi callback JavaScript (homepage n√™n g√°n callback ƒë·ªÉ x·ª≠ l√Ω server-side).</p>
      </form>
    </div>
  </div>

  <script>
    (function(){
      // Elements
      const modal = document.getElementById('lp-login-modal');
      const closeBtn = document.getElementById('lp-close-login');
      const cancelBtn = document.getElementById('lp-cancel');
      const form = document.getElementById('lp-login-form');
      const usernameEl = document.getElementById('lp-username');
      const passwordEl = document.getElementById('lp-password');
      const togglePassword = document.getElementById('lp-toggle-password');

      // Internal state
      let submitCallback = null; // function({username, password})

      function open(){
        modal.classList.add('lp-open');
        modal.setAttribute('aria-hidden','false');
        // focus first field
        setTimeout(()=> usernameEl.focus(), 50);
        document.addEventListener('keydown', onKeyDown);
      }

      function close(){
        modal.classList.remove('lp-open');
        modal.setAttribute('aria-hidden','true');
        // return focus to document body (homepage should manage focus if needed)
        document.activeElement.blur();
        document.removeEventListener('keydown', onKeyDown);
      }

      function onKeyDown(e){
        if (e.key === 'Escape') close();
      }

      // Toggle password visibility
      togglePassword.addEventListener('click', ()=>{
        const type = passwordEl.type === 'password' ? 'text' : 'password';
        passwordEl.type = type;
        togglePassword.setAttribute('aria-label', type === 'password' ? 'Hi·ªán m·∫≠t kh·∫©u' : '·∫®n m·∫≠t kh·∫©u');
      });

      // Close handlers
      closeBtn.addEventListener('click', close);
      cancelBtn.addEventListener('click', (e)=>{ e.preventDefault(); close(); });

      // Backdrop click to close
      modal.addEventListener('click', (e)=>{ if (e.target === modal) close(); });

      // Submit handler: call provided callback if any, otherwise emit custom event
      form.addEventListener('submit', (e)=>{
        e.preventDefault();
        const data = { username: usernameEl.value.trim(), password: passwordEl.value };
        if (!data.username || !data.password){
          // minimal UX feedback
          alert('Vui l√≤ng nh·∫≠p c·∫£ t√™n ƒëƒÉng nh·∫≠p v√† m·∫≠t kh·∫©u.');
          return;
        }
        // If homepage provided a callback, use it
        if (typeof submitCallback === 'function'){
          try{ submitCallback(data); }
          catch(err){ console.error('LoginPopup submit callback error', err); }
        }
        // Dispatch a DOM event so pages that prefer events can listen
        const event = new CustomEvent('login-popup:submit',{ detail: data, bubbles: true });
        window.dispatchEvent(event);

        // by default close and reset (homepage callback may perform navigation/auth)
        close();
        form.reset();
      });

      // Focus trap (simple): keep focus inside modal when open
      document.addEventListener('focusin', (e)=>{
        if (modal.classList.contains('lp-open') && !modal.contains(e.target)){
          e.stopPropagation();
          usernameEl.focus();
        }
      });

      // Expose API on window
      window.LoginPopup = Object.freeze({
        open,
        close,
        onSubmit(fn){ if (typeof fn === 'function') submitCallback = fn; },
        // convenience: returns true if open
        isOpen(){ return modal.classList.contains('lp-open'); }
      });

      // If this file is opened directly in browser (demo mode), show a temporary trigger button
      // This block is only for standalone testing and won't interfere when inserted into a homepage
      if (!document.querySelector('[data-lp-inserted]')){
        // add a small demo trigger so developer can open the popup when visiting this page directly
        const demoBtn = document.createElement('button');
        demoBtn.textContent = 'M·ªü popup ƒëƒÉng nh·∫≠p (demo)';
        demoBtn.className = 'lp-btn';
        demoBtn.style.margin = '24px';
        demoBtn.addEventListener('click', open);
        document.body.insertBefore(demoBtn, document.body.firstChild);
      }

    })();
  </script>
</body>
</html>
